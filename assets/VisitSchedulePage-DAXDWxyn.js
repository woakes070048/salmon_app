import{g as Ge,a as Xe,r as a,u as Se,_ as _e,b as c,j as e,s as se,c as V,d as De,T as y,e as lo,h as Mt,k as ft,i as Yt,m as co,n as Oe,o as uo,p as po,q as Rt,t as ho,v as mo,w as fo,x as Fe,y as go,z as Wt,A as zt,D as Ke,E as Je,F as Qe,G as Ze,H as xo,I as vo,J as bo,K as ct,L as Tt,B as F,M as St,C as He,N as _t}from"./index-BC3UxqoT.js";import{D as Co,g as yo,a as ko,h as Ue,b as Ye,c as We,M as jo,d as dt}from"./moment-DfZAPTqF.js";import{u as wo}from"./useMediaQuery-CchYqtpt.js";import{G as Dt,F as Po,I as Mo,S as Ro}from"./Select-Vgkz5MIo.js";import{P as Bt,C as je}from"./Chip-42AKOM23.js";import{C as To,A as ut}from"./Container-D5zBg6sZ.js";import{B as H}from"./Button-C3B7PPq7.js";import{C as Vt,a as qt,b as Gt}from"./CardHeader-Cx3FrDr2.js";function So(t){return String(t).match(/[\d.\-+]*\s*(.*)/)[1]||""}function _o(t){return parseFloat(t)}function Do(t){return Ge("MuiCardActions",t)}Xe("MuiCardActions",["root","spacing"]);const Io=["disableSpacing","className"],Eo=t=>{const{classes:o,disableSpacing:r}=t;return De({root:["root",!r&&"spacing"]},Do,o)},Ao=se("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:r}=t;return[o.root,!r.disableSpacing&&o.spacing]}})(({ownerState:t})=>c({display:"flex",alignItems:"center",padding:8},!t.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})),Xt=a.forwardRef(function(o,r){const i=Se({props:o,name:"MuiCardActions"}),{disableSpacing:m=!1,className:p}=i,h=_e(i,Io),f=c({},i,{disableSpacing:m}),x=Eo(f);return e.jsx(Ao,c({className:V(x.root,p),ownerState:f,ref:r},h))});function Lo(t){return Ge("MuiDialogContentText",t)}Xe("MuiDialogContentText",["root"]);const No=["children","className"],$o=t=>{const{classes:o}=t,i=De({root:["root"]},Lo,o);return c({},o,i)},Oo=se(y,{shouldForwardProp:t=>lo(t)||t==="classes",name:"MuiDialogContentText",slot:"Root",overridesResolver:(t,o)=>o.root})({}),It=a.forwardRef(function(o,r){const i=Se({props:o,name:"MuiDialogContentText"}),{className:m}=i,p=_e(i,No),h=$o(p);return e.jsx(Oo,c({component:"p",variant:"body1",color:"text.secondary",ref:r,ownerState:p,className:V(h.root,m)},i,{classes:h}))}),Fo=["className","id"],Ho=t=>{const{classes:o}=t;return De({root:["root"]},yo,o)},Uo=se(y,{name:"MuiDialogTitle",slot:"Root",overridesResolver:(t,o)=>o.root})({padding:"16px 24px",flex:"0 0 auto"}),pt=a.forwardRef(function(o,r){const i=Se({props:o,name:"MuiDialogTitle"}),{className:m,id:p}=i,h=_e(i,Fo),f=i,x=Ho(f),{titleId:k=p}=a.useContext(Co);return e.jsx(Uo,c({component:"h2",className:V(x.root,m),ownerState:f,ref:r,variant:"h6",id:p??k},h))});function Yo(t){return Ge("MuiSkeleton",t)}Xe("MuiSkeleton",["root","text","rectangular","rounded","circular","pulse","wave","withChildren","fitContent","heightAuto"]);const Wo=["animation","className","component","height","style","variant","width"];let qe=t=>t,Et,At,Lt,Nt;const zo=t=>{const{classes:o,variant:r,animation:i,hasChildren:m,width:p,height:h}=t;return De({root:["root",r,i,m&&"withChildren",m&&!p&&"fitContent",m&&!h&&"heightAuto"]},Yo,o)},Bo=ft(Et||(Et=qe`
  0% {
    opacity: 1;
  }

  50% {
    opacity: 0.4;
  }

  100% {
    opacity: 1;
  }
`)),Vo=ft(At||(At=qe`
  0% {
    transform: translateX(-100%);
  }

  50% {
    /* +0.5s of delay between each loop */
    transform: translateX(100%);
  }

  100% {
    transform: translateX(100%);
  }
`)),qo=se("span",{name:"MuiSkeleton",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:r}=t;return[o.root,o[r.variant],r.animation!==!1&&o[r.animation],r.hasChildren&&o.withChildren,r.hasChildren&&!r.width&&o.fitContent,r.hasChildren&&!r.height&&o.heightAuto]}})(({theme:t,ownerState:o})=>{const r=So(t.shape.borderRadius)||"px",i=_o(t.shape.borderRadius);return c({display:"block",backgroundColor:t.vars?t.vars.palette.Skeleton.bg:ko(t.palette.text.primary,t.palette.mode==="light"?.11:.13),height:"1.2em"},o.variant==="text"&&{marginTop:0,marginBottom:0,height:"auto",transformOrigin:"0 55%",transform:"scale(1, 0.60)",borderRadius:`${i}${r}/${Math.round(i/.6*10)/10}${r}`,"&:empty:before":{content:'"\\00a0"'}},o.variant==="circular"&&{borderRadius:"50%"},o.variant==="rounded"&&{borderRadius:(t.vars||t).shape.borderRadius},o.hasChildren&&{"& > *":{visibility:"hidden"}},o.hasChildren&&!o.width&&{maxWidth:"fit-content"},o.hasChildren&&!o.height&&{height:"auto"})},({ownerState:t})=>t.animation==="pulse"&&Mt(Lt||(Lt=qe`
      animation: ${0} 2s ease-in-out 0.5s infinite;
    `),Bo),({ownerState:t,theme:o})=>t.animation==="wave"&&Mt(Nt||(Nt=qe`
      position: relative;
      overflow: hidden;

      /* Fix bug in Safari https://bugs.webkit.org/show_bug.cgi?id=68196 */
      -webkit-mask-image: -webkit-radial-gradient(white, black);

      &::after {
        animation: ${0} 2s linear 0.5s infinite;
        background: linear-gradient(
          90deg,
          transparent,
          ${0},
          transparent
        );
        content: '';
        position: absolute;
        transform: translateX(-100%); /* Avoid flash during server-side hydration */
        bottom: 0;
        left: 0;
        right: 0;
        top: 0;
      }
    `),Vo,(o.vars||o).palette.action.hover)),B=a.forwardRef(function(o,r){const i=Se({props:o,name:"MuiSkeleton"}),{animation:m="pulse",className:p,component:h="span",height:f,style:x,variant:k="text",width:b}=i,P=_e(i,Wo),U=c({},i,{animation:m,component:h,variant:k,hasChildren:!!P.children}),Y=zo(U);return e.jsx(qo,c({as:h,ref:r,className:V(Y.root,p),ownerState:U},P,{style:c({width:b,height:f},x)}))});function Go(t){return Ge("MuiTooltip",t)}const q=Xe("MuiTooltip",["popper","popperInteractive","popperArrow","popperClose","tooltip","tooltipArrow","touch","tooltipPlacementLeft","tooltipPlacementRight","tooltipPlacementTop","tooltipPlacementBottom","arrow"]),Xo=["arrow","children","classes","components","componentsProps","describeChild","disableFocusListener","disableHoverListener","disableInteractive","disableTouchListener","enterDelay","enterNextDelay","enterTouchDelay","followCursor","id","leaveDelay","leaveTouchDelay","onClose","onOpen","open","placement","PopperComponent","PopperProps","slotProps","slots","title","TransitionComponent","TransitionProps"];function Ko(t){return Math.round(t*1e5)/1e5}const Jo=t=>{const{classes:o,disableInteractive:r,arrow:i,touch:m,placement:p}=t,h={popper:["popper",!r&&"popperInteractive",i&&"popperArrow"],tooltip:["tooltip",i&&"tooltipArrow",m&&"touch",`tooltipPlacement${Wt(p.split("-")[0])}`],arrow:["arrow"]};return De(h,Go,o)},Qo=se(Bt,{name:"MuiTooltip",slot:"Popper",overridesResolver:(t,o)=>{const{ownerState:r}=t;return[o.popper,!r.disableInteractive&&o.popperInteractive,r.arrow&&o.popperArrow,!r.open&&o.popperClose]}})(({theme:t,ownerState:o,open:r})=>c({zIndex:(t.vars||t).zIndex.tooltip,pointerEvents:"none"},!o.disableInteractive&&{pointerEvents:"auto"},!r&&{pointerEvents:"none"},o.arrow&&{[`&[data-popper-placement*="bottom"] .${q.arrow}`]:{top:0,marginTop:"-0.71em","&::before":{transformOrigin:"0 100%"}},[`&[data-popper-placement*="top"] .${q.arrow}`]:{bottom:0,marginBottom:"-0.71em","&::before":{transformOrigin:"100% 0"}},[`&[data-popper-placement*="right"] .${q.arrow}`]:c({},o.isRtl?{right:0,marginRight:"-0.71em"}:{left:0,marginLeft:"-0.71em"},{height:"1em",width:"0.71em","&::before":{transformOrigin:"100% 100%"}}),[`&[data-popper-placement*="left"] .${q.arrow}`]:c({},o.isRtl?{left:0,marginLeft:"-0.71em"}:{right:0,marginRight:"-0.71em"},{height:"1em",width:"0.71em","&::before":{transformOrigin:"0 0"}})})),Zo=se("div",{name:"MuiTooltip",slot:"Tooltip",overridesResolver:(t,o)=>{const{ownerState:r}=t;return[o.tooltip,r.touch&&o.touch,r.arrow&&o.tooltipArrow,o[`tooltipPlacement${Wt(r.placement.split("-")[0])}`]]}})(({theme:t,ownerState:o})=>c({backgroundColor:t.vars?t.vars.palette.Tooltip.bg:zt.alpha(t.palette.grey[700],.92),borderRadius:(t.vars||t).shape.borderRadius,color:(t.vars||t).palette.common.white,fontFamily:t.typography.fontFamily,padding:"4px 8px",fontSize:t.typography.pxToRem(11),maxWidth:300,margin:2,wordWrap:"break-word",fontWeight:t.typography.fontWeightMedium},o.arrow&&{position:"relative",margin:0},o.touch&&{padding:"8px 16px",fontSize:t.typography.pxToRem(14),lineHeight:`${Ko(16/14)}em`,fontWeight:t.typography.fontWeightRegular},{[`.${q.popper}[data-popper-placement*="left"] &`]:c({transformOrigin:"right center"},o.isRtl?c({marginLeft:"14px"},o.touch&&{marginLeft:"24px"}):c({marginRight:"14px"},o.touch&&{marginRight:"24px"})),[`.${q.popper}[data-popper-placement*="right"] &`]:c({transformOrigin:"left center"},o.isRtl?c({marginRight:"14px"},o.touch&&{marginRight:"24px"}):c({marginLeft:"14px"},o.touch&&{marginLeft:"24px"})),[`.${q.popper}[data-popper-placement*="top"] &`]:c({transformOrigin:"center bottom",marginBottom:"14px"},o.touch&&{marginBottom:"24px"}),[`.${q.popper}[data-popper-placement*="bottom"] &`]:c({transformOrigin:"center top",marginTop:"14px"},o.touch&&{marginTop:"24px"})})),es=se("span",{name:"MuiTooltip",slot:"Arrow",overridesResolver:(t,o)=>o.arrow})(({theme:t})=>({overflow:"hidden",position:"absolute",width:"1em",height:"0.71em",boxSizing:"border-box",color:t.vars?t.vars.palette.Tooltip.bg:zt.alpha(t.palette.grey[700],.9),"&::before":{content:'""',margin:"auto",display:"block",width:"100%",height:"100%",backgroundColor:"currentColor",transform:"rotate(45deg)"}}));let ze=!1;const $t=new go;let we={x:0,y:0};function Be(t,o){return(r,...i)=>{o&&o(r,...i),t(r,...i)}}const Ve=a.forwardRef(function(o,r){var i,m,p,h,f,x,k,b,P,U,Y,W,re,ae,et,me,G,Ie,X;const ne=Se({props:o,name:"MuiTooltip"}),{arrow:E=!1,children:ie,components:D={},componentsProps:M={},describeChild:fe=!1,disableFocusListener:tt=!1,disableHoverListener:K=!1,disableInteractive:ot=!1,disableTouchListener:g=!1,enterDelay:Ee=100,enterNextDelay:le=0,enterTouchDelay:ce=700,followCursor:de=!1,id:z,leaveDelay:ge=0,leaveTouchDelay:gt=1500,onClose:Ae,onOpen:Le,open:st,placement:J="bottom",PopperComponent:ue,PopperProps:R={},slotProps:A={},slots:L={},title:N,TransitionComponent:Q=Dt,TransitionProps:xe}=ne,pe=_e(ne,Xo),j=a.isValidElement(ie)?ie:e.jsx("span",{children:ie}),$=Yt(),rt=co(),[Z,Ne]=a.useState(),[ee,at]=a.useState(null),he=a.useRef(!1),ve=ot||de,$e=Oe(),be=Oe(),te=Oe(),s=Oe(),[n,d]=uo({controlled:st,default:!1,name:"Tooltip",state:"open"});let u=n;const v=po(z),T=a.useRef(),I=Rt(()=>{T.current!==void 0&&(document.body.style.WebkitUserSelect=T.current,T.current=void 0),s.clear()});a.useEffect(()=>I,[I]);const S=l=>{$t.clear(),ze=!0,d(!0),Le&&!u&&Le(l)},w=Rt(l=>{$t.start(800+ge,()=>{ze=!1}),d(!1),Ae&&u&&Ae(l),$e.start($.transitions.duration.shortest,()=>{he.current=!1})}),O=l=>{he.current&&l.type!=="touchstart"||(Z&&Z.removeAttribute("title"),be.clear(),te.clear(),Ee||ze&&le?be.start(ze?le:Ee,()=>{S(l)}):S(l))},oe=l=>{be.clear(),te.start(ge,()=>{w(l)})},{isFocusVisibleRef:xt,onBlur:Kt,onFocus:Jt,ref:Qt}=ho(),[,vt]=a.useState(!1),bt=l=>{Kt(l),xt.current===!1&&(vt(!1),oe(l))},Ct=l=>{Z||Ne(l.currentTarget),Jt(l),xt.current===!0&&(vt(!0),O(l))},yt=l=>{he.current=!0;const C=j.props;C.onTouchStart&&C.onTouchStart(l)},Zt=l=>{yt(l),te.clear(),$e.clear(),I(),T.current=document.body.style.WebkitUserSelect,document.body.style.WebkitUserSelect="none",s.start(ce,()=>{document.body.style.WebkitUserSelect=T.current,O(l)})},eo=l=>{j.props.onTouchEnd&&j.props.onTouchEnd(l),I(),te.start(gt,()=>{w(l)})};a.useEffect(()=>{if(!u)return;function l(C){(C.key==="Escape"||C.key==="Esc")&&w(C)}return document.addEventListener("keydown",l),()=>{document.removeEventListener("keydown",l)}},[w,u]);const to=mo(fo(j),Qt,Ne,r);!N&&N!==0&&(u=!1);const nt=a.useRef(),oo=l=>{const C=j.props;C.onMouseMove&&C.onMouseMove(l),we={x:l.clientX,y:l.clientY},nt.current&&nt.current.update()},Ce={},it=typeof N=="string";fe?(Ce.title=!u&&it&&!K?N:null,Ce["aria-describedby"]=u?v:null):(Ce["aria-label"]=it?N:null,Ce["aria-labelledby"]=u&&!it?v:null);const _=c({},Ce,pe,j.props,{className:V(pe.className,j.props.className),onTouchStart:yt,ref:to},de?{onMouseMove:oo}:{}),ye={};g||(_.onTouchStart=Zt,_.onTouchEnd=eo),K||(_.onMouseOver=Be(O,_.onMouseOver),_.onMouseLeave=Be(oe,_.onMouseLeave),ve||(ye.onMouseOver=O,ye.onMouseLeave=oe)),tt||(_.onFocus=Be(Ct,_.onFocus),_.onBlur=Be(bt,_.onBlur),ve||(ye.onFocus=Ct,ye.onBlur=bt));const so=a.useMemo(()=>{var l;let C=[{name:"arrow",enabled:!!ee,options:{element:ee,padding:4}}];return(l=R.popperOptions)!=null&&l.modifiers&&(C=C.concat(R.popperOptions.modifiers)),c({},R.popperOptions,{modifiers:C})},[ee,R]),ke=c({},ne,{isRtl:rt,arrow:E,disableInteractive:ve,placement:J,PopperComponentProp:ue,touch:he.current}),lt=Jo(ke),kt=(i=(m=L.popper)!=null?m:D.Popper)!=null?i:Qo,jt=(p=(h=(f=L.transition)!=null?f:D.Transition)!=null?h:Q)!=null?p:Dt,wt=(x=(k=L.tooltip)!=null?k:D.Tooltip)!=null?x:Zo,Pt=(b=(P=L.arrow)!=null?P:D.Arrow)!=null?b:es,ro=Fe(kt,c({},R,(U=A.popper)!=null?U:M.popper,{className:V(lt.popper,R==null?void 0:R.className,(Y=(W=A.popper)!=null?W:M.popper)==null?void 0:Y.className)}),ke),ao=Fe(jt,c({},xe,(re=A.transition)!=null?re:M.transition),ke),no=Fe(wt,c({},(ae=A.tooltip)!=null?ae:M.tooltip,{className:V(lt.tooltip,(et=(me=A.tooltip)!=null?me:M.tooltip)==null?void 0:et.className)}),ke),io=Fe(Pt,c({},(G=A.arrow)!=null?G:M.arrow,{className:V(lt.arrow,(Ie=(X=A.arrow)!=null?X:M.arrow)==null?void 0:Ie.className)}),ke);return e.jsxs(a.Fragment,{children:[a.cloneElement(j,_),e.jsx(kt,c({as:ue??Bt,placement:J,anchorEl:de?{getBoundingClientRect:()=>({top:we.y,left:we.x,right:we.x,bottom:we.y,width:0,height:0})}:Z,popperRef:nt,open:Z?u:!1,id:v,transition:!0},ye,ro,{popperOptions:so,children:({TransitionProps:l})=>e.jsx(jt,c({timeout:$.transitions.duration.shorter},l,ao,{children:e.jsxs(wt,c({},no,{children:[N,E?e.jsx(Pt,c({},io,{ref:at})):null]}))}))}))]})});var Pe={},Ot;function ts(){if(Ot)return Pe;Ot=1;var t=Ke();Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.default=void 0;var o=t(Je()),r=Qe();return Pe.default=(0,o.default)((0,r.jsx)("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8z"}),"History"),Pe}var os=ts();const ss=Ze(os);var Me={},Ft;function rs(){if(Ft)return Me;Ft=1;var t=Ke();Object.defineProperty(Me,"__esModule",{value:!0}),Me.default=void 0;var o=t(Je()),r=Qe();return Me.default=(0,o.default)((0,r.jsx)("path",{d:"m21.9 8.89-1.05-4.37c-.22-.9-1-1.52-1.91-1.52H5.05c-.9 0-1.69.63-1.9 1.52L2.1 8.89c-.24 1.02-.02 2.06.62 2.88.08.11.19.19.28.29V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-6.94c.09-.09.2-.18.28-.28.64-.82.87-1.87.62-2.89m-2.99-3.9 1.05 4.37c.1.42.01.84-.25 1.17-.14.18-.44.47-.94.47-.61 0-1.14-.49-1.21-1.14L16.98 5zM13 5h1.96l.54 4.52c.05.39-.07.78-.33 1.07-.22.26-.54.41-.95.41-.67 0-1.22-.59-1.22-1.31zM8.49 9.52 9.04 5H11v4.69c0 .72-.55 1.31-1.29 1.31-.34 0-.65-.15-.89-.41-.25-.29-.37-.68-.33-1.07m-4.45-.16L5.05 5h1.97l-.58 4.86c-.08.65-.6 1.14-1.21 1.14-.49 0-.8-.29-.93-.47-.27-.32-.36-.75-.26-1.17M5 19v-6.03c.08.01.15.03.23.03.87 0 1.66-.36 2.24-.95.6.6 1.4.95 2.31.95.87 0 1.65-.36 2.23-.93.59.57 1.39.93 2.29.93.84 0 1.64-.35 2.24-.95.58.59 1.37.95 2.24.95.08 0 .15-.02.23-.03V19z"}),"Storefront"),Me}var as=rs();const ns=Ze(as);var Re={},Ht;function is(){if(Ht)return Re;Ht=1;var t=Ke();Object.defineProperty(Re,"__esModule",{value:!0}),Re.default=void 0;var o=t(Je()),r=Qe();return Re.default=(0,o.default)((0,r.jsx)("path",{d:"M14 10H3v2h11zm0-4H3v2h11zm4 8v-4h-2v4h-4v2h4v4h2v-4h4v-2zM3 16h7v-2H3z"}),"PlaylistAdd"),Re}var ls=is();const ht=Ze(ls);var Te={},Ut;function cs(){if(Ut)return Te;Ut=1;var t=Ke();Object.defineProperty(Te,"__esModule",{value:!0}),Te.default=void 0;var o=t(Je()),r=Qe();return Te.default=(0,o.default)((0,r.jsx)("path",{d:"M12 2 4.5 20.29l.71.71L12 18l6.79 3 .71-.71z"}),"Navigation"),Te}var ds=cs();const us=Ze(ds);ft`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`;const mt=()=>e.jsxs(Vt,{sx:{mb:3,border:"1px solid #e0e0e0",boxShadow:"4px 4px 8px rgba(0,0,0,0.1)"},children:[e.jsx(qt,{avatar:e.jsx(B,{animation:"wave",variant:"circular",width:40,height:40}),title:e.jsx(B,{animation:"wave",height:20,width:"80%"}),sx:{backgroundColor:"grey.200"}}),e.jsxs(Gt,{sx:{flexGrow:1,display:"flex",flexDirection:"column",gap:1.5,pt:1},children:[e.jsx(B,{animation:"wave",height:15,width:"90%"}),e.jsx(B,{animation:"wave",height:15,width:"60%"}),e.jsx(B,{animation:"wave",height:15,width:"60%"}),e.jsx(B,{animation:"wave",height:15,width:"60%"})]}),e.jsxs(Xt,{sx:{justifyContent:"space-between",px:2,py:1.5,backgroundColor:"grey.50"},children:[e.jsx(B,{animation:"wave",variant:"circular",width:32,height:32}),e.jsx(B,{animation:"wave",variant:"rectangular",width:100,height:36})]})]}),ps=(t,o,r,i)=>{const p=t*Math.PI/180,h=r*Math.PI/180,f=(r-t)*Math.PI/180,x=(i-o)*Math.PI/180,k=Math.sin(f/2)*Math.sin(f/2)+Math.cos(p)*Math.cos(h)*Math.sin(x/2)*Math.sin(x/2);return 6371e3*(2*Math.atan2(Math.sqrt(k),Math.sqrt(1-k)))},hs=t=>t<500?`${Math.round(t)} meter`:`${(t/1e3).toFixed(1)} km`,ks=()=>{const t=Yt(),o=wo(t.breakpoints.down("sm")),r=a.useMemo(()=>({"Checked In":0,Planned:1,Completed:2,Canceled:3,Draft:4}),[]),{employeeId:i}=xo(),m=vo(),[p,h]=a.useState([]),[f,x]=a.useState(!0),[k,b]=a.useState(null),[P,U]=a.useState(0),[Y,W]=a.useState(!0),[re,ae]=a.useState(!1),[et,me]=a.useState(0),G=a.useRef(null),Ie=a.useCallback(s=>{re||(G.current&&G.current.disconnect(),G.current=new IntersectionObserver(n=>{n[0].isIntersecting&&Y&&U(d=>d+1)}),s&&G.current.observe(s))},[re,Y]),[X,ne]=a.useState(!1),[E,ie]=a.useState(null),D=a.useRef(null),M=a.useRef(null),[fe,tt]=a.useState(null),[K,ot]=a.useState(null),[g,Ee]=a.useState(null),[le,ce]=a.useState(!1),[de,z]=a.useState(null),[ge,gt]=a.useState([]),[Ae,Le]=a.useState(void 0),[st,J]=a.useState(!1),[ue,R]=a.useState({isOpen:!1,distance:0}),[A,L]=a.useState(!1),[N,Q]=a.useState(null),[xe,pe]=a.useState(null);a.useEffect(()=>{if(X&&xe){J(!1);const s=()=>{D.current?(D.current.srcObject=xe,J(!0)):(console.warn("DEBUG: videoRef.current is null in useEffect. Retrying..."),setTimeout(s,50))};s()}else X||J(!1)},[X,xe]);const j=a.useCallback(s=>s.sort((n,d)=>(r[n.status]??99)-(r[d.status]??99)),[r]),$=a.useCallback(async s=>{if(!i){b("Employee ID not available."),x(!1),ae(!1);return}s===0?x(!0):ae(!0);try{const n=await bo(s);if(n.error_message){b(n.error_message),W(!1),h([]);return}const d=n.data,u=n.total;s===0?(h(j(d)),me(u),W(d.length<u)):h(v=>{const T=[...v,...d],I=Array.from(new Map(T.map(w=>[w.name,w])).values()),S=j(I);return W(S.length<u),S}),b(null)}catch(n){console.error("Error fetching visit plans:",n),b(n instanceof Error?n.message:"Failed to fetch data."),W(!1)}finally{s===0&&x(!1),ae(!1)}},[i,j]);a.useEffect(()=>{i&&(h([]),U(0),W(!0),me(0),$(0))},[i,$]),a.useEffect(()=>{P>0&&$(P)},[P,$]);const rt=a.useCallback(s=>{if(s.parent_docstatus===0)return e.jsx(Ve,{title:s.parent,arrow:!0,children:e.jsx(je,{label:"Draft",color:"warning",size:"small",sx:{fontWeight:"bold"}})});let n="default",d=s.status;switch(s.status){case"Planned":n="primary";break;case"Checked In":n="secondary";break;case"Completed":n="success";break;case"Canceled":n="error";break;default:d="Draft",n="error";break}return e.jsx(Ve,{title:s.parent,arrow:!0,children:e.jsx(je,{label:d,color:n,size:"small",sx:{fontWeight:"bold"}})})},[]),Z=async s=>{try{await _t(s,"Checked In")?$(0):b("Failed to check-in.")}catch(n){b(n instanceof Error?n.message:"An unexpected error occurred during check-in.")}},Ne=async s=>{const n=p.find(u=>u.name===s);if(!n)return;ie(s),L(!0),Q(null);let d=null;try{const u=navigator.mediaDevices.getUserMedia({video:!0}),v=new Promise((w,O)=>{if(!navigator.geolocation)return O(new Error("Geolocation is not supported."));navigator.geolocation.getCurrentPosition(oe=>w(oe.coords),oe=>O(oe))}),[T,I]=await Promise.all([u,v]);d=T,pe(d),Ee(I);const S=await ct(n.store_name);if(S&&S.latitude&&S.longitude){const w=ps(S.latitude,S.longitude,I.latitude,I.longitude);if(w>5){L(!1),R({isOpen:!0,distance:w}),d&&d.getTracks().forEach(O=>O.stop()),pe(null);return}}L(!1),ne(!0)}catch(u){console.error("DEBUG: Error during pre-checkout validation:",u),console.error("DEBUG: Error during pre-checkout validation:",u),d&&d.getTracks().forEach(T=>T.stop()),pe(null);let v="Gagal mempersiapkan checkout. Pastikan izin lokasi dan kamera telah diberikan.";u instanceof GeolocationPositionError?u.code===u.PERMISSION_DENIED?v="Akses lokasi ditolak. Mohon aktifkan di pengaturan browser.":u.code===u.POSITION_UNAVAILABLE&&(v="Informasi lokasi tidak tersedia saat ini."):u instanceof Error&&u.name==="NotAllowedError"&&(v="Akses kamera ditolak. Mohon aktifkan di pengaturan browser."),Q(v),L(!1)}},ee=()=>{ne(!1),ie(null),J(!1)},at=a.useCallback(()=>{if(D.current&&M.current){const s=D.current,n=M.current;n.width=s.videoWidth,n.height=s.videoHeight;const d=n.getContext("2d");if(d){d.drawImage(s,0,0,s.videoWidth,s.videoHeight);const u=n.toDataURL("image/jpeg");tt(u),n.toBlob(v=>{v&&ot(new File([v],"captured_photo.jpeg",{type:"image/jpeg"}))},"image/jpeg")}}},[]),he=async()=>{if(!g||!E||!K){z("Pastikan foto sudah diambil dan lokasi tersedia."),ce(!1);return}try{await _t(E,"Completed",{latitude:g.latitude,longitude:g.longitude,photo_file:K,checkout_time:Ue().format("YYYY-MM-DD HH:mm:ss")})?(ee(),$(0)):z("Gagal menyelesaikan checkout.")}catch(s){z(s instanceof Error?s.message:"Terjadi error saat checkout.")}finally{ce(!1)}},ve=async()=>{R({isOpen:!1,distance:0});const s=p.find(n=>n.name===E);if(!(!s||!g))try{await Tt(s.store_name,g.latitude,g.longitude),window.location.reload()}catch{Q("Gagal memperbarui lokasi customer. Silakan coba lagi.")}},$e=a.useCallback(async()=>{if(!g||!E||!K){z("Pastikan foto sudah diambil dan lokasi tersedia.");return}ce(!0),z(null);try{const s=p.find(d=>d.name===E);if(!s)throw new Error("Data kunjungan tidak ditemukan.");await ct(s.store_name)||await Tt(s.store_name,g.latitude,g.longitude),await he()}catch(s){z(s instanceof Error?s.message:"Gagal memvalidasi lokasi."),ce(!1)}},[E,g,K,p]),be=async s=>{const n=await ct(s.store_name);if(n&&n.latitude&&n.longitude){const d=`https://www.google.com/maps/dir/?api=1&destination=${n.latitude},${n.longitude}`;window.open(d,"_blank")}else b(`Lokasi untuk customer ${s.store_name} tidak ditemukan.`)},te=a.useCallback((s,n)=>{if(!s)return"N/A";const d=Ue(s,"DD-MM-YYYY HH:mm:ss");if(!d.isValid())return"Invalid Date";if(n){const u=Ue(n,"DD-MM-YYYY HH:mm");if(u.isValid()&&d.isSame(u,"day"))return d.format("HH:mm")}return d.format("DD-MM-YYYY HH:mm")},[]);return e.jsxs(e.Fragment,{children:[e.jsxs(To,{maxWidth:"lg",sx:{mt:4,mb:4,width:"100%",overflowX:"hidden"},children:[e.jsx(y,{variant:"h4",component:"h1",gutterBottom:!0,align:"center",sx:{fontWeight:"bold"},children:"My Visit Schedule"}),e.jsx(F,{sx:{mb:2,textAlign:"right"},children:e.jsx(H,{variant:"contained",startIcon:e.jsx(ss,{}),onClick:()=>m("/history"),children:"History"})}),f&&P===0?e.jsxs(F,{children:[e.jsx(mt,{}),e.jsx(mt,{}),e.jsx(mt,{})]}):k?e.jsx(ut,{severity:"error",children:k}):p.length===0?e.jsx(ut,{severity:"info",sx:{mt:2},children:"No visit plans found."}):e.jsxs(F,{children:[p.map((s,n)=>e.jsxs(Vt,{sx:{mb:3,border:"1px solid #e0e0e0",boxShadow:"4px 4px 8px rgba(0,0,0,0.1)",width:o?"100%":"auto"},ref:p.length===n+1?Ie:null,children:[e.jsx(qt,{avatar:e.jsx(ns,{sx:{color:"primary.main",fontSize:40}}),title:e.jsx(y,{variant:"h6",sx:{fontWeight:"bold"},children:s.store_name}),subheader:e.jsx(y,{variant:"body2",color:"text.secondary",children:s.address}),sx:{backgroundColor:"grey.100",py:1.5}}),e.jsxs(Gt,{sx:{display:"flex",flexDirection:"column",gap:1.5,pt:1},children:[e.jsxs(F,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(je,{label:e.jsxs(F,{component:"span",children:["Planning :"," ",e.jsx(y,{component:"span",sx:{fontWeight:"bold",color:"#FFFFFF"},children:s.planned_visit_time?Ue(s.planned_visit_time,"DD-MM-YYYY HH:mm").format("DD-MM-YYYY HH:mm"):"N/A"})]}),color:"info",size:"small"}),rt(s)]}),e.jsx(je,{icon:e.jsx(ht,{}),label:`CheckIn: ${te(s.checkin_time,s.planned_visit_time)}`,variant:"outlined",size:"small"}),e.jsx(je,{icon:e.jsx(ht,{}),label:`CheckOut: ${te(s.checkout_time,s.planned_visit_time)}`,variant:"outlined",size:"small"}),s.notes&&e.jsxs(y,{variant:"body2",sx:{fontStyle:"italic",color:"text.secondary"},children:["Notes: ",s.notes]})]}),e.jsxs(Xt,{sx:{justifyContent:"space-between",px:2,py:1.5,backgroundColor:"grey.50"},children:[e.jsxs(F,{children:[e.jsx(St,{onClick:()=>be(s),"aria-label":"Navigate",children:e.jsx(Ve,{title:"Navigate to Customer",children:e.jsx(us,{sx:{color:"primary.main"}})})}),e.jsx(St,{onClick:()=>m(`/notes/${s.name}`),"aria-label":"Add Notes",children:e.jsx(Ve,{title:"Add Notes",children:e.jsx(ht,{})})})]}),e.jsxs(F,{children:[s.status==="Planned"&&e.jsx(H,{variant:"contained",color:"secondary",onClick:()=>Z(s.name),children:"Check In"}),s.status==="Checked In"&&e.jsx(H,{variant:"contained",color:"success",onClick:()=>Ne(s.name),children:"Check Out"})]})]})]},s.name)),re&&e.jsx(F,{sx:{display:"flex",justifyContent:"center",my:2},children:e.jsx(He,{})}),!Y&&e.jsx(y,{variant:"body2",align:"center",color:"text.secondary",sx:{my:2},children:"You have reached the end of the list."})]})]}),e.jsxs(Ye,{open:X,onClose:ee,fullWidth:!0,maxWidth:"sm",children:[e.jsx(pt,{children:"Complete Checkout"}),e.jsxs(We,{children:[de&&e.jsx(ut,{severity:"error",sx:{mb:2},children:de}),e.jsxs(F,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(y,{children:"Take Photo:"}),e.jsx("video",{ref:D,style:{width:"100%",border:"1px solid #ccc"},autoPlay:!0,playsInline:!0}),ge.length>1&&e.jsxs(Po,{fullWidth:!0,children:[e.jsx(Mo,{id:"camera-select-label",children:"Camera"}),e.jsx(Ro,{labelId:"camera-select-label",value:Ae||"",label:"Camera",onChange:s=>Le(s.target.value),children:ge.map(s=>e.jsx(jo,{value:s.deviceId,children:s.label},s.deviceId))})]}),e.jsx(H,{variant:"outlined",onClick:at,disabled:!st,children:"Capture Photo"}),fe&&e.jsx("img",{src:fe,alt:"Captured",style:{width:"100%",border:"1px solid #ccc"}}),e.jsx("canvas",{ref:M,style:{display:"none"}}),e.jsx(y,{children:"Current Location:"}),g?e.jsxs(y,{children:["Lat: ",g.latitude.toFixed(6),", Lng: ",g.longitude.toFixed(6)]}):e.jsx(He,{size:20})]})]}),e.jsxs(dt,{children:[e.jsx(H,{onClick:ee,disabled:le,children:"Cancel"}),e.jsx(H,{onClick:$e,disabled:le||!fe||!g,variant:"contained",children:le?e.jsx(He,{size:24,color:"inherit"}):"Complete Checkout"})]})]}),e.jsxs(Ye,{open:ue.isOpen,onClose:()=>R({isOpen:!1,distance:0}),children:[e.jsx(pt,{children:"Lokasi Terlalu Jauh"}),e.jsx(We,{children:e.jsxs(It,{children:["Lokasi Anda berjarak sekitar ",e.jsx(y,{component:"span",sx:{fontWeight:"bold"},children:hs(ue.distance)})," dari lokasi customer.",e.jsx("br",{}),e.jsx("br",{}),"Apakah Anda ingin memperbarui lokasi customer dengan lokasi Anda saat ini? Atau silahkan berjalan lagi untuk mendapatkan lokasi yang sesuai."]})}),e.jsxs(dt,{children:[e.jsx(H,{onClick:()=>window.location.reload(),children:"Refresh"}),e.jsx(H,{onClick:ve,variant:"contained",autoFocus:!0,children:"Ya, Update Lokasi"})]})]}),e.jsx(Ye,{open:A,children:e.jsxs(We,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(He,{}),e.jsx(y,{children:"Mempersiapkan checkout..."})]})}),e.jsxs(Ye,{open:!!N,onClose:()=>Q(null),children:[e.jsx(pt,{children:"Error"}),e.jsx(We,{children:e.jsx(It,{children:N})}),e.jsx(dt,{children:e.jsx(H,{onClick:()=>Q(null),children:"Tutup"})})]})]})};export{ks as default};
