import{g as Qe,a as Ze,r as a,u as Ee,_ as Ae,b as d,j as t,s as oe,c as q,d as Le,T,e as mt,k as et,h as Xt,i as Kt,m as De,n as Jt,o as Qt,p as ft,q as Zt,t as eo,v as to,w as Re,x as oo,y as Pt,z as Mt,A as Tt,D as Dt,E as Rt,F as _t,G as so,H as ro,I as no,J as ao,K as gt,B as N,L as io,M as lo,C as qe}from"./index-BjvWCnAC.js";import{D as co,g as uo,a as po,P as It,h as ee,C as ge,b as ho,c as mo,M as fo,d as go}from"./moment-D5z9kXdA.js";import{G as xt,F as xo,I as vo,S as bo}from"./Select-BJfbsC0o.js";import{C as Co}from"./Container-f55930So.js";import{B as te}from"./Button-BiJ5JBWX.js";import{A as Ge}from"./Alert-BuFAByuz.js";import{C as St,a as Et,b as At}from"./CardHeader-GwaMxkh-.js";function yo(o){return String(o).match(/[\d.\-+]*\s*(.*)/)[1]||""}function wo(o){return parseFloat(o)}function jo(o){return Qe("MuiCardActions",o)}Ze("MuiCardActions",["root","spacing"]);const ko=["disableSpacing","className"],Po=o=>{const{classes:s,disableSpacing:n}=o;return Le({root:["root",!n&&"spacing"]},jo,s)},Mo=oe("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(o,s)=>{const{ownerState:n}=o;return[s.root,!n.disableSpacing&&s.spacing]}})(({ownerState:o})=>d({display:"flex",alignItems:"center",padding:8},!o.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})),Lt=a.forwardRef(function(s,n){const l=Ee({props:s,name:"MuiCardActions"}),{disableSpacing:u=!1,className:m}=l,h=Ae(l,ko),g=d({},l,{disableSpacing:u}),f=Po(g);return t.jsx(Mo,d({className:q(f.root,m),ownerState:g,ref:n},h))}),To=["className","id"],Do=o=>{const{classes:s}=o;return Le({root:["root"]},uo,s)},Ro=oe(T,{name:"MuiDialogTitle",slot:"Root",overridesResolver:(o,s)=>s.root})({padding:"16px 24px",flex:"0 0 auto"}),_o=a.forwardRef(function(s,n){const l=Ee({props:s,name:"MuiDialogTitle"}),{className:u,id:m}=l,h=Ae(l,To),g=l,f=Do(g),{titleId:x=m}=a.useContext(co);return t.jsx(Ro,d({component:"h2",className:q(f.root,u),ownerState:g,ref:n,variant:"h6",id:m??x},h))});function Io(o){return Qe("MuiSkeleton",o)}Ze("MuiSkeleton",["root","text","rectangular","rounded","circular","pulse","wave","withChildren","fitContent","heightAuto"]);const So=["animation","className","component","height","style","variant","width"];let Se=o=>o,vt,bt,Ct,yt;const Eo=o=>{const{classes:s,variant:n,animation:l,hasChildren:u,width:m,height:h}=o;return Le({root:["root",n,l,u&&"withChildren",u&&!m&&"fitContent",u&&!h&&"heightAuto"]},Io,s)},Ao=et(vt||(vt=Se`
  0% {
    opacity: 1;
  }

  50% {
    opacity: 0.4;
  }

  100% {
    opacity: 1;
  }
`)),Lo=et(bt||(bt=Se`
  0% {
    transform: translateX(-100%);
  }

  50% {
    /* +0.5s of delay between each loop */
    transform: translateX(100%);
  }

  100% {
    transform: translateX(100%);
  }
`)),$o=oe("span",{name:"MuiSkeleton",slot:"Root",overridesResolver:(o,s)=>{const{ownerState:n}=o;return[s.root,s[n.variant],n.animation!==!1&&s[n.animation],n.hasChildren&&s.withChildren,n.hasChildren&&!n.width&&s.fitContent,n.hasChildren&&!n.height&&s.heightAuto]}})(({theme:o,ownerState:s})=>{const n=yo(o.shape.borderRadius)||"px",l=wo(o.shape.borderRadius);return d({display:"block",backgroundColor:o.vars?o.vars.palette.Skeleton.bg:po(o.palette.text.primary,o.palette.mode==="light"?.11:.13),height:"1.2em"},s.variant==="text"&&{marginTop:0,marginBottom:0,height:"auto",transformOrigin:"0 55%",transform:"scale(1, 0.60)",borderRadius:`${l}${n}/${Math.round(l/.6*10)/10}${n}`,"&:empty:before":{content:'"\\00a0"'}},s.variant==="circular"&&{borderRadius:"50%"},s.variant==="rounded"&&{borderRadius:(o.vars||o).shape.borderRadius},s.hasChildren&&{"& > *":{visibility:"hidden"}},s.hasChildren&&!s.width&&{maxWidth:"fit-content"},s.hasChildren&&!s.height&&{height:"auto"})},({ownerState:o})=>o.animation==="pulse"&&mt(Ct||(Ct=Se`
      animation: ${0} 2s ease-in-out 0.5s infinite;
    `),Ao),({ownerState:o,theme:s})=>o.animation==="wave"&&mt(yt||(yt=Se`
      position: relative;
      overflow: hidden;

      /* Fix bug in Safari https://bugs.webkit.org/show_bug.cgi?id=68196 */
      -webkit-mask-image: -webkit-radial-gradient(white, black);

      &::after {
        animation: ${0} 2s linear 0.5s infinite;
        background: linear-gradient(
          90deg,
          transparent,
          ${0},
          transparent
        );
        content: '';
        position: absolute;
        transform: translateX(-100%); /* Avoid flash during server-side hydration */
        bottom: 0;
        left: 0;
        right: 0;
        top: 0;
      }
    `),Lo,(s.vars||s).palette.action.hover)),F=a.forwardRef(function(s,n){const l=Ee({props:s,name:"MuiSkeleton"}),{animation:u="pulse",className:m,component:h="span",height:g,style:f,variant:x="text",width:E}=l,P=Ae(l,So),C=d({},l,{animation:u,component:h,variant:x,hasChildren:!!P.children}),A=Eo(C);return t.jsx($o,d({as:h,ref:n,className:q(A.root,m),ownerState:C},P,{style:d({width:E,height:g},f)}))});function Oo(o){return Qe("MuiTooltip",o)}const H=Ze("MuiTooltip",["popper","popperInteractive","popperArrow","popperClose","tooltip","tooltipArrow","touch","tooltipPlacementLeft","tooltipPlacementRight","tooltipPlacementTop","tooltipPlacementBottom","arrow"]),No=["arrow","children","classes","components","componentsProps","describeChild","disableFocusListener","disableHoverListener","disableInteractive","disableTouchListener","enterDelay","enterNextDelay","enterTouchDelay","followCursor","id","leaveDelay","leaveTouchDelay","onClose","onOpen","open","placement","PopperComponent","PopperProps","slotProps","slots","title","TransitionComponent","TransitionProps"];function Fo(o){return Math.round(o*1e5)/1e5}const Ho=o=>{const{classes:s,disableInteractive:n,arrow:l,touch:u,placement:m}=o,h={popper:["popper",!n&&"popperInteractive",l&&"popperArrow"],tooltip:["tooltip",l&&"tooltipArrow",u&&"touch",`tooltipPlacement${Pt(m.split("-")[0])}`],arrow:["arrow"]};return Le(h,Oo,s)},Yo=oe(It,{name:"MuiTooltip",slot:"Popper",overridesResolver:(o,s)=>{const{ownerState:n}=o;return[s.popper,!n.disableInteractive&&s.popperInteractive,n.arrow&&s.popperArrow,!n.open&&s.popperClose]}})(({theme:o,ownerState:s,open:n})=>d({zIndex:(o.vars||o).zIndex.tooltip,pointerEvents:"none"},!s.disableInteractive&&{pointerEvents:"auto"},!n&&{pointerEvents:"none"},s.arrow&&{[`&[data-popper-placement*="bottom"] .${H.arrow}`]:{top:0,marginTop:"-0.71em","&::before":{transformOrigin:"0 100%"}},[`&[data-popper-placement*="top"] .${H.arrow}`]:{bottom:0,marginBottom:"-0.71em","&::before":{transformOrigin:"100% 0"}},[`&[data-popper-placement*="right"] .${H.arrow}`]:d({},s.isRtl?{right:0,marginRight:"-0.71em"}:{left:0,marginLeft:"-0.71em"},{height:"1em",width:"0.71em","&::before":{transformOrigin:"100% 100%"}}),[`&[data-popper-placement*="left"] .${H.arrow}`]:d({},s.isRtl?{left:0,marginLeft:"-0.71em"}:{right:0,marginRight:"-0.71em"},{height:"1em",width:"0.71em","&::before":{transformOrigin:"0 0"}})})),Uo=oe("div",{name:"MuiTooltip",slot:"Tooltip",overridesResolver:(o,s)=>{const{ownerState:n}=o;return[s.tooltip,n.touch&&s.touch,n.arrow&&s.tooltipArrow,s[`tooltipPlacement${Pt(n.placement.split("-")[0])}`]]}})(({theme:o,ownerState:s})=>d({backgroundColor:o.vars?o.vars.palette.Tooltip.bg:Mt.alpha(o.palette.grey[700],.92),borderRadius:(o.vars||o).shape.borderRadius,color:(o.vars||o).palette.common.white,fontFamily:o.typography.fontFamily,padding:"4px 8px",fontSize:o.typography.pxToRem(11),maxWidth:300,margin:2,wordWrap:"break-word",fontWeight:o.typography.fontWeightMedium},s.arrow&&{position:"relative",margin:0},s.touch&&{padding:"8px 16px",fontSize:o.typography.pxToRem(14),lineHeight:`${Fo(16/14)}em`,fontWeight:o.typography.fontWeightRegular},{[`.${H.popper}[data-popper-placement*="left"] &`]:d({transformOrigin:"right center"},s.isRtl?d({marginLeft:"14px"},s.touch&&{marginLeft:"24px"}):d({marginRight:"14px"},s.touch&&{marginRight:"24px"})),[`.${H.popper}[data-popper-placement*="right"] &`]:d({transformOrigin:"left center"},s.isRtl?d({marginRight:"14px"},s.touch&&{marginRight:"24px"}):d({marginLeft:"14px"},s.touch&&{marginLeft:"24px"})),[`.${H.popper}[data-popper-placement*="top"] &`]:d({transformOrigin:"center bottom",marginBottom:"14px"},s.touch&&{marginBottom:"24px"}),[`.${H.popper}[data-popper-placement*="bottom"] &`]:d({transformOrigin:"center top",marginTop:"14px"},s.touch&&{marginTop:"24px"})})),Bo=oe("span",{name:"MuiTooltip",slot:"Arrow",overridesResolver:(o,s)=>s.arrow})(({theme:o})=>({overflow:"hidden",position:"absolute",width:"1em",height:"0.71em",boxSizing:"border-box",color:o.vars?o.vars.palette.Tooltip.bg:Mt.alpha(o.palette.grey[700],.9),"&::before":{content:'""',margin:"auto",display:"block",width:"100%",height:"100%",backgroundColor:"currentColor",transform:"rotate(45deg)"}}));let _e=!1;const wt=new oo;let xe={x:0,y:0};function Ie(o,s){return(n,...l)=>{s&&s(n,...l),o(n,...l)}}const Xe=a.forwardRef(function(s,n){var l,u,m,h,g,f,x,E,P,C,A,G,$e,se,Y,Ce,X,re,U;const K=Ee({props:s,name:"MuiTooltip"}),{arrow:y=!1,children:B,components:L={},componentsProps:M={},describeChild:ne=!1,disableFocusListener:ye=!1,disableHoverListener:v=!1,disableInteractive:Oe=!1,disableTouchListener:ae=!1,enterDelay:D=100,enterNextDelay:ie=0,enterTouchDelay:w=700,followCursor:J=!1,id:Ne,leaveDelay:j=0,leaveTouchDelay:we=1500,onClose:le,onOpen:Q,open:ce,placement:R="bottom",PopperComponent:de,PopperProps:_={},slotProps:I={},slots:$={},title:O,TransitionComponent:Fe=xt,TransitionProps:je}=K,ue=Ae(K,No),e=a.isValidElement(B)?B:t.jsx("span",{children:B}),r=Xt(),i=Kt(),[p,W]=a.useState(),[z,He]=a.useState(null),V=a.useRef(!1),Z=Oe||J,tt=De(),Ye=De(),ke=De(),ot=De(),[$t,st]=Jt({controlled:ce,default:!1,name:"Tooltip",state:"open"});let S=$t;const Ue=Qt(Ne),pe=a.useRef(),Pe=ft(()=>{pe.current!==void 0&&(document.body.style.WebkitUserSelect=pe.current,pe.current=void 0),ot.clear()});a.useEffect(()=>Pe,[Pe]);const rt=c=>{wt.clear(),_e=!0,st(!0),Q&&!S&&Q(c)},Me=ft(c=>{wt.start(800+j,()=>{_e=!1}),st(!1),le&&S&&le(c),tt.start(r.transitions.duration.shortest,()=>{V.current=!1})}),Te=c=>{V.current&&c.type!=="touchstart"||(p&&p.removeAttribute("title"),Ye.clear(),ke.clear(),D||_e&&ie?Ye.start(_e?ie:D,()=>{rt(c)}):rt(c))},Be=c=>{Ye.clear(),ke.start(j,()=>{Me(c)})},{isFocusVisibleRef:nt,onBlur:Ot,onFocus:Nt,ref:Ft}=Zt(),[,at]=a.useState(!1),it=c=>{Ot(c),nt.current===!1&&(at(!1),Be(c))},lt=c=>{p||W(c.currentTarget),Nt(c),nt.current===!0&&(at(!0),Te(c))},ct=c=>{V.current=!0;const b=e.props;b.onTouchStart&&b.onTouchStart(c)},Ht=c=>{ct(c),ke.clear(),tt.clear(),Pe(),pe.current=document.body.style.WebkitUserSelect,document.body.style.WebkitUserSelect="none",ot.start(w,()=>{document.body.style.WebkitUserSelect=pe.current,Te(c)})},Yt=c=>{e.props.onTouchEnd&&e.props.onTouchEnd(c),Pe(),ke.start(we,()=>{Me(c)})};a.useEffect(()=>{if(!S)return;function c(b){(b.key==="Escape"||b.key==="Esc")&&Me(b)}return document.addEventListener("keydown",c),()=>{document.removeEventListener("keydown",c)}},[Me,S]);const Ut=eo(to(e),Ft,W,n);!O&&O!==0&&(S=!1);const We=a.useRef(),Bt=c=>{const b=e.props;b.onMouseMove&&b.onMouseMove(c),xe={x:c.clientX,y:c.clientY},We.current&&We.current.update()},he={},ze=typeof O=="string";ne?(he.title=!S&&ze&&!v?O:null,he["aria-describedby"]=S?Ue:null):(he["aria-label"]=ze?O:null,he["aria-labelledby"]=S&&!ze?Ue:null);const k=d({},he,ue,e.props,{className:q(ue.className,e.props.className),onTouchStart:ct,ref:Ut},J?{onMouseMove:Bt}:{}),me={};ae||(k.onTouchStart=Ht,k.onTouchEnd=Yt),v||(k.onMouseOver=Ie(Te,k.onMouseOver),k.onMouseLeave=Ie(Be,k.onMouseLeave),Z||(me.onMouseOver=Te,me.onMouseLeave=Be)),ye||(k.onFocus=Ie(lt,k.onFocus),k.onBlur=Ie(it,k.onBlur),Z||(me.onFocus=lt,me.onBlur=it));const Wt=a.useMemo(()=>{var c;let b=[{name:"arrow",enabled:!!z,options:{element:z,padding:4}}];return(c=_.popperOptions)!=null&&c.modifiers&&(b=b.concat(_.popperOptions.modifiers)),d({},_.popperOptions,{modifiers:b})},[z,_]),fe=d({},K,{isRtl:i,arrow:y,disableInteractive:Z,placement:R,PopperComponentProp:de,touch:V.current}),Ve=Ho(fe),dt=(l=(u=$.popper)!=null?u:L.Popper)!=null?l:Yo,ut=(m=(h=(g=$.transition)!=null?g:L.Transition)!=null?h:Fe)!=null?m:xt,pt=(f=(x=$.tooltip)!=null?x:L.Tooltip)!=null?f:Uo,ht=(E=(P=$.arrow)!=null?P:L.Arrow)!=null?E:Bo,zt=Re(dt,d({},_,(C=I.popper)!=null?C:M.popper,{className:q(Ve.popper,_==null?void 0:_.className,(A=(G=I.popper)!=null?G:M.popper)==null?void 0:A.className)}),fe),Vt=Re(ut,d({},je,($e=I.transition)!=null?$e:M.transition),fe),qt=Re(pt,d({},(se=I.tooltip)!=null?se:M.tooltip,{className:q(Ve.tooltip,(Y=(Ce=I.tooltip)!=null?Ce:M.tooltip)==null?void 0:Y.className)}),fe),Gt=Re(ht,d({},(X=I.arrow)!=null?X:M.arrow,{className:q(Ve.arrow,(re=(U=I.arrow)!=null?U:M.arrow)==null?void 0:re.className)}),fe);return t.jsxs(a.Fragment,{children:[a.cloneElement(e,k),t.jsx(dt,d({as:de??It,placement:R,anchorEl:J?{getBoundingClientRect:()=>({top:xe.y,left:xe.x,right:xe.x,bottom:xe.y,width:0,height:0})}:p,popperRef:We,open:p?S:!1,id:Ue,transition:!0},me,zt,{popperOptions:Wt,children:({TransitionProps:c})=>t.jsx(ut,d({timeout:r.transitions.duration.shorter},c,Vt,{children:t.jsxs(pt,d({},qt,{children:[O,y?t.jsx(ht,d({},Gt,{ref:He})):null]}))}))}))]})});var ve={},jt;function Wo(){if(jt)return ve;jt=1;var o=Tt();Object.defineProperty(ve,"__esModule",{value:!0}),ve.default=void 0;var s=o(Dt()),n=Rt();return ve.default=(0,s.default)((0,n.jsx)("path",{d:"m21.9 8.89-1.05-4.37c-.22-.9-1-1.52-1.91-1.52H5.05c-.9 0-1.69.63-1.9 1.52L2.1 8.89c-.24 1.02-.02 2.06.62 2.88.08.11.19.19.28.29V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-6.94c.09-.09.2-.18.28-.28.64-.82.87-1.87.62-2.89m-2.99-3.9 1.05 4.37c.1.42.01.84-.25 1.17-.14.18-.44.47-.94.47-.61 0-1.14-.49-1.21-1.14L16.98 5zM13 5h1.96l.54 4.52c.05.39-.07.78-.33 1.07-.22.26-.54.41-.95.41-.67 0-1.22-.59-1.22-1.31zM8.49 9.52 9.04 5H11v4.69c0 .72-.55 1.31-1.29 1.31-.34 0-.65-.15-.89-.41-.25-.29-.37-.68-.33-1.07m-4.45-.16L5.05 5h1.97l-.58 4.86c-.08.65-.6 1.14-1.21 1.14-.49 0-.8-.29-.93-.47-.27-.32-.36-.75-.26-1.17M5 19v-6.03c.08.01.15.03.23.03.87 0 1.66-.36 2.24-.95.6.6 1.4.95 2.31.95.87 0 1.65-.36 2.23-.93.59.57 1.39.93 2.29.93.84 0 1.64-.35 2.24-.95.58.59 1.37.95 2.24.95.08 0 .15-.02.23-.03V19z"}),"Storefront"),ve}var zo=Wo();const Vo=_t(zo);var be={},kt;function qo(){if(kt)return be;kt=1;var o=Tt();Object.defineProperty(be,"__esModule",{value:!0}),be.default=void 0;var s=o(Dt()),n=Rt();return be.default=(0,s.default)((0,n.jsx)("path",{d:"M14 10H3v2h11zm0-4H3v2h11zm4 8v-4h-2v4h-4v2h4v4h2v-4h4v-2zM3 16h7v-2H3z"}),"PlaylistAdd"),be}var Go=qo();const Ke=_t(Go);et`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`;const Je=()=>t.jsxs(St,{sx:{mb:3,border:"1px solid #e0e0e0",boxShadow:"4px 4px 8px rgba(0,0,0,0.1)"},children:[t.jsx(Et,{avatar:t.jsx(F,{animation:"wave",variant:"circular",width:40,height:40}),title:t.jsx(F,{animation:"wave",height:20,width:"80%"}),sx:{backgroundColor:"grey.200"}}),t.jsxs(At,{sx:{flexGrow:1,display:"flex",flexDirection:"column",gap:1.5,pt:1},children:[t.jsx(F,{animation:"wave",height:15,width:"90%"}),t.jsx(F,{animation:"wave",height:15,width:"60%"}),t.jsx(F,{animation:"wave",height:15,width:"60%"}),t.jsx(F,{animation:"wave",height:15,width:"60%"})]}),t.jsxs(Lt,{sx:{justifyContent:"space-between",px:2,py:1.5,backgroundColor:"grey.50"},children:[t.jsx(F,{animation:"wave",variant:"circular",width:32,height:32}),t.jsx(F,{animation:"wave",variant:"rectangular",width:100,height:36})]})]}),Xo=(o,s,n,l)=>{const m=o*Math.PI/180,h=n*Math.PI/180,g=(n-o)*Math.PI/180,f=(l-s)*Math.PI/180,x=Math.sin(g/2)*Math.sin(g/2)+Math.cos(m)*Math.cos(h)*Math.sin(f/2)*Math.sin(f/2);return 6371e3*(2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x)))},ss=()=>{var ue;const o=a.useMemo(()=>({"Checked In":0,Planned:1,Completed:2,Canceled:3,Draft:4}),[]),{employeeId:s}=so(),n=ro(),[l,u]=a.useState([]),[m,h]=a.useState(!0),[g,f]=a.useState(null),[x,E]=a.useState(0),[P,C]=a.useState(!0),[A,G]=a.useState(!1),[$e,se]=a.useState(0),Y=a.useRef(null),Ce=a.useCallback(e=>{A||(Y.current&&Y.current.disconnect(),Y.current=new IntersectionObserver(r=>{r[0].isIntersecting&&P&&E(i=>i+1)}),e&&Y.current.observe(e))},[A,P]),[X,re]=a.useState(!1),[U,K]=a.useState(null),y=a.useRef(null),B=a.useRef(null),[L,M]=a.useState(null),[ne,ye]=a.useState(null),[v,Oe]=a.useState(null),[ae,D]=a.useState(!1),[ie,w]=a.useState(null),[J,Ne]=a.useState([]),[j,we]=a.useState(void 0),le=a.useCallback(async()=>{try{const r=(await navigator.mediaDevices.enumerateDevices()).filter(i=>i.kind==="videoinput");Ne(r),r.length>0&&!j&&we(r[0].deviceId)}catch(e){console.error("Error enumerating devices:",e)}},[j]),Q=a.useCallback(async()=>{if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)try{const e=await navigator.mediaDevices.getUserMedia({video:{deviceId:j?{exact:j}:void 0}});y.current&&(y.current.srcObject=e)}catch(e){console.error("Camera access denied:",e),w("Camera access is required. Please enable it in your browser settings.")}},[j]);a.useEffect(()=>{X&&le()},[X,le]),a.useEffect(()=>{j&&Q()},[j,Q]);const ce=a.useCallback(e=>e.sort((r,i)=>(o[r.status]??99)-(o[i.status]??99)),[o]),R=a.useCallback(async e=>{if(!s){f("Employee ID not available."),h(!1),G(!1);return}e===0?h(!0):G(!0);try{const r=await no(e);if(r.error_message){f(r.error_message),C(!1),u([]);return}const i=r.data,p=r.total;e===0?(u(ce(i)),se(p),C(i.length<p)):u(W=>{const z=[...W,...i],He=Array.from(new Map(z.map(Z=>[Z.name,Z])).values()),V=ce(He);return C(V.length<p),V}),f(null)}catch(r){console.error("Error fetching visit plans:",r),f(r instanceof Error?r.message:"Failed to fetch data."),C(!1)}finally{e===0&&h(!1),G(!1)}},[s,ce]);a.useEffect(()=>{s&&(u([]),E(0),C(!0),se(0),R(0))},[s,R]),a.useEffect(()=>{x>0&&R(x)},[x,R]),a.useEffect(()=>{l.forEach(e=>{e.checkout_time&&console.log(`DEBUG: Plan ${e.name} Checkout Time: ${ee(e.checkout_time,"DD/MM/YY HH:mm:ss").isValid()}`)})},[l]);const de=a.useCallback(e=>{if(e.parent_docstatus===0)return t.jsx(Xe,{title:e.parent,arrow:!0,children:t.jsx(ge,{label:"Draft",color:"warning",size:"small",sx:{fontWeight:"bold"}})});let r="default",i=e.status;switch(e.status){case"Planned":r="primary";break;case"Checked In":r="secondary";break;case"Completed":r="success";break;case"Canceled":r="error";break;default:i="Draft",r="error";break}return t.jsx(Xe,{title:e.parent,arrow:!0,children:t.jsx(ge,{label:i,color:r,size:"small",sx:{fontWeight:"bold"}})})},[]),_=async e=>{try{await gt(e,"Checked In")?R(0):f("Failed to check-in.")}catch(r){f(r instanceof Error?r.message:"An unexpected error occurred during check-in.")}},I=e=>{const r=l.find(i=>i.name===e);r&&r.checkin_time&&(ee(r.checkin_time,"DD-MM-YYYY HH:mm:ss").toDate().getTime(),new Date().getTime()),K(e),re(!0),M(null),ye(null),w(null),Q(),navigator.geolocation?navigator.geolocation.getCurrentPosition(i=>{Oe({latitude:i.coords.latitude,longitude:i.coords.longitude})},i=>{console.error("Location access denied:",i);let p="Location access is required.";i instanceof GeolocationPositionError?i.code===i.PERMISSION_DENIED?p+=" Please enable it in your browser settings.":i.code===i.POSITION_UNAVAILABLE?p+=" Location information is unavailable.":i.code===i.TIMEOUT&&(p+=" The request to get user location timed out."):p+=" An unknown error occurred.",w(p)}):w("Geolocation is not supported by your browser.")},$=()=>{var e;re(!1),K(null),(e=y.current)!=null&&e.srcObject&&y.current.srcObject.getTracks().forEach(r=>r.stop())},O=a.useCallback(()=>{if(y.current&&B.current){const e=y.current,r=B.current;r.width=e.videoWidth,r.height=e.videoHeight;const i=r.getContext("2d");if(i){i.drawImage(e,0,0,e.videoWidth,e.videoHeight);const p=r.toDataURL("image/jpeg");M(p),r.toBlob(W=>{if(W){const z=new File([W],"captured_photo.jpeg",{type:"image/jpeg"});ye(z)}},"image/jpeg")}}},[]),Fe=a.useCallback(async()=>{if(!v||!U||!ne){w("Please ensure a photo has been taken and location is available.");return}D(!0),w(null);try{const e=l.find(i=>i.name===U);if(!e)throw new Error("Could not find current visit plan details.");const r=await ao(e.store_name);if(r&&r.latitude&&r.longitude){const i=Xo(r.latitude,r.longitude,v.latitude,v.longitude);if(i>10){w(`Check-out Gagal. Lokasi Anda (berjarak ${Math.round(i)} meter) terlalu jauh dari lokasi master. Batas yang diizinkan adalah 10 meter.`),D(!1);return}}}catch(e){console.error("Error during master location check:",e)}try{await gt(U,"Completed",{latitude:v.latitude,longitude:v.longitude,photo_file:ne,checkout_time:ee().format("YYYY-MM-DD HH:mm:ss")})?(D(!1),$(),R(0)):(D(!1),w("Failed to complete checkout."))}catch(e){D(!1),w(e instanceof Error?e.message:"An unexpected error occurred during checkout.")}finally{D(!1)}},[U,v,ne,l]),je=a.useCallback((e,r)=>{if(!e)return"N/A";const i=ee(e,"DD-MM-YYYY HH:mm:ss");if(!i.isValid())return"Invalid Date";if(r){const p=ee(r,"DD-MM-YYYY HH:mm");if(p.isValid()&&i.isSame(p,"day"))return i.format("HH:mm")}return i.format("DD-MM-YYYY HH:mm")},[]);return t.jsxs(t.Fragment,{children:[t.jsxs(Co,{maxWidth:"lg",sx:{mt:4,mb:4},children:[t.jsx(T,{variant:"h4",component:"h1",gutterBottom:!0,align:"center",sx:{fontWeight:"bold"},children:"My Visit Schedule"}),t.jsx(N,{sx:{mb:2,textAlign:"right"},children:t.jsx(te,{variant:"contained",startIcon:t.jsx(io,{}),onClick:()=>n("/history"),children:"History"})}),m&&x===0?t.jsxs(N,{children:[t.jsx(Je,{}),t.jsx(Je,{}),t.jsx(Je,{})]}):g?t.jsx(Ge,{severity:"error",children:g}):l.length===0?t.jsx(Ge,{severity:"info",sx:{mt:2},children:"No visit plans found."}):t.jsxs(N,{children:[l.map((e,r)=>t.jsxs(St,{sx:{mb:3,border:"1px solid #e0e0e0",boxShadow:"4px 4px 8px rgba(0,0,0,0.1)"},ref:l.length===r+1?Ce:null,children:[t.jsx(Et,{avatar:t.jsx(Vo,{sx:{color:"primary.main",fontSize:40}}),title:t.jsx(T,{variant:"h6",sx:{fontWeight:"bold"},children:e.store_name}),subheader:t.jsx(T,{variant:"body2",color:"text.secondary",children:e.address}),sx:{backgroundColor:"grey.100",py:1.5}}),t.jsxs(At,{sx:{display:"flex",flexDirection:"column",gap:1.5,pt:1},children:[t.jsxs(N,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(ge,{label:t.jsxs(N,{component:"span",children:["Planning :"," ",t.jsx(T,{component:"span",sx:{fontWeight:"bold",color:"#FFFFFF"},children:e.planned_visit_time?ee(e.planned_visit_time,"DD-MM-YYYY HH:mm").format("DD-MM-YYYY HH:mm"):"N/A"})]}),color:"info",size:"small"}),de(e)]}),t.jsx(ge,{icon:t.jsx(Ke,{}),label:`CheckIn: ${je(e.checkin_time,e.planned_visit_time)}`,variant:"outlined",size:"small"}),t.jsx(ge,{icon:t.jsx(Ke,{}),label:`CheckOut: ${je(e.checkout_time,e.planned_visit_time)}`,variant:"outlined",size:"small"}),e.notes&&t.jsxs(T,{variant:"body2",sx:{fontStyle:"italic",color:"text.secondary"},children:["Notes: ",e.notes]})]}),t.jsxs(Lt,{sx:{justifyContent:"space-between",px:2,py:1.5,backgroundColor:"grey.50"},children:[t.jsx(lo,{onClick:()=>n(`/notes/${e.name}`),"aria-label":"Add Notes",children:t.jsx(Xe,{title:"Add Notes",children:t.jsx(Ke,{sx:{color:"primary.main"}})})}),t.jsxs(N,{children:[e.status==="Planned"&&t.jsx(te,{variant:"contained",color:"secondary",onClick:()=>_(e.name),children:"Check In"}),e.status==="Checked In"&&t.jsx(te,{variant:"contained",color:"success",onClick:()=>I(e.name),children:"Check Out"})]})]})]},e.name)),A&&t.jsx(N,{sx:{display:"flex",justifyContent:"center",my:2},children:t.jsx(qe,{})}),!P&&t.jsx(T,{variant:"body2",align:"center",color:"text.secondary",sx:{my:2},children:"You have reached the end of the list."})]})]}),t.jsxs(ho,{open:X,onClose:$,fullWidth:!0,maxWidth:"sm",children:[t.jsx(_o,{children:"Complete Checkout"}),t.jsxs(mo,{children:[ie&&t.jsx(Ge,{severity:"error",sx:{mb:2},children:ie}),t.jsxs(N,{sx:{display:"flex",flexDirection:"column",gap:2},children:[t.jsx(T,{children:"Take Photo:"}),t.jsx("video",{ref:y,style:{width:"100%",border:"1px solid #ccc"},autoPlay:!0,playsInline:!0}),J.length>1&&t.jsxs(xo,{fullWidth:!0,children:[t.jsx(vo,{id:"camera-select-label",children:"Camera"}),t.jsx(bo,{labelId:"camera-select-label",value:j||"",label:"Camera",onChange:e=>we(e.target.value),children:J.map(e=>t.jsx(fo,{value:e.deviceId,children:e.label},e.deviceId))})]}),t.jsx(te,{variant:"outlined",onClick:O,disabled:!((ue=y.current)!=null&&ue.srcObject),children:"Capture Photo"}),L&&t.jsx("img",{src:L,alt:"Captured",style:{width:"100%",border:"1px solid #ccc"}}),t.jsx("canvas",{ref:B,style:{display:"none"}}),t.jsx(T,{children:"Current Location:"}),v?t.jsxs(T,{children:["Lat: ",v.latitude.toFixed(6),", Lng: ",v.longitude.toFixed(6)]}):t.jsx(qe,{size:20})]})]}),t.jsxs(go,{children:[t.jsx(te,{onClick:$,disabled:ae,children:"Cancel"}),t.jsx(te,{onClick:Fe,disabled:ae||!L||!v,variant:"contained",children:ae?t.jsx(qe,{size:24,color:"inherit"}):"Complete Checkout"})]})]})]})};export{ss as default};
