import{g as Be,a as ze,r as a,u as Ve,_ as qe,b as d,j as e,s as me,c as re,d as Ge,T as g,e as lo,h as _t,k as gt,i as Ut,m as co,n as Ne,o as uo,p as po,q as Rt,t as ho,v as mo,w as fo,x as Oe,y as go,z as Wt,A as Bt,D as Xe,E as Ke,F as Je,G as Qe,H as xo,I as vo,J as bo,K as St,L as ct,M as Co,B as H,N as Tt,C as $e}from"./index-C1ReEk1L.js";import{a as ko,h as G,D as Fe,b as dt,c as He,d as ut}from"./moment-9dlSSMm8.js";import{u as yo}from"./useMediaQuery-0kBLBwhj.js";import{G as Dt,F as jo,I as wo,S as Po}from"./Select-CFSLaOO0.js";import{P as zt,C as je}from"./Chip-DenXCemR.js";import{C as Mo,A as pt}from"./Container-BioeMoiY.js";import{B as X}from"./Button-vGjmJ2yn.js";import{C as Vt,a as qt,b as Gt}from"./CardHeader-RKxk7wKC.js";import{M as _o}from"./MenuItem-BECjk3gz.js";function Ro(t){return String(t).match(/[\d.\-+]*\s*(.*)/)[1]||""}function So(t){return parseFloat(t)}function To(t){return Be("MuiCardActions",t)}ze("MuiCardActions",["root","spacing"]);const Do=["disableSpacing","className"],Io=t=>{const{classes:s,disableSpacing:r}=t;return Ge({root:["root",!r&&"spacing"]},To,s)},Eo=me("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:r}=t;return[s.root,!r.disableSpacing&&s.spacing]}})(({ownerState:t})=>d({display:"flex",alignItems:"center",padding:8},!t.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})),Xt=a.forwardRef(function(s,r){const c=Ve({props:s,name:"MuiCardActions"}),{disableSpacing:f=!1,className:h}=c,m=qe(c,Do),v=d({},c,{disableSpacing:f}),b=Io(v);return e.jsx(Eo,d({className:re(b.root,h),ownerState:v,ref:r},m))});function Lo(t){return Be("MuiDialogContentText",t)}ze("MuiDialogContentText",["root"]);const Ao=["children","className"],No=t=>{const{classes:s}=t,c=Ge({root:["root"]},Lo,s);return d({},s,c)},Oo=me(g,{shouldForwardProp:t=>lo(t)||t==="classes",name:"MuiDialogContentText",slot:"Root",overridesResolver:(t,s)=>s.root})({}),It=a.forwardRef(function(s,r){const c=Ve({props:s,name:"MuiDialogContentText"}),{className:f}=c,h=qe(c,Ao),m=No(h);return e.jsx(Oo,d({component:"p",variant:"body1",color:"text.secondary",ref:r,ownerState:h,className:re(m.root,f)},c,{classes:m}))});function $o(t){return Be("MuiSkeleton",t)}ze("MuiSkeleton",["root","text","rectangular","rounded","circular","pulse","wave","withChildren","fitContent","heightAuto"]);const Fo=["animation","className","component","height","style","variant","width"];let We=t=>t,Et,Lt,At,Nt;const Ho=t=>{const{classes:s,variant:r,animation:c,hasChildren:f,width:h,height:m}=t;return Ge({root:["root",r,c,f&&"withChildren",f&&!h&&"fitContent",f&&!m&&"heightAuto"]},$o,s)},Yo=gt(Et||(Et=We`
  0% {
    opacity: 1;
  }

  50% {
    opacity: 0.4;
  }

  100% {
    opacity: 1;
  }
`)),Uo=gt(Lt||(Lt=We`
  0% {
    transform: translateX(-100%);
  }

  50% {
    /* +0.5s of delay between each loop */
    transform: translateX(100%);
  }

  100% {
    transform: translateX(100%);
  }
`)),Wo=me("span",{name:"MuiSkeleton",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:r}=t;return[s.root,s[r.variant],r.animation!==!1&&s[r.animation],r.hasChildren&&s.withChildren,r.hasChildren&&!r.width&&s.fitContent,r.hasChildren&&!r.height&&s.heightAuto]}})(({theme:t,ownerState:s})=>{const r=Ro(t.shape.borderRadius)||"px",c=So(t.shape.borderRadius);return d({display:"block",backgroundColor:t.vars?t.vars.palette.Skeleton.bg:ko(t.palette.text.primary,t.palette.mode==="light"?.11:.13),height:"1.2em"},s.variant==="text"&&{marginTop:0,marginBottom:0,height:"auto",transformOrigin:"0 55%",transform:"scale(1, 0.60)",borderRadius:`${c}${r}/${Math.round(c/.6*10)/10}${r}`,"&:empty:before":{content:'"\\00a0"'}},s.variant==="circular"&&{borderRadius:"50%"},s.variant==="rounded"&&{borderRadius:(t.vars||t).shape.borderRadius},s.hasChildren&&{"& > *":{visibility:"hidden"}},s.hasChildren&&!s.width&&{maxWidth:"fit-content"},s.hasChildren&&!s.height&&{height:"auto"})},({ownerState:t})=>t.animation==="pulse"&&_t(At||(At=We`
      animation: ${0} 2s ease-in-out 0.5s infinite;
    `),Yo),({ownerState:t,theme:s})=>t.animation==="wave"&&_t(Nt||(Nt=We`
      position: relative;
      overflow: hidden;

      /* Fix bug in Safari https://bugs.webkit.org/show_bug.cgi?id=68196 */
      -webkit-mask-image: -webkit-radial-gradient(white, black);

      &::after {
        animation: ${0} 2s linear 0.5s infinite;
        background: linear-gradient(
          90deg,
          transparent,
          ${0},
          transparent
        );
        content: '';
        position: absolute;
        transform: translateX(-100%); /* Avoid flash during server-side hydration */
        bottom: 0;
        left: 0;
        right: 0;
        top: 0;
      }
    `),Uo,(s.vars||s).palette.action.hover)),K=a.forwardRef(function(s,r){const c=Ve({props:s,name:"MuiSkeleton"}),{animation:f="pulse",className:h,component:m="span",height:v,style:b,variant:I="text",width:C}=c,P=qe(c,Fo),Y=d({},c,{animation:f,component:m,variant:I,hasChildren:!!P.children}),U=Ho(Y);return e.jsx(Wo,d({as:m,ref:r,className:re(U.root,h),ownerState:Y},P,{style:d({width:C,height:v},b)}))});function Bo(t){return Be("MuiTooltip",t)}const J=ze("MuiTooltip",["popper","popperInteractive","popperArrow","popperClose","tooltip","tooltipArrow","touch","tooltipPlacementLeft","tooltipPlacementRight","tooltipPlacementTop","tooltipPlacementBottom","arrow"]),zo=["arrow","children","classes","components","componentsProps","describeChild","disableFocusListener","disableHoverListener","disableInteractive","disableTouchListener","enterDelay","enterNextDelay","enterTouchDelay","followCursor","id","leaveDelay","leaveTouchDelay","onClose","onOpen","open","placement","PopperComponent","PopperProps","slotProps","slots","title","TransitionComponent","TransitionProps"];function Vo(t){return Math.round(t*1e5)/1e5}const qo=t=>{const{classes:s,disableInteractive:r,arrow:c,touch:f,placement:h}=t,m={popper:["popper",!r&&"popperInteractive",c&&"popperArrow"],tooltip:["tooltip",c&&"tooltipArrow",f&&"touch",`tooltipPlacement${Wt(h.split("-")[0])}`],arrow:["arrow"]};return Ge(m,Bo,s)},Go=me(zt,{name:"MuiTooltip",slot:"Popper",overridesResolver:(t,s)=>{const{ownerState:r}=t;return[s.popper,!r.disableInteractive&&s.popperInteractive,r.arrow&&s.popperArrow,!r.open&&s.popperClose]}})(({theme:t,ownerState:s,open:r})=>d({zIndex:(t.vars||t).zIndex.tooltip,pointerEvents:"none"},!s.disableInteractive&&{pointerEvents:"auto"},!r&&{pointerEvents:"none"},s.arrow&&{[`&[data-popper-placement*="bottom"] .${J.arrow}`]:{top:0,marginTop:"-0.71em","&::before":{transformOrigin:"0 100%"}},[`&[data-popper-placement*="top"] .${J.arrow}`]:{bottom:0,marginBottom:"-0.71em","&::before":{transformOrigin:"100% 0"}},[`&[data-popper-placement*="right"] .${J.arrow}`]:d({},s.isRtl?{right:0,marginRight:"-0.71em"}:{left:0,marginLeft:"-0.71em"},{height:"1em",width:"0.71em","&::before":{transformOrigin:"100% 100%"}}),[`&[data-popper-placement*="left"] .${J.arrow}`]:d({},s.isRtl?{left:0,marginLeft:"-0.71em"}:{right:0,marginRight:"-0.71em"},{height:"1em",width:"0.71em","&::before":{transformOrigin:"0 0"}})})),Xo=me("div",{name:"MuiTooltip",slot:"Tooltip",overridesResolver:(t,s)=>{const{ownerState:r}=t;return[s.tooltip,r.touch&&s.touch,r.arrow&&s.tooltipArrow,s[`tooltipPlacement${Wt(r.placement.split("-")[0])}`]]}})(({theme:t,ownerState:s})=>d({backgroundColor:t.vars?t.vars.palette.Tooltip.bg:Bt.alpha(t.palette.grey[700],.92),borderRadius:(t.vars||t).shape.borderRadius,color:(t.vars||t).palette.common.white,fontFamily:t.typography.fontFamily,padding:"4px 8px",fontSize:t.typography.pxToRem(11),maxWidth:300,margin:2,wordWrap:"break-word",fontWeight:t.typography.fontWeightMedium},s.arrow&&{position:"relative",margin:0},s.touch&&{padding:"8px 16px",fontSize:t.typography.pxToRem(14),lineHeight:`${Vo(16/14)}em`,fontWeight:t.typography.fontWeightRegular},{[`.${J.popper}[data-popper-placement*="left"] &`]:d({transformOrigin:"right center"},s.isRtl?d({marginLeft:"14px"},s.touch&&{marginLeft:"24px"}):d({marginRight:"14px"},s.touch&&{marginRight:"24px"})),[`.${J.popper}[data-popper-placement*="right"] &`]:d({transformOrigin:"left center"},s.isRtl?d({marginRight:"14px"},s.touch&&{marginRight:"24px"}):d({marginLeft:"14px"},s.touch&&{marginLeft:"24px"})),[`.${J.popper}[data-popper-placement*="top"] &`]:d({transformOrigin:"center bottom",marginBottom:"14px"},s.touch&&{marginBottom:"24px"}),[`.${J.popper}[data-popper-placement*="bottom"] &`]:d({transformOrigin:"center top",marginTop:"14px"},s.touch&&{marginTop:"24px"})})),Ko=me("span",{name:"MuiTooltip",slot:"Arrow",overridesResolver:(t,s)=>s.arrow})(({theme:t})=>({overflow:"hidden",position:"absolute",width:"1em",height:"0.71em",boxSizing:"border-box",color:t.vars?t.vars.palette.Tooltip.bg:Bt.alpha(t.palette.grey[700],.9),"&::before":{content:'""',margin:"auto",display:"block",width:"100%",height:"100%",backgroundColor:"currentColor",transform:"rotate(45deg)"}}));let Ye=!1;const Ot=new go;let we={x:0,y:0};function Ue(t,s){return(r,...c)=>{s&&s(r,...c),t(r,...c)}}const Pe=a.forwardRef(function(s,r){var c,f,h,m,v,b,I,C,P,Y,U,W,ae,ne,Ze,fe,Q,Te,Z;const ie=Ve({props:s,name:"MuiTooltip"}),{arrow:E=!1,children:le,components:L={},componentsProps:M={},describeChild:ge=!1,disableFocusListener:et=!1,disableHoverListener:B=!1,disableInteractive:tt=!1,disableTouchListener:x=!1,enterDelay:De=100,enterNextDelay:ce=0,enterTouchDelay:de=700,followCursor:ue=!1,id:z,leaveDelay:xe=0,leaveTouchDelay:xt=1500,onClose:Ie,onOpen:Ee,open:ot,placement:ee="bottom",PopperComponent:A,PopperProps:_={},slotProps:$={},slots:N={},title:F,TransitionComponent:pe=Dt,TransitionProps:ve}=ie,te=qe(ie,zo),j=a.isValidElement(le)?le:e.jsx("span",{children:le}),O=Ut(),st=co(),[oe,Le]=a.useState(),[V,rt]=a.useState(null),se=a.useRef(!1),be=tt||ue,Ae=Ne(),he=Ne(),o=Ne(),n=Ne(),[i,u]=uo({controlled:ot,default:!1,name:"Tooltip",state:"open"});let p=i;const R=po(z),S=a.useRef(),k=Rt(()=>{S.current!==void 0&&(document.body.style.WebkitUserSelect=S.current,S.current=void 0),n.clear()});a.useEffect(()=>k,[k]);const w=l=>{Ot.clear(),Ye=!0,u(!0),Ee&&!p&&Ee(l)},T=Rt(l=>{Ot.start(800+xe,()=>{Ye=!1}),u(!1),Ie&&p&&Ie(l),Ae.start(O.transitions.duration.shortest,()=>{se.current=!1})}),q=l=>{se.current&&l.type!=="touchstart"||(oe&&oe.removeAttribute("title"),he.clear(),o.clear(),De||Ye&&ce?he.start(Ye?ce:De,()=>{w(l)}):w(l))},at=l=>{he.clear(),o.start(xe,()=>{T(l)})},{isFocusVisibleRef:vt,onBlur:Kt,onFocus:Jt,ref:Qt}=ho(),[,bt]=a.useState(!1),Ct=l=>{Kt(l),vt.current===!1&&(bt(!1),at(l))},kt=l=>{oe||Le(l.currentTarget),Jt(l),vt.current===!0&&(bt(!0),q(l))},yt=l=>{se.current=!0;const y=j.props;y.onTouchStart&&y.onTouchStart(l)},Zt=l=>{yt(l),o.clear(),Ae.clear(),k(),S.current=document.body.style.WebkitUserSelect,document.body.style.WebkitUserSelect="none",n.start(de,()=>{document.body.style.WebkitUserSelect=S.current,q(l)})},eo=l=>{j.props.onTouchEnd&&j.props.onTouchEnd(l),k(),o.start(xt,()=>{T(l)})};a.useEffect(()=>{if(!p)return;function l(y){(y.key==="Escape"||y.key==="Esc")&&T(y)}return document.addEventListener("keydown",l),()=>{document.removeEventListener("keydown",l)}},[T,p]);const to=mo(fo(j),Qt,Le,r);!F&&F!==0&&(p=!1);const nt=a.useRef(),oo=l=>{const y=j.props;y.onMouseMove&&y.onMouseMove(l),we={x:l.clientX,y:l.clientY},nt.current&&nt.current.update()},Ce={},it=typeof F=="string";ge?(Ce.title=!p&&it&&!B?F:null,Ce["aria-describedby"]=p?R:null):(Ce["aria-label"]=it?F:null,Ce["aria-labelledby"]=p&&!it?R:null);const D=d({},Ce,te,j.props,{className:re(te.className,j.props.className),onTouchStart:yt,ref:to},ue?{onMouseMove:oo}:{}),ke={};x||(D.onTouchStart=Zt,D.onTouchEnd=eo),B||(D.onMouseOver=Ue(q,D.onMouseOver),D.onMouseLeave=Ue(at,D.onMouseLeave),be||(ke.onMouseOver=q,ke.onMouseLeave=at)),et||(D.onFocus=Ue(kt,D.onFocus),D.onBlur=Ue(Ct,D.onBlur),be||(ke.onFocus=kt,ke.onBlur=Ct));const so=a.useMemo(()=>{var l;let y=[{name:"arrow",enabled:!!V,options:{element:V,padding:4}}];return(l=_.popperOptions)!=null&&l.modifiers&&(y=y.concat(_.popperOptions.modifiers)),d({},_.popperOptions,{modifiers:y})},[V,_]),ye=d({},ie,{isRtl:st,arrow:E,disableInteractive:be,placement:ee,PopperComponentProp:A,touch:se.current}),lt=qo(ye),jt=(c=(f=N.popper)!=null?f:L.Popper)!=null?c:Go,wt=(h=(m=(v=N.transition)!=null?v:L.Transition)!=null?m:pe)!=null?h:Dt,Pt=(b=(I=N.tooltip)!=null?I:L.Tooltip)!=null?b:Xo,Mt=(C=(P=N.arrow)!=null?P:L.Arrow)!=null?C:Ko,ro=Oe(jt,d({},_,(Y=$.popper)!=null?Y:M.popper,{className:re(lt.popper,_==null?void 0:_.className,(U=(W=$.popper)!=null?W:M.popper)==null?void 0:U.className)}),ye),ao=Oe(wt,d({},ve,(ae=$.transition)!=null?ae:M.transition),ye),no=Oe(Pt,d({},(ne=$.tooltip)!=null?ne:M.tooltip,{className:re(lt.tooltip,(Ze=(fe=$.tooltip)!=null?fe:M.tooltip)==null?void 0:Ze.className)}),ye),io=Oe(Mt,d({},(Q=$.arrow)!=null?Q:M.arrow,{className:re(lt.arrow,(Te=(Z=$.arrow)!=null?Z:M.arrow)==null?void 0:Te.className)}),ye);return e.jsxs(a.Fragment,{children:[a.cloneElement(j,D),e.jsx(jt,d({as:A??zt,placement:ee,anchorEl:ue?{getBoundingClientRect:()=>({top:we.y,left:we.x,right:we.x,bottom:we.y,width:0,height:0})}:oe,popperRef:nt,open:oe?p:!1,id:R,transition:!0},ke,ro,{popperOptions:so,children:({TransitionProps:l})=>e.jsx(wt,d({timeout:O.transitions.duration.shorter},l,ao,{children:e.jsxs(Pt,d({},no,{children:[F,E?e.jsx(Mt,d({},io,{ref:rt})):null]}))}))}))]})});var Me={},$t;function Jo(){if($t)return Me;$t=1;var t=Xe();Object.defineProperty(Me,"__esModule",{value:!0}),Me.default=void 0;var s=t(Ke()),r=Je();return Me.default=(0,s.default)((0,r.jsx)("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8z"}),"History"),Me}var Qo=Jo();const Zo=Qe(Qo);var _e={},Ft;function es(){if(Ft)return _e;Ft=1;var t=Xe();Object.defineProperty(_e,"__esModule",{value:!0}),_e.default=void 0;var s=t(Ke()),r=Je();return _e.default=(0,s.default)((0,r.jsx)("path",{d:"m21.9 8.89-1.05-4.37c-.22-.9-1-1.52-1.91-1.52H5.05c-.9 0-1.69.63-1.9 1.52L2.1 8.89c-.24 1.02-.02 2.06.62 2.88.08.11.19.19.28.29V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-6.94c.09-.09.2-.18.28-.28.64-.82.87-1.87.62-2.89m-2.99-3.9 1.05 4.37c.1.42.01.84-.25 1.17-.14.18-.44.47-.94.47-.61 0-1.14-.49-1.21-1.14L16.98 5zM13 5h1.96l.54 4.52c.05.39-.07.78-.33 1.07-.22.26-.54.41-.95.41-.67 0-1.22-.59-1.22-1.31zM8.49 9.52 9.04 5H11v4.69c0 .72-.55 1.31-1.29 1.31-.34 0-.65-.15-.89-.41-.25-.29-.37-.68-.33-1.07m-4.45-.16L5.05 5h1.97l-.58 4.86c-.08.65-.6 1.14-1.21 1.14-.49 0-.8-.29-.93-.47-.27-.32-.36-.75-.26-1.17M5 19v-6.03c.08.01.15.03.23.03.87 0 1.66-.36 2.24-.95.6.6 1.4.95 2.31.95.87 0 1.65-.36 2.23-.93.59.57 1.39.93 2.29.93.84 0 1.64-.35 2.24-.95.58.59 1.37.95 2.24.95.08 0 .15-.02.23-.03V19z"}),"Storefront"),_e}var ts=es();const os=Qe(ts);var Re={},Ht;function ss(){if(Ht)return Re;Ht=1;var t=Xe();Object.defineProperty(Re,"__esModule",{value:!0}),Re.default=void 0;var s=t(Ke()),r=Je();return Re.default=(0,s.default)((0,r.jsx)("path",{d:"M14 10H3v2h11zm0-4H3v2h11zm4 8v-4h-2v4h-4v2h4v4h2v-4h4v-2zM3 16h7v-2H3z"}),"PlaylistAdd"),Re}var rs=ss();const ht=Qe(rs);var Se={},Yt;function as(){if(Yt)return Se;Yt=1;var t=Xe();Object.defineProperty(Se,"__esModule",{value:!0}),Se.default=void 0;var s=t(Ke()),r=Je();return Se.default=(0,s.default)((0,r.jsx)("path",{d:"M12 2 4.5 20.29l.71.71L12 18l6.79 3 .71-.71z"}),"Navigation"),Se}var ns=as();const is=Qe(ns);gt`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`;const mt=()=>e.jsxs(Vt,{sx:{mb:3,border:"1px solid #e0e0e0",boxShadow:"4px 4px 8px rgba(0,0,0,0.1)"},children:[e.jsx(qt,{avatar:e.jsx(K,{animation:"wave",variant:"circular",width:40,height:40}),title:e.jsx(K,{animation:"wave",height:20,width:"80%"}),sx:{backgroundColor:"grey.200"}}),e.jsxs(Gt,{sx:{flexGrow:1,display:"flex",flexDirection:"column",gap:1.5,pt:1},children:[e.jsx(K,{animation:"wave",height:15,width:"90%"}),e.jsx(K,{animation:"wave",height:15,width:"60%"}),e.jsx(K,{animation:"wave",height:15,width:"60%"}),e.jsx(K,{animation:"wave",height:15,width:"60%"})]}),e.jsxs(Xt,{sx:{justifyContent:"space-between",px:2,py:1.5,backgroundColor:"grey.50"},children:[e.jsx(K,{animation:"wave",variant:"circular",width:32,height:32}),e.jsx(K,{animation:"wave",variant:"rectangular",width:100,height:36})]})]}),ls=(t,s,r,c)=>{const h=t*Math.PI/180,m=r*Math.PI/180,v=(r-t)*Math.PI/180,b=(c-s)*Math.PI/180,I=Math.sin(v/2)*Math.sin(v/2)+Math.cos(h)*Math.cos(m)*Math.sin(b/2)*Math.sin(b/2);return 6371e3*(2*Math.atan2(Math.sqrt(I),Math.sqrt(1-I)))},ft=t=>t<500?`${Math.round(t)} meter`:`${(t/1e3).toFixed(1)} km`,vs=()=>{const t=Ut(),s=yo(t.breakpoints.down("sm")),r=a.useMemo(()=>({"Checked In":0,Planned:1,Completed:2,Canceled:3,Draft:4}),[]),{employeeId:c}=xo(),f=vo(),[h,m]=a.useState([]),[v,b]=a.useState(!0),[I,C]=a.useState(null),[P,Y]=a.useState(0),[U,W]=a.useState(!0),[ae,ne]=a.useState(!1),[Ze,fe]=a.useState(0),Q=a.useRef(null),Te=a.useCallback(o=>{ae||(Q.current&&Q.current.disconnect(),Q.current=new IntersectionObserver(n=>{n[0].isIntersecting&&U&&Y(i=>i+1)}),o&&Q.current.observe(o))},[ae,U]),[Z,ie]=a.useState(!1),[E,le]=a.useState(null),L=a.useRef(null),M=a.useRef(null),[ge,et]=a.useState(null),[B,tt]=a.useState(null),[x,De]=a.useState(null),[ce,de]=a.useState(!1),[ue,z]=a.useState(null),[xe,xt]=a.useState([]),[Ie,Ee]=a.useState(void 0),[ot,ee]=a.useState(!1),[A,_]=a.useState({isOpen:!1,distance:0}),[$,N]=a.useState(!1),[F,pe]=a.useState(null),[ve,te]=a.useState(null);a.useEffect(()=>{if(Z&&ve){ee(!1);const o=()=>{L.current?(L.current.srcObject=ve,ee(!0)):(console.warn("DEBUG: videoRef.current is null in useEffect. Retrying..."),setTimeout(o,50))};o()}else Z||ee(!1)},[Z,ve]);const j=a.useCallback(o=>o.sort((n,i)=>(r[n.status]??99)-(r[i.status]??99)),[r]),O=a.useCallback(async o=>{if(!c){C("Employee ID not available."),b(!1),ne(!1);return}o===0?b(!0):ne(!0);try{const n=await bo(o);if(n.error_message){C(n.error_message),W(!1),m([]);return}const i=n.data,u=n.total;o===0?(m(j(i)),fe(u),W(i.length<u)):m(p=>{const R=[...p,...i],S=Array.from(new Map(R.map(w=>[w.name,w])).values()),k=j(S);return W(k.length<u),k}),C(null)}catch(n){console.error("Error fetching visit plans:",n),C(n instanceof Error?n.message:"Failed to fetch data."),W(!1)}finally{o===0&&b(!1),ne(!1)}},[c,j]);a.useEffect(()=>{c&&(m([]),Y(0),W(!0),fe(0),O(0))},[c,O]),a.useEffect(()=>{P>0&&O(P)},[P,O]);const st=a.useCallback(o=>{if(o.parent_docstatus===0)return e.jsx(Pe,{title:o.parent,arrow:!0,children:e.jsx(je,{label:"Draft",color:"warning",size:"small",sx:{fontWeight:"bold"}})});let n="default",i=o.status;switch(o.status){case"Planned":n="primary";break;case"Checked In":n="secondary";break;case"Completed":n="success";break;case"Canceled":n="error";break;default:i="Draft",n="error";break}return e.jsx(Pe,{title:o.parent,arrow:!0,children:e.jsx(je,{label:i,color:n,size:"small",sx:{fontWeight:"bold"}})})},[]),oe=async o=>{try{await St(o,"Checked In")?O(0):C("Failed to check-in.")}catch(n){C(n instanceof Error?n.message:"An unexpected error occurred during check-in.")}},Le=async o=>{const n=h.find(u=>u.name===o);if(!n)return;le(o),N(!0),pe(null);let i=null;try{const u=navigator.mediaDevices.getUserMedia({video:!0}),p=new Promise((w,T)=>{if(!navigator.geolocation)return T(new Error("Geolocation is not supported."));navigator.geolocation.getCurrentPosition(q=>w(q.coords),q=>T(q))}),[R,S]=await Promise.all([u,p]);i=R,te(i),De(S);const k=await ct(n.store_name);if(k&&k.latitude&&k.longitude){const w=ls(k.latitude,k.longitude,S.latitude,S.longitude);if(w>100){N(!1),_({isOpen:!0,distance:w,type:"too_far"}),i&&i.getTracks().forEach(T=>T.stop()),te(null);return}else if(w>50){N(!1),_({isOpen:!0,distance:w,type:"almost_there"}),i&&i.getTracks().forEach(T=>T.stop()),te(null);return}}N(!1),ie(!0)}catch(u){console.error("DEBUG: Error during pre-checkout validation:",u),console.error("DEBUG: Error during pre-checkout validation:",u),i&&i.getTracks().forEach(R=>R.stop()),te(null);let p="Gagal mempersiapkan checkout. Pastikan izin lokasi dan kamera telah diberikan.";u instanceof GeolocationPositionError?u.code===u.PERMISSION_DENIED?p="Akses lokasi ditolak. Mohon aktifkan di pengaturan browser.":u.code===u.POSITION_UNAVAILABLE&&(p="Informasi lokasi tidak tersedia saat ini."):u instanceof Error&&u.name==="NotAllowedError"&&(p="Akses kamera ditolak. Mohon aktifkan di pengaturan browser."),pe(p),N(!1)}},V=a.useCallback(()=>{ie(!1),le(null),ee(!1)},[]),rt=a.useCallback(()=>{if(L.current&&M.current){const o=L.current,n=M.current;n.width=o.videoWidth,n.height=o.videoHeight;const i=n.getContext("2d");if(i){i.drawImage(o,0,0,o.videoWidth,o.videoHeight);const u=n.toDataURL("image/jpeg");et(u),n.toBlob(p=>{p&&tt(new File([p],"captured_photo.jpeg",{type:"image/jpeg"}))},"image/jpeg")}}},[]),se=a.useCallback(async()=>{if(!x||!E||!B){z("Pastikan foto sudah diambil dan lokasi tersedia."),de(!1);return}try{await St(E,"Completed",{latitude:x.latitude,longitude:x.longitude,photo_file:B,checkout_time:G().format("YYYY-MM-DD HH:mm:ss")})?(V(),O(0)):z("Gagal menyelesaikan checkout.")}catch(o){z(o instanceof Error?o.message:"Terjadi error saat checkout.")}finally{de(!1)}},[x,E,B,V,O]),be=a.useCallback(async()=>{if(!x||!E||!B){z("Pastikan foto sudah diambil dan lokasi tersedia.");return}de(!0),z(null);try{const o=h.find(i=>i.name===E);if(!o)throw new Error("Data kunjungan tidak ditemukan.");await ct(o.store_name)||await Co(o.store_name,x.latitude,x.longitude),await se()}catch(o){z(o instanceof Error?o.message:"Gagal memvalidasi lokasi."),de(!1)}},[E,x,B,h,se]),Ae=async o=>{const n=await ct(o.store_name);if(n&&n.latitude&&n.longitude){const i=`https://www.google.com/maps/dir/?api=1&destination=${n.latitude},${n.longitude}`;window.open(i,"_blank")}else C(`Lokasi untuk customer ${o.store_name} tidak ditemukan.`)},he=a.useCallback((o,n)=>{if(!o)return"N/A";const i=G(o,"DD-MM-YYYY HH:mm:ss");if(!i.isValid())return"Invalid Date";if(n){const u=G(n,"DD-MM-YYYY HH:mm");if(u.isValid()&&i.isSame(u,"day"))return i.format("HH:mm")}return i.format("DD-MM-YYYY HH:mm")},[]);return e.jsxs(e.Fragment,{children:[e.jsxs(Mo,{maxWidth:"lg",sx:{mt:4,mb:4,width:"100%",overflowX:"hidden"},children:[e.jsx(g,{variant:"h4",component:"h1",gutterBottom:!0,align:"center",sx:{fontWeight:"bold"},children:"My Visit Schedule"}),e.jsx(H,{sx:{mb:2,textAlign:"right"},children:e.jsx(X,{variant:"contained",startIcon:e.jsx(Zo,{}),onClick:()=>f("/history"),children:"History"})}),v&&P===0?e.jsxs(H,{children:[e.jsx(mt,{}),e.jsx(mt,{}),e.jsx(mt,{})]}):I?e.jsx(pt,{severity:"error",children:I}):h.length===0?e.jsx(pt,{severity:"info",sx:{mt:2},children:"No visit plans found."}):e.jsxs(H,{children:[h.map((o,n)=>{const i=o.planned_visit_time&&G(o.planned_visit_time,"DD-MM-YYYY").isSame(G(),"day"),u=o.planned_visit_time&&G(o.planned_visit_time,"DD-MM-YYYY").isBefore(G(),"day");return o.status==="Completed"&&u?null:e.jsxs(Vt,{sx:{mb:3,border:"1px solid #e0e0e0",boxShadow:"4px 4px 8px rgba(0,0,0,0.1)",width:s?"100%":"auto"},ref:h.length===n+1?Te:null,children:[e.jsx(qt,{avatar:e.jsx(os,{sx:{color:"primary.main",fontSize:40}}),title:e.jsx(g,{variant:"h6",sx:{fontWeight:"bold"},children:o.store_name}),subheader:e.jsx(g,{variant:"body2",color:"text.secondary",children:o.address}),sx:{backgroundColor:"grey.100",py:1.5}}),e.jsxs(Gt,{sx:{display:"flex",flexDirection:"column",gap:1.5,pt:1},children:[e.jsxs(H,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(je,{label:e.jsxs(H,{component:"span",children:["Planning :"," ",e.jsx(g,{component:"span",sx:{fontWeight:"bold",color:"#FFFFFF"},children:o.planned_visit_time?G(o.planned_visit_time,"DD-MM-YYYY HH:mm").format("DD-MM-YYYY HH:mm"):"N/A"})]}),color:"info",size:"small"}),st(o)]}),e.jsx(je,{icon:e.jsx(ht,{}),label:`CheckIn: ${he(o.checkin_time,o.planned_visit_time)}`,variant:"outlined",size:"small"}),e.jsx(je,{icon:e.jsx(ht,{}),label:`CheckOut: ${he(o.checkout_time,o.planned_visit_time)}`,variant:"outlined",size:"small"}),o.notes&&e.jsxs(g,{variant:"body2",sx:{fontStyle:"italic",color:"text.secondary"},children:["Notes: ",o.notes]})]}),e.jsxs(Xt,{sx:{justifyContent:"space-between",px:2,py:1.5,backgroundColor:"grey.50"},children:[e.jsxs(H,{children:[e.jsx(Tt,{onClick:()=>Ae(o),"aria-label":"Navigate",children:e.jsx(Pe,{title:"Navigate to Customer",children:e.jsx(is,{sx:{color:"primary.main"}})})}),e.jsx(Tt,{onClick:()=>f(`/notes/${o.name}`),"aria-label":"Add Notes",children:e.jsx(Pe,{title:"Add Notes",children:e.jsx(ht,{})})})]}),e.jsxs(H,{children:[i&&(o.status==="Planned"||o.status==="Completed")&&e.jsx(X,{variant:"contained",color:"secondary",onClick:()=>oe(o.name),children:o.status==="Completed"?"Re-Check In":"Check In"}),o.status==="Checked In"&&e.jsx(X,{variant:"contained",color:"success",onClick:()=>Le(o.name),children:"Check Out"})]})]})]},o.name)}),ae&&e.jsx(H,{sx:{display:"flex",justifyContent:"center",my:2},children:e.jsx($e,{})}),!U&&e.jsx(g,{variant:"body2",align:"center",color:"text.secondary",sx:{my:2},children:"You have reached the end of the list."})]})]}),e.jsxs(Fe,{open:Z,onClose:V,fullWidth:!0,maxWidth:"sm",children:[e.jsx(dt,{children:"Complete Checkout"}),e.jsxs(He,{children:[ue&&e.jsx(pt,{severity:"error",sx:{mb:2},children:ue}),e.jsxs(H,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(g,{children:"Take Photo:"}),e.jsx("video",{ref:L,style:{width:"100%",border:"1px solid #ccc"},autoPlay:!0,playsInline:!0}),xe.length>1&&e.jsxs(jo,{fullWidth:!0,children:[e.jsx(wo,{id:"camera-select-label",children:"Camera"}),e.jsx(Po,{labelId:"camera-select-label",value:Ie||"",label:"Camera",onChange:o=>Ee(o.target.value),children:xe.map(o=>e.jsx(_o,{value:o.deviceId,children:o.label},o.deviceId))})]}),e.jsx(X,{variant:"outlined",onClick:rt,disabled:!ot,children:"Capture Photo"}),ge&&e.jsx("img",{src:ge,alt:"Captured",style:{width:"100%",border:"1px solid #ccc"}}),e.jsx("canvas",{ref:M,style:{display:"none"}}),e.jsx(g,{children:"Current Location:"}),x?e.jsxs(g,{children:["Lat: ",x.latitude.toFixed(6),", Lng: ",x.longitude.toFixed(6)]}):e.jsx($e,{size:20})]})]}),e.jsxs(ut,{children:[e.jsx(X,{onClick:V,disabled:ce,children:"Cancel"}),e.jsx(X,{onClick:be,disabled:ce||!ge||!x,variant:"contained",children:ce?e.jsx($e,{size:24,color:"inherit"}):"Complete Checkout"})]})]}),e.jsxs(Fe,{open:A.isOpen,onClose:()=>_({isOpen:!1,distance:0}),children:[e.jsx(dt,{children:"Lokasi Terlalu Jauh"}),e.jsx(He,{children:(()=>{const o=h.find(R=>R.name===E),n=(o==null?void 0:o.store_name)||"customer",i=(o==null?void 0:o.address)||"alamat tidak tersedia",u=e.jsx(Pe,{title:i,arrow:!0,children:e.jsx(g,{component:"span",sx:{fontWeight:"bold"},children:n})});let p;return A.type==="too_far"?p=e.jsxs(e.Fragment,{children:["Lokasi Anda berjarak sekitar ",e.jsx(g,{component:"span",sx:{fontWeight:"bold"},children:ft(A.distance)})," dari lokasi customer.",e.jsx("br",{}),e.jsx("br",{}),"Lokasi Anda terlalu jauh dengan ",u,". Silahkan terus berjalan mendekat.",e.jsx("br",{}),"Gunakan button refresh untuk memperbaharui."]}):A.type==="almost_there"?p=e.jsxs(e.Fragment,{children:["Lokasi Anda berjarak sekitar ",e.jsx(g,{component:"span",sx:{fontWeight:"bold"},children:ft(A.distance)})," dari lokasi customer.",e.jsx("br",{}),e.jsx("br",{}),"Terus melangkah lagi lokasi anda sudah dekat.",e.jsx("br",{}),"Gunakan button refresh untuk memperbaharui."]}):p=e.jsxs(e.Fragment,{children:["Lokasi Anda berjarak sekitar ",e.jsx(g,{component:"span",sx:{fontWeight:"bold"},children:ft(A.distance)})," dari lokasi customer.",e.jsx("br",{}),e.jsx("br",{}),"Silahkan berjalan lagi untuk mendapatkan lokasi yang sesuai."]}),e.jsx(It,{children:p})})()}),e.jsx(ut,{children:e.jsx(X,{onClick:()=>window.location.reload(),color:"primary",children:"Refresh"})})]}),e.jsx(Fe,{open:$,children:e.jsxs(He,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx($e,{}),e.jsx(g,{children:"Mempersiapkan checkout..."})]})}),e.jsxs(Fe,{open:!!F,onClose:()=>pe(null),children:[e.jsx(dt,{children:"Error"}),e.jsx(He,{children:e.jsx(It,{children:F})}),e.jsx(ut,{children:e.jsx(X,{onClick:()=>pe(null),children:"Tutup"})})]})]})};export{vs as default};
