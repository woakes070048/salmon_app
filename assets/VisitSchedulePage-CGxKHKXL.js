import{g as Ke,a as Je,r as i,u as _e,_ as Se,b as u,j as o,s as J,c as U,d as Ie,T as R,e as ht,k as Qe,h as Xt,i as Kt,m as Pe,n as Jt,o as Qt,p as mt,q as Zt,t as eo,v as to,w as Me,x as oo,y as kt,z as Pt,A as Mt,D as Tt,E as Rt,F as Dt,G as so,H as ro,I as no,J as ao,K as ft,B as L,L as io,M as lo,C as We}from"./index-DwO2zsMy.js";import{D as co,g as uo,a as po,P as _t,h as X,C as ce,b as ho,c as mo,d as fo}from"./moment-AogvteVv.js";import{G as gt}from"./Grow-DbyNEexI.js";import{C as go}from"./Container-B2ARGEHm.js";import{B as K}from"./Button-D8zL6aBE.js";import{A as Ve}from"./Alert-CwDhJiww.js";import{C as St,a as It,b as At}from"./CardHeader-C46bDszn.js";function xo(e){return String(e).match(/[\d.\-+]*\s*(.*)/)[1]||""}function vo(e){return parseFloat(e)}function bo(e){return Ke("MuiCardActions",e)}Je("MuiCardActions",["root","spacing"]);const Co=["disableSpacing","className"],yo=e=>{const{classes:t,disableSpacing:r}=e;return Ie({root:["root",!r&&"spacing"]},bo,t)},wo=J("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,!r.disableSpacing&&t.spacing]}})(({ownerState:e})=>u({display:"flex",alignItems:"center",padding:8},!e.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})),Et=i.forwardRef(function(t,r){const l=_e({props:t,name:"MuiCardActions"}),{disableSpacing:p=!1,className:d}=l,h=Se(l,Co),m=u({},l,{disableSpacing:p}),f=yo(m);return o.jsx(wo,u({className:U(f.root,d),ownerState:m,ref:r},h))}),jo=["className","id"],ko=e=>{const{classes:t}=e;return Ie({root:["root"]},uo,t)},Po=J(R,{name:"MuiDialogTitle",slot:"Root",overridesResolver:(e,t)=>t.root})({padding:"16px 24px",flex:"0 0 auto"}),Mo=i.forwardRef(function(t,r){const l=_e({props:t,name:"MuiDialogTitle"}),{className:p,id:d}=l,h=Se(l,jo),m=l,f=ko(m),{titleId:x=d}=i.useContext(co);return o.jsx(Po,u({component:"h2",className:U(f.root,p),ownerState:m,ref:r,variant:"h6",id:d??x},h))});function To(e){return Ke("MuiSkeleton",e)}Je("MuiSkeleton",["root","text","rectangular","rounded","circular","pulse","wave","withChildren","fitContent","heightAuto"]);const Ro=["animation","className","component","height","style","variant","width"];let De=e=>e,xt,vt,bt,Ct;const Do=e=>{const{classes:t,variant:r,animation:l,hasChildren:p,width:d,height:h}=e;return Ie({root:["root",r,l,p&&"withChildren",p&&!d&&"fitContent",p&&!h&&"heightAuto"]},To,t)},_o=Qe(xt||(xt=De`
  0% {
    opacity: 1;
  }

  50% {
    opacity: 0.4;
  }

  100% {
    opacity: 1;
  }
`)),So=Qe(vt||(vt=De`
  0% {
    transform: translateX(-100%);
  }

  50% {
    /* +0.5s of delay between each loop */
    transform: translateX(100%);
  }

  100% {
    transform: translateX(100%);
  }
`)),Io=J("span",{name:"MuiSkeleton",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,t[r.variant],r.animation!==!1&&t[r.animation],r.hasChildren&&t.withChildren,r.hasChildren&&!r.width&&t.fitContent,r.hasChildren&&!r.height&&t.heightAuto]}})(({theme:e,ownerState:t})=>{const r=xo(e.shape.borderRadius)||"px",l=vo(e.shape.borderRadius);return u({display:"block",backgroundColor:e.vars?e.vars.palette.Skeleton.bg:po(e.palette.text.primary,e.palette.mode==="light"?.11:.13),height:"1.2em"},t.variant==="text"&&{marginTop:0,marginBottom:0,height:"auto",transformOrigin:"0 55%",transform:"scale(1, 0.60)",borderRadius:`${l}${r}/${Math.round(l/.6*10)/10}${r}`,"&:empty:before":{content:'"\\00a0"'}},t.variant==="circular"&&{borderRadius:"50%"},t.variant==="rounded"&&{borderRadius:(e.vars||e).shape.borderRadius},t.hasChildren&&{"& > *":{visibility:"hidden"}},t.hasChildren&&!t.width&&{maxWidth:"fit-content"},t.hasChildren&&!t.height&&{height:"auto"})},({ownerState:e})=>e.animation==="pulse"&&ht(bt||(bt=De`
      animation: ${0} 2s ease-in-out 0.5s infinite;
    `),_o),({ownerState:e,theme:t})=>e.animation==="wave"&&ht(Ct||(Ct=De`
      position: relative;
      overflow: hidden;

      /* Fix bug in Safari https://bugs.webkit.org/show_bug.cgi?id=68196 */
      -webkit-mask-image: -webkit-radial-gradient(white, black);

      &::after {
        animation: ${0} 2s linear 0.5s infinite;
        background: linear-gradient(
          90deg,
          transparent,
          ${0},
          transparent
        );
        content: '';
        position: absolute;
        transform: translateX(-100%); /* Avoid flash during server-side hydration */
        bottom: 0;
        left: 0;
        right: 0;
        top: 0;
      }
    `),So,(t.vars||t).palette.action.hover)),$=i.forwardRef(function(t,r){const l=_e({props:t,name:"MuiSkeleton"}),{animation:p="pulse",className:d,component:h="span",height:m,style:f,variant:x="text",width:I}=l,j=Se(l,Ro),k=u({},l,{animation:p,component:h,variant:x,hasChildren:!!j.children}),D=Do(k);return o.jsx(Io,u({as:h,ref:r,className:U(D.root,d),ownerState:k},j,{style:u({width:I,height:m},f)}))});function Ao(e){return Ke("MuiTooltip",e)}const O=Je("MuiTooltip",["popper","popperInteractive","popperArrow","popperClose","tooltip","tooltipArrow","touch","tooltipPlacementLeft","tooltipPlacementRight","tooltipPlacementTop","tooltipPlacementBottom","arrow"]),Eo=["arrow","children","classes","components","componentsProps","describeChild","disableFocusListener","disableHoverListener","disableInteractive","disableTouchListener","enterDelay","enterNextDelay","enterTouchDelay","followCursor","id","leaveDelay","leaveTouchDelay","onClose","onOpen","open","placement","PopperComponent","PopperProps","slotProps","slots","title","TransitionComponent","TransitionProps"];function Lo(e){return Math.round(e*1e5)/1e5}const $o=e=>{const{classes:t,disableInteractive:r,arrow:l,touch:p,placement:d}=e,h={popper:["popper",!r&&"popperInteractive",l&&"popperArrow"],tooltip:["tooltip",l&&"tooltipArrow",p&&"touch",`tooltipPlacement${kt(d.split("-")[0])}`],arrow:["arrow"]};return Ie(h,Ao,t)},Oo=J(_t,{name:"MuiTooltip",slot:"Popper",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.popper,!r.disableInteractive&&t.popperInteractive,r.arrow&&t.popperArrow,!r.open&&t.popperClose]}})(({theme:e,ownerState:t,open:r})=>u({zIndex:(e.vars||e).zIndex.tooltip,pointerEvents:"none"},!t.disableInteractive&&{pointerEvents:"auto"},!r&&{pointerEvents:"none"},t.arrow&&{[`&[data-popper-placement*="bottom"] .${O.arrow}`]:{top:0,marginTop:"-0.71em","&::before":{transformOrigin:"0 100%"}},[`&[data-popper-placement*="top"] .${O.arrow}`]:{bottom:0,marginBottom:"-0.71em","&::before":{transformOrigin:"100% 0"}},[`&[data-popper-placement*="right"] .${O.arrow}`]:u({},t.isRtl?{right:0,marginRight:"-0.71em"}:{left:0,marginLeft:"-0.71em"},{height:"1em",width:"0.71em","&::before":{transformOrigin:"100% 100%"}}),[`&[data-popper-placement*="left"] .${O.arrow}`]:u({},t.isRtl?{left:0,marginLeft:"-0.71em"}:{right:0,marginRight:"-0.71em"},{height:"1em",width:"0.71em","&::before":{transformOrigin:"0 0"}})})),No=J("div",{name:"MuiTooltip",slot:"Tooltip",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.tooltip,r.touch&&t.touch,r.arrow&&t.tooltipArrow,t[`tooltipPlacement${kt(r.placement.split("-")[0])}`]]}})(({theme:e,ownerState:t})=>u({backgroundColor:e.vars?e.vars.palette.Tooltip.bg:Pt.alpha(e.palette.grey[700],.92),borderRadius:(e.vars||e).shape.borderRadius,color:(e.vars||e).palette.common.white,fontFamily:e.typography.fontFamily,padding:"4px 8px",fontSize:e.typography.pxToRem(11),maxWidth:300,margin:2,wordWrap:"break-word",fontWeight:e.typography.fontWeightMedium},t.arrow&&{position:"relative",margin:0},t.touch&&{padding:"8px 16px",fontSize:e.typography.pxToRem(14),lineHeight:`${Lo(16/14)}em`,fontWeight:e.typography.fontWeightRegular},{[`.${O.popper}[data-popper-placement*="left"] &`]:u({transformOrigin:"right center"},t.isRtl?u({marginLeft:"14px"},t.touch&&{marginLeft:"24px"}):u({marginRight:"14px"},t.touch&&{marginRight:"24px"})),[`.${O.popper}[data-popper-placement*="right"] &`]:u({transformOrigin:"left center"},t.isRtl?u({marginRight:"14px"},t.touch&&{marginRight:"24px"}):u({marginLeft:"14px"},t.touch&&{marginLeft:"24px"})),[`.${O.popper}[data-popper-placement*="top"] &`]:u({transformOrigin:"center bottom",marginBottom:"14px"},t.touch&&{marginBottom:"24px"}),[`.${O.popper}[data-popper-placement*="bottom"] &`]:u({transformOrigin:"center top",marginTop:"14px"},t.touch&&{marginTop:"24px"})})),Fo=J("span",{name:"MuiTooltip",slot:"Arrow",overridesResolver:(e,t)=>t.arrow})(({theme:e})=>({overflow:"hidden",position:"absolute",width:"1em",height:"0.71em",boxSizing:"border-box",color:e.vars?e.vars.palette.Tooltip.bg:Pt.alpha(e.palette.grey[700],.9),"&::before":{content:'""',margin:"auto",display:"block",width:"100%",height:"100%",backgroundColor:"currentColor",transform:"rotate(45deg)"}}));let Te=!1;const yt=new oo;let ue={x:0,y:0};function Re(e,t){return(r,...l)=>{t&&t(r,...l),e(r,...l)}}const qe=i.forwardRef(function(t,r){var l,p,d,h,m,f,x,I,j,k,D,B,Ae,Q,N,he,me,Z,F;const z=_e({props:t,name:"MuiTooltip"}),{arrow:C=!1,children:H,components:A={},componentsProps:P={},describeChild:ee=!1,disableFocusListener:fe=!1,disableHoverListener:v=!1,disableInteractive:Ee=!1,disableTouchListener:te=!1,enterDelay:_=100,enterNextDelay:oe=0,enterTouchDelay:y=700,followCursor:Y=!1,id:E,leaveDelay:ge=0,leaveTouchDelay:Le=1500,onClose:xe,onOpen:W,open:$e,placement:ve="bottom",PopperComponent:V,PopperProps:M={},slotProps:s={},slots:n={},title:a,TransitionComponent:g=gt,TransitionProps:q}=z,G=Se(z,Eo),T=i.isValidElement(H)?H:o.jsx("span",{children:H}),se=Xt(),be=Kt(),[re,Ze]=i.useState(),[Oe,Lt]=i.useState(null),Ce=i.useRef(!1),Ne=Ee||Y,et=Pe(),Fe=Pe(),ye=Pe(),tt=Pe(),[$t,ot]=Jt({controlled:$e,default:!1,name:"Tooltip",state:"open"});let S=$t;const He=Qt(E),ne=i.useRef(),we=mt(()=>{ne.current!==void 0&&(document.body.style.WebkitUserSelect=ne.current,ne.current=void 0),tt.clear()});i.useEffect(()=>we,[we]);const st=c=>{yt.clear(),Te=!0,ot(!0),W&&!S&&W(c)},je=mt(c=>{yt.start(800+ge,()=>{Te=!1}),ot(!1),xe&&S&&xe(c),et.start(se.transitions.duration.shortest,()=>{Ce.current=!1})}),ke=c=>{Ce.current&&c.type!=="touchstart"||(re&&re.removeAttribute("title"),Fe.clear(),ye.clear(),_||Te&&oe?Fe.start(Te?oe:_,()=>{st(c)}):st(c))},Ye=c=>{Fe.clear(),ye.start(ge,()=>{je(c)})},{isFocusVisibleRef:rt,onBlur:Ot,onFocus:Nt,ref:Ft}=Zt(),[,nt]=i.useState(!1),at=c=>{Ot(c),rt.current===!1&&(nt(!1),Ye(c))},it=c=>{re||Ze(c.currentTarget),Nt(c),rt.current===!0&&(nt(!0),ke(c))},lt=c=>{Ce.current=!0;const b=T.props;b.onTouchStart&&b.onTouchStart(c)},Ht=c=>{lt(c),ye.clear(),et.clear(),we(),ne.current=document.body.style.WebkitUserSelect,document.body.style.WebkitUserSelect="none",tt.start(y,()=>{document.body.style.WebkitUserSelect=ne.current,ke(c)})},Yt=c=>{T.props.onTouchEnd&&T.props.onTouchEnd(c),we(),ye.start(Le,()=>{je(c)})};i.useEffect(()=>{if(!S)return;function c(b){(b.key==="Escape"||b.key==="Esc")&&je(b)}return document.addEventListener("keydown",c),()=>{document.removeEventListener("keydown",c)}},[je,S]);const Ut=eo(to(T),Ft,Ze,r);!a&&a!==0&&(S=!1);const Ue=i.useRef(),Bt=c=>{const b=T.props;b.onMouseMove&&b.onMouseMove(c),ue={x:c.clientX,y:c.clientY},Ue.current&&Ue.current.update()},ae={},Be=typeof a=="string";ee?(ae.title=!S&&Be&&!v?a:null,ae["aria-describedby"]=S?He:null):(ae["aria-label"]=Be?a:null,ae["aria-labelledby"]=S&&!Be?He:null);const w=u({},ae,G,T.props,{className:U(G.className,T.props.className),onTouchStart:lt,ref:Ut},Y?{onMouseMove:Bt}:{}),ie={};te||(w.onTouchStart=Ht,w.onTouchEnd=Yt),v||(w.onMouseOver=Re(ke,w.onMouseOver),w.onMouseLeave=Re(Ye,w.onMouseLeave),Ne||(ie.onMouseOver=ke,ie.onMouseLeave=Ye)),fe||(w.onFocus=Re(it,w.onFocus),w.onBlur=Re(at,w.onBlur),Ne||(ie.onFocus=it,ie.onBlur=at));const zt=i.useMemo(()=>{var c;let b=[{name:"arrow",enabled:!!Oe,options:{element:Oe,padding:4}}];return(c=M.popperOptions)!=null&&c.modifiers&&(b=b.concat(M.popperOptions.modifiers)),u({},M.popperOptions,{modifiers:b})},[Oe,M]),le=u({},z,{isRtl:be,arrow:C,disableInteractive:Ne,placement:ve,PopperComponentProp:V,touch:Ce.current}),ze=$o(le),ct=(l=(p=n.popper)!=null?p:A.Popper)!=null?l:Oo,ut=(d=(h=(m=n.transition)!=null?m:A.Transition)!=null?h:g)!=null?d:gt,pt=(f=(x=n.tooltip)!=null?x:A.Tooltip)!=null?f:No,dt=(I=(j=n.arrow)!=null?j:A.Arrow)!=null?I:Fo,Wt=Me(ct,u({},M,(k=s.popper)!=null?k:P.popper,{className:U(ze.popper,M==null?void 0:M.className,(D=(B=s.popper)!=null?B:P.popper)==null?void 0:D.className)}),le),Vt=Me(ut,u({},q,(Ae=s.transition)!=null?Ae:P.transition),le),qt=Me(pt,u({},(Q=s.tooltip)!=null?Q:P.tooltip,{className:U(ze.tooltip,(N=(he=s.tooltip)!=null?he:P.tooltip)==null?void 0:N.className)}),le),Gt=Me(dt,u({},(me=s.arrow)!=null?me:P.arrow,{className:U(ze.arrow,(Z=(F=s.arrow)!=null?F:P.arrow)==null?void 0:Z.className)}),le);return o.jsxs(i.Fragment,{children:[i.cloneElement(T,w),o.jsx(ct,u({as:V??_t,placement:ve,anchorEl:Y?{getBoundingClientRect:()=>({top:ue.y,left:ue.x,right:ue.x,bottom:ue.y,width:0,height:0})}:re,popperRef:Ue,open:re?S:!1,id:He,transition:!0},ie,Wt,{popperOptions:zt,children:({TransitionProps:c})=>o.jsx(ut,u({timeout:se.transitions.duration.shorter},c,Vt,{children:o.jsxs(pt,u({},qt,{children:[a,C?o.jsx(dt,u({},Gt,{ref:Lt})):null]}))}))}))]})});var pe={},wt;function Ho(){if(wt)return pe;wt=1;var e=Mt();Object.defineProperty(pe,"__esModule",{value:!0}),pe.default=void 0;var t=e(Tt()),r=Rt();return pe.default=(0,t.default)((0,r.jsx)("path",{d:"m21.9 8.89-1.05-4.37c-.22-.9-1-1.52-1.91-1.52H5.05c-.9 0-1.69.63-1.9 1.52L2.1 8.89c-.24 1.02-.02 2.06.62 2.88.08.11.19.19.28.29V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-6.94c.09-.09.2-.18.28-.28.64-.82.87-1.87.62-2.89m-2.99-3.9 1.05 4.37c.1.42.01.84-.25 1.17-.14.18-.44.47-.94.47-.61 0-1.14-.49-1.21-1.14L16.98 5zM13 5h1.96l.54 4.52c.05.39-.07.78-.33 1.07-.22.26-.54.41-.95.41-.67 0-1.22-.59-1.22-1.31zM8.49 9.52 9.04 5H11v4.69c0 .72-.55 1.31-1.29 1.31-.34 0-.65-.15-.89-.41-.25-.29-.37-.68-.33-1.07m-4.45-.16L5.05 5h1.97l-.58 4.86c-.08.65-.6 1.14-1.21 1.14-.49 0-.8-.29-.93-.47-.27-.32-.36-.75-.26-1.17M5 19v-6.03c.08.01.15.03.23.03.87 0 1.66-.36 2.24-.95.6.6 1.4.95 2.31.95.87 0 1.65-.36 2.23-.93.59.57 1.39.93 2.29.93.84 0 1.64-.35 2.24-.95.58.59 1.37.95 2.24.95.08 0 .15-.02.23-.03V19z"}),"Storefront"),pe}var Yo=Ho();const Uo=Dt(Yo);var de={},jt;function Bo(){if(jt)return de;jt=1;var e=Mt();Object.defineProperty(de,"__esModule",{value:!0}),de.default=void 0;var t=e(Tt()),r=Rt();return de.default=(0,t.default)((0,r.jsx)("path",{d:"M14 10H3v2h11zm0-4H3v2h11zm4 8v-4h-2v4h-4v2h4v4h2v-4h4v-2zM3 16h7v-2H3z"}),"PlaylistAdd"),de}var zo=Bo();const Ge=Dt(zo);Qe`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`;const Xe=()=>o.jsxs(St,{sx:{mb:3,border:"1px solid #e0e0e0",boxShadow:"4px 4px 8px rgba(0,0,0,0.1)"},children:[o.jsx(It,{avatar:o.jsx($,{animation:"wave",variant:"circular",width:40,height:40}),title:o.jsx($,{animation:"wave",height:20,width:"80%"}),sx:{backgroundColor:"grey.200"}}),o.jsxs(At,{sx:{flexGrow:1,display:"flex",flexDirection:"column",gap:1.5,pt:1},children:[o.jsx($,{animation:"wave",height:15,width:"90%"}),o.jsx($,{animation:"wave",height:15,width:"60%"}),o.jsx($,{animation:"wave",height:15,width:"60%"}),o.jsx($,{animation:"wave",height:15,width:"60%"})]}),o.jsxs(Et,{sx:{justifyContent:"space-between",px:2,py:1.5,backgroundColor:"grey.50"},children:[o.jsx($,{animation:"wave",variant:"circular",width:32,height:32}),o.jsx($,{animation:"wave",variant:"rectangular",width:100,height:36})]})]}),Wo=(e,t,r,l)=>{const d=e*Math.PI/180,h=r*Math.PI/180,m=(r-e)*Math.PI/180,f=(l-t)*Math.PI/180,x=Math.sin(m/2)*Math.sin(m/2)+Math.cos(d)*Math.cos(h)*Math.sin(f/2)*Math.sin(f/2);return 6371e3*(2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x)))},Zo=()=>{var M;const e=i.useMemo(()=>({"Checked In":0,Planned:1,Completed:2,Canceled:3,Draft:4}),[]),{employeeId:t}=so(),r=ro(),[l,p]=i.useState([]),[d,h]=i.useState(!0),[m,f]=i.useState(null),[x,I]=i.useState(0),[j,k]=i.useState(!0),[D,B]=i.useState(!1),[Ae,Q]=i.useState(0),N=i.useRef(null),he=i.useCallback(s=>{D||(N.current&&N.current.disconnect(),N.current=new IntersectionObserver(n=>{n[0].isIntersecting&&j&&I(a=>a+1)}),s&&N.current.observe(s))},[D,j]),[me,Z]=i.useState(!1),[F,z]=i.useState(null),C=i.useRef(null),H=i.useRef(null),[A,P]=i.useState(null),[ee,fe]=i.useState(null),[v,Ee]=i.useState(null),[te,_]=i.useState(!1),[oe,y]=i.useState(null),Y=i.useCallback(s=>s.sort((n,a)=>(e[n.status]??99)-(e[a.status]??99)),[e]),E=i.useCallback(async s=>{if(!t){f("Employee ID not available."),h(!1),B(!1);return}s===0?h(!0):B(!0);try{const n=await no(s),a=n.data,g=n.total;s===0?(p(Y(a)),Q(g),k(a.length<g)):p(q=>{const G=[...q,...a],T=Array.from(new Map(G.map(be=>[be.name,be])).values()),se=Y(T);return k(se.length<g),se}),f(null)}catch(n){console.error("Error fetching visit plans:",n),f(n instanceof Error?n.message:"Failed to fetch data."),k(!1)}finally{s===0&&h(!1),B(!1)}},[t,Y,d,D]);i.useEffect(()=>{t&&(p([]),I(0),k(!0),Q(0),E(0))},[t,E]),i.useEffect(()=>{x>0&&E(x)},[x,E]),i.useEffect(()=>{l.forEach(s=>{s.checkout_time&&console.log(`DEBUG: Plan ${s.name} Checkout Time: ${X(s.checkout_time,"DD/MM/YY HH:mm:ss").isValid()}`)})},[l]);const ge=i.useCallback(s=>{if(s.parent_docstatus===0)return o.jsx(qe,{title:s.parent,arrow:!0,children:o.jsx(ce,{label:"Draft",color:"warning",size:"small",sx:{fontWeight:"bold"}})});let n="default",a=s.status;switch(s.status){case"Planned":n="primary";break;case"Checked In":n="secondary";break;case"Completed":n="success";break;case"Canceled":n="error";break;default:a="Draft",n="error";break}return o.jsx(qe,{title:s.parent,arrow:!0,children:o.jsx(ce,{label:a,color:n,size:"small",sx:{fontWeight:"bold"}})})},[]),Le=async s=>{try{await ft(s,"Checked In")?E(0):f("Failed to check-in.")}catch(n){f(n instanceof Error?n.message:"An unexpected error occurred during check-in.")}},xe=s=>{const n=l.find(a=>a.name===s);n&&n.checkin_time&&(X(n.checkin_time,"DD-MM-YYYY HH:mm:ss").toDate().getTime(),new Date().getTime()),z(s),Z(!0),P(null),fe(null),y(null),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({video:!0}).then(a=>{C.current&&(C.current.srcObject=a)}).catch(a=>{console.error("Camera access denied:",a),y("Camera access is required. Please enable it in your browser settings.")}),navigator.geolocation?navigator.geolocation.getCurrentPosition(a=>{Ee({latitude:a.coords.latitude,longitude:a.coords.longitude})},a=>{console.error("Location access denied:",a);let g="Location access is required.";a instanceof GeolocationPositionError?a.code===a.PERMISSION_DENIED?g+=" Please enable it in your browser settings.":a.code===a.POSITION_UNAVAILABLE?g+=" Location information is unavailable.":a.code===a.TIMEOUT&&(g+=" The request to get user location timed out."):g+=" An unknown error occurred.",y(g)}):y("Geolocation is not supported by your browser.")},W=()=>{var s;Z(!1),z(null),(s=C.current)!=null&&s.srcObject&&C.current.srcObject.getTracks().forEach(n=>n.stop())},$e=i.useCallback(()=>{if(C.current&&H.current){const s=C.current,n=H.current;n.width=s.videoWidth,n.height=s.videoHeight;const a=n.getContext("2d");if(a){a.drawImage(s,0,0,s.videoWidth,s.videoHeight);const g=n.toDataURL("image/jpeg");P(g),n.toBlob(q=>{if(q){const G=new File([q],"captured_photo.jpeg",{type:"image/jpeg"});fe(G)}},"image/jpeg")}}},[]),ve=i.useCallback(async()=>{if(!v||!F||!ee){y("Please ensure a photo has been taken and location is available.");return}_(!0),y(null);try{const s=l.find(a=>a.name===F);if(!s)throw new Error("Could not find current visit plan details.");const n=await ao(s.store_name);if(n&&n.latitude&&n.longitude){const a=Wo(n.latitude,n.longitude,v.latitude,v.longitude);if(a>10){y(`Check-out Gagal. Lokasi Anda (berjarak ${Math.round(a)} meter) terlalu jauh dari lokasi master. Batas yang diizinkan adalah 10 meter.`),_(!1);return}}}catch(s){console.error("Error during master location check:",s)}try{await ft(F,"Completed",{latitude:v.latitude,longitude:v.longitude,photo_file:ee,checkout_time:X().format("YYYY-MM-DD HH:mm:ss")})?(_(!1),W(),E(0)):(_(!1),y("Failed to complete checkout."))}catch(s){_(!1),y(s instanceof Error?s.message:"An unexpected error occurred during checkout.")}finally{_(!1)}},[F,v,ee,l]),V=i.useCallback((s,n)=>{if(!s)return"N/A";const a=X(s,"DD-MM-YYYY HH:mm:ss");if(!a.isValid())return"Invalid Date";if(n){const g=X(n,"DD-MM-YYYY HH:mm");if(g.isValid()&&a.isSame(g,"day"))return a.format("HH:mm")}return a.format("DD-MM-YYYY HH:mm")},[]);return o.jsxs(o.Fragment,{children:[o.jsxs(go,{maxWidth:"lg",sx:{mt:4,mb:4},children:[o.jsx(R,{variant:"h4",component:"h1",gutterBottom:!0,align:"center",sx:{fontWeight:"bold"},children:"My Visit Schedule"}),o.jsx(L,{sx:{mb:2,textAlign:"right"},children:o.jsx(K,{variant:"contained",startIcon:o.jsx(io,{}),onClick:()=>r("/history"),children:"History"})}),d&&x===0?o.jsxs(L,{children:[o.jsx(Xe,{}),o.jsx(Xe,{}),o.jsx(Xe,{})]}):m?o.jsx(Ve,{severity:"error",children:m}):l.length===0?o.jsx(Ve,{severity:"info",sx:{mt:2},children:"No visit plans found."}):o.jsxs(L,{children:[l.map((s,n)=>o.jsxs(St,{sx:{mb:3,border:"1px solid #e0e0e0",boxShadow:"4px 4px 8px rgba(0,0,0,0.1)"},ref:l.length===n+1?he:null,children:[o.jsx(It,{avatar:o.jsx(Uo,{sx:{color:"primary.main",fontSize:40}}),title:o.jsx(R,{variant:"h6",sx:{fontWeight:"bold"},children:s.store_name}),subheader:o.jsx(R,{variant:"body2",color:"text.secondary",children:s.address}),sx:{backgroundColor:"grey.100",py:1.5}}),o.jsxs(At,{sx:{display:"flex",flexDirection:"column",gap:1.5,pt:1},children:[o.jsxs(L,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o.jsx(ce,{label:o.jsxs(L,{component:"span",children:["Planning :"," ",o.jsx(R,{component:"span",sx:{fontWeight:"bold",color:"#FFFFFF"},children:s.planned_visit_time?X(s.planned_visit_time,"DD-MM-YYYY HH:mm").format("DD-MM-YYYY HH:mm"):"N/A"})]}),color:"info",size:"small"}),ge(s)]}),o.jsx(ce,{icon:o.jsx(Ge,{}),label:`CheckIn: ${V(s.checkin_time,s.planned_visit_time)}`,variant:"outlined",size:"small"}),o.jsx(ce,{icon:o.jsx(Ge,{}),label:`CheckOut: ${V(s.checkout_time,s.planned_visit_time)}`,variant:"outlined",size:"small"}),s.notes&&o.jsxs(R,{variant:"body2",sx:{fontStyle:"italic",color:"text.secondary"},children:["Notes: ",s.notes]})]}),o.jsxs(Et,{sx:{justifyContent:"space-between",px:2,py:1.5,backgroundColor:"grey.50"},children:[o.jsx(lo,{onClick:()=>r(`/notes/${s.name}`),"aria-label":"Add Notes",children:o.jsx(qe,{title:"Add Notes",children:o.jsx(Ge,{sx:{color:"primary.main"}})})}),o.jsxs(L,{children:[s.status==="Planned"&&o.jsx(K,{variant:"contained",color:"secondary",onClick:()=>Le(s.name),children:"Check In"}),s.status==="Checked In"&&o.jsx(K,{variant:"contained",color:"success",onClick:()=>xe(s.name),children:"Check Out"})]})]})]},s.name)),D&&o.jsx(L,{sx:{display:"flex",justifyContent:"center",my:2},children:o.jsx(We,{})}),!j&&o.jsx(R,{variant:"body2",align:"center",color:"text.secondary",sx:{my:2},children:"You have reached the end of the list."})]})]}),o.jsxs(ho,{open:me,onClose:W,fullWidth:!0,maxWidth:"sm",children:[o.jsx(Mo,{children:"Complete Checkout"}),o.jsxs(mo,{children:[oe&&o.jsx(Ve,{severity:"error",sx:{mb:2},children:oe}),o.jsxs(L,{sx:{display:"flex",flexDirection:"column",gap:2},children:[o.jsx(R,{children:"Take Photo:"}),o.jsx("video",{ref:C,style:{width:"100%",border:"1px solid #ccc"},autoPlay:!0,playsInline:!0}),o.jsx(K,{variant:"outlined",onClick:$e,disabled:!((M=C.current)!=null&&M.srcObject),children:"Capture Photo"}),A&&o.jsx("img",{src:A,alt:"Captured",style:{width:"100%",border:"1px solid #ccc"}}),o.jsx("canvas",{ref:H,style:{display:"none"}}),o.jsx(R,{children:"Current Location:"}),v?o.jsxs(R,{children:["Lat: ",v.latitude.toFixed(6),", Lng: ",v.longitude.toFixed(6)]}):o.jsx(We,{size:20})]})]}),o.jsxs(fo,{children:[o.jsx(K,{onClick:W,disabled:te,children:"Cancel"}),o.jsx(K,{onClick:ve,disabled:te||!A||!v,variant:"contained",children:te?o.jsx(We,{size:24,color:"inherit"}):"Complete Checkout"})]})]})]})};export{Zo as default};
