import{g as Ge,a as Xe,r as i,u as Se,_ as _e,b as p,j as e,s as Q,c as B,d as Ae,T as M,e as dt,k as Ke,h as Xt,i as Kt,m as Pe,n as Jt,o as Qt,p as ht,q as Zt,t as eo,v as to,w as Te,x as oo,y as jt,z as kt,A as Pt,D as Tt,E as Mt,F as Rt,G as so,H as ro,I as no,J as io,B as E,K as ao,L as lo,C as We,M as mt}from"./index-Cy-fES0w.js";import{D as co,g as po,a as uo,P as Dt,h as K,C as le,b as ho,c as mo,d as fo}from"./moment-CUqekIAn.js";import{C as go,A as Ye}from"./Container-D1CBMBBI.js";import{B as J}from"./Button-BsvWVcSu.js";import{C as St,a as _t,b as At}from"./CardHeader-QUayKRjV.js";import{G as ft}from"./Grow-aaZCw91A.js";function xo(t){return String(t).match(/[\d.\-+]*\s*(.*)/)[1]||""}function vo(t){return parseFloat(t)}function bo(t){return Ge("MuiCardActions",t)}Xe("MuiCardActions",["root","spacing"]);const Co=["disableSpacing","className"],yo=t=>{const{classes:o,disableSpacing:r}=t;return Ae({root:["root",!r&&"spacing"]},bo,o)},wo=Q("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:r}=t;return[o.root,!r.disableSpacing&&o.spacing]}})(({ownerState:t})=>p({display:"flex",alignItems:"center",padding:8},!t.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})),It=i.forwardRef(function(o,r){const c=Se({props:o,name:"MuiCardActions"}),{disableSpacing:d=!1,className:m}=c,h=_e(c,Co),f=p({},c,{disableSpacing:d}),g=yo(f);return e.jsx(wo,p({className:B(g.root,m),ownerState:f,ref:r},h))}),jo=["className","id"],ko=t=>{const{classes:o}=t;return Ae({root:["root"]},po,o)},Po=Q(M,{name:"MuiDialogTitle",slot:"Root",overridesResolver:(t,o)=>o.root})({padding:"16px 24px",flex:"0 0 auto"}),To=i.forwardRef(function(o,r){const c=Se({props:o,name:"MuiDialogTitle"}),{className:d,id:m}=c,h=_e(c,jo),f=c,g=ko(f),{titleId:w=m}=i.useContext(co);return e.jsx(Po,p({component:"h2",className:B(g.root,d),ownerState:f,ref:r,variant:"h6",id:m??w},h))});function Mo(t){return Ge("MuiSkeleton",t)}Xe("MuiSkeleton",["root","text","rectangular","rounded","circular","pulse","wave","withChildren","fitContent","heightAuto"]);const Ro=["animation","className","component","height","style","variant","width"];let De=t=>t,gt,xt,vt,bt;const Do=t=>{const{classes:o,variant:r,animation:c,hasChildren:d,width:m,height:h}=t;return Ae({root:["root",r,c,d&&"withChildren",d&&!m&&"fitContent",d&&!h&&"heightAuto"]},Mo,o)},So=Ke(gt||(gt=De`
  0% {
    opacity: 1;
  }

  50% {
    opacity: 0.4;
  }

  100% {
    opacity: 1;
  }
`)),_o=Ke(xt||(xt=De`
  0% {
    transform: translateX(-100%);
  }

  50% {
    /* +0.5s of delay between each loop */
    transform: translateX(100%);
  }

  100% {
    transform: translateX(100%);
  }
`)),Ao=Q("span",{name:"MuiSkeleton",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:r}=t;return[o.root,o[r.variant],r.animation!==!1&&o[r.animation],r.hasChildren&&o.withChildren,r.hasChildren&&!r.width&&o.fitContent,r.hasChildren&&!r.height&&o.heightAuto]}})(({theme:t,ownerState:o})=>{const r=xo(t.shape.borderRadius)||"px",c=vo(t.shape.borderRadius);return p({display:"block",backgroundColor:t.vars?t.vars.palette.Skeleton.bg:uo(t.palette.text.primary,t.palette.mode==="light"?.11:.13),height:"1.2em"},o.variant==="text"&&{marginTop:0,marginBottom:0,height:"auto",transformOrigin:"0 55%",transform:"scale(1, 0.60)",borderRadius:`${c}${r}/${Math.round(c/.6*10)/10}${r}`,"&:empty:before":{content:'"\\00a0"'}},o.variant==="circular"&&{borderRadius:"50%"},o.variant==="rounded"&&{borderRadius:(t.vars||t).shape.borderRadius},o.hasChildren&&{"& > *":{visibility:"hidden"}},o.hasChildren&&!o.width&&{maxWidth:"fit-content"},o.hasChildren&&!o.height&&{height:"auto"})},({ownerState:t})=>t.animation==="pulse"&&dt(vt||(vt=De`
      animation: ${0} 2s ease-in-out 0.5s infinite;
    `),So),({ownerState:t,theme:o})=>t.animation==="wave"&&dt(bt||(bt=De`
      position: relative;
      overflow: hidden;

      /* Fix bug in Safari https://bugs.webkit.org/show_bug.cgi?id=68196 */
      -webkit-mask-image: -webkit-radial-gradient(white, black);

      &::after {
        animation: ${0} 2s linear 0.5s infinite;
        background: linear-gradient(
          90deg,
          transparent,
          ${0},
          transparent
        );
        content: '';
        position: absolute;
        transform: translateX(-100%); /* Avoid flash during server-side hydration */
        bottom: 0;
        left: 0;
        right: 0;
        top: 0;
      }
    `),_o,(o.vars||o).palette.action.hover)),$=i.forwardRef(function(o,r){const c=Se({props:o,name:"MuiSkeleton"}),{animation:d="pulse",className:m,component:h="span",height:f,style:g,variant:w="text",width:W}=c,R=_e(c,Ro),O=p({},c,{animation:d,component:h,variant:w,hasChildren:!!R.children}),j=Do(O);return e.jsx(Ao,p({as:h,ref:r,className:B(j.root,m),ownerState:O},R,{style:p({width:W,height:f},g)}))});function Io(t){return Ge("MuiTooltip",t)}const L=Xe("MuiTooltip",["popper","popperInteractive","popperArrow","popperClose","tooltip","tooltipArrow","touch","tooltipPlacementLeft","tooltipPlacementRight","tooltipPlacementTop","tooltipPlacementBottom","arrow"]),Eo=["arrow","children","classes","components","componentsProps","describeChild","disableFocusListener","disableHoverListener","disableInteractive","disableTouchListener","enterDelay","enterNextDelay","enterTouchDelay","followCursor","id","leaveDelay","leaveTouchDelay","onClose","onOpen","open","placement","PopperComponent","PopperProps","slotProps","slots","title","TransitionComponent","TransitionProps"];function $o(t){return Math.round(t*1e5)/1e5}const Lo=t=>{const{classes:o,disableInteractive:r,arrow:c,touch:d,placement:m}=t,h={popper:["popper",!r&&"popperInteractive",c&&"popperArrow"],tooltip:["tooltip",c&&"tooltipArrow",d&&"touch",`tooltipPlacement${jt(m.split("-")[0])}`],arrow:["arrow"]};return Ae(h,Io,o)},Oo=Q(Dt,{name:"MuiTooltip",slot:"Popper",overridesResolver:(t,o)=>{const{ownerState:r}=t;return[o.popper,!r.disableInteractive&&o.popperInteractive,r.arrow&&o.popperArrow,!r.open&&o.popperClose]}})(({theme:t,ownerState:o,open:r})=>p({zIndex:(t.vars||t).zIndex.tooltip,pointerEvents:"none"},!o.disableInteractive&&{pointerEvents:"auto"},!r&&{pointerEvents:"none"},o.arrow&&{[`&[data-popper-placement*="bottom"] .${L.arrow}`]:{top:0,marginTop:"-0.71em","&::before":{transformOrigin:"0 100%"}},[`&[data-popper-placement*="top"] .${L.arrow}`]:{bottom:0,marginBottom:"-0.71em","&::before":{transformOrigin:"100% 0"}},[`&[data-popper-placement*="right"] .${L.arrow}`]:p({},o.isRtl?{right:0,marginRight:"-0.71em"}:{left:0,marginLeft:"-0.71em"},{height:"1em",width:"0.71em","&::before":{transformOrigin:"100% 100%"}}),[`&[data-popper-placement*="left"] .${L.arrow}`]:p({},o.isRtl?{left:0,marginLeft:"-0.71em"}:{right:0,marginRight:"-0.71em"},{height:"1em",width:"0.71em","&::before":{transformOrigin:"0 0"}})})),No=Q("div",{name:"MuiTooltip",slot:"Tooltip",overridesResolver:(t,o)=>{const{ownerState:r}=t;return[o.tooltip,r.touch&&o.touch,r.arrow&&o.tooltipArrow,o[`tooltipPlacement${jt(r.placement.split("-")[0])}`]]}})(({theme:t,ownerState:o})=>p({backgroundColor:t.vars?t.vars.palette.Tooltip.bg:kt.alpha(t.palette.grey[700],.92),borderRadius:(t.vars||t).shape.borderRadius,color:(t.vars||t).palette.common.white,fontFamily:t.typography.fontFamily,padding:"4px 8px",fontSize:t.typography.pxToRem(11),maxWidth:300,margin:2,wordWrap:"break-word",fontWeight:t.typography.fontWeightMedium},o.arrow&&{position:"relative",margin:0},o.touch&&{padding:"8px 16px",fontSize:t.typography.pxToRem(14),lineHeight:`${$o(16/14)}em`,fontWeight:t.typography.fontWeightRegular},{[`.${L.popper}[data-popper-placement*="left"] &`]:p({transformOrigin:"right center"},o.isRtl?p({marginLeft:"14px"},o.touch&&{marginLeft:"24px"}):p({marginRight:"14px"},o.touch&&{marginRight:"24px"})),[`.${L.popper}[data-popper-placement*="right"] &`]:p({transformOrigin:"left center"},o.isRtl?p({marginRight:"14px"},o.touch&&{marginRight:"24px"}):p({marginLeft:"14px"},o.touch&&{marginLeft:"24px"})),[`.${L.popper}[data-popper-placement*="top"] &`]:p({transformOrigin:"center bottom",marginBottom:"14px"},o.touch&&{marginBottom:"24px"}),[`.${L.popper}[data-popper-placement*="bottom"] &`]:p({transformOrigin:"center top",marginTop:"14px"},o.touch&&{marginTop:"24px"})})),Fo=Q("span",{name:"MuiTooltip",slot:"Arrow",overridesResolver:(t,o)=>o.arrow})(({theme:t})=>({overflow:"hidden",position:"absolute",width:"1em",height:"0.71em",boxSizing:"border-box",color:t.vars?t.vars.palette.Tooltip.bg:kt.alpha(t.palette.grey[700],.9),"&::before":{content:'""',margin:"auto",display:"block",width:"100%",height:"100%",backgroundColor:"currentColor",transform:"rotate(45deg)"}}));let Me=!1;const Ct=new oo;let ce={x:0,y:0};function Re(t,o){return(r,...c)=>{o&&o(r,...c),t(r,...c)}}const ze=i.forwardRef(function(o,r){var c,d,m,h,f,g,w,W,R,O,j,Z,N,de,he,ee,Y,te,v;const F=Se({props:o,name:"MuiTooltip"}),{arrow:z=!1,children:V,components:H={},componentsProps:k={},describeChild:D=!1,disableFocusListener:Ie=!1,disableHoverListener:q=!1,disableInteractive:G=!1,disableTouchListener:me=!1,enterDelay:b=100,enterNextDelay:S=0,enterTouchDelay:fe=700,followCursor:P=!1,id:ge,leaveDelay:U=0,leaveTouchDelay:xe=1500,onClose:ve,onOpen:be,open:Ee,placement:X="bottom",PopperComponent:oe,PopperProps:_={},slotProps:T={},slots:s={},title:n,TransitionComponent:a=ft,TransitionProps:u}=F,A=_e(F,Eo),C=i.isValidElement(V)?V:e.jsx("span",{children:V}),Je=Xt(),Et=Kt(),[se,Qe]=i.useState(),[$e,$t]=i.useState(null),Ce=i.useRef(!1),Le=G||P,Ze=Pe(),Oe=Pe(),ye=Pe(),et=Pe(),[Lt,tt]=Jt({controlled:Ee,default:!1,name:"Tooltip",state:"open"});let I=Lt;const Ne=Qt(ge),re=i.useRef(),we=ht(()=>{re.current!==void 0&&(document.body.style.WebkitUserSelect=re.current,re.current=void 0),et.clear()});i.useEffect(()=>we,[we]);const ot=l=>{Ct.clear(),Me=!0,tt(!0),be&&!I&&be(l)},je=ht(l=>{Ct.start(800+U,()=>{Me=!1}),tt(!1),ve&&I&&ve(l),Ze.start(Je.transitions.duration.shortest,()=>{Ce.current=!1})}),ke=l=>{Ce.current&&l.type!=="touchstart"||(se&&se.removeAttribute("title"),Oe.clear(),ye.clear(),b||Me&&S?Oe.start(Me?S:b,()=>{ot(l)}):ot(l))},Fe=l=>{Oe.clear(),ye.start(U,()=>{je(l)})},{isFocusVisibleRef:st,onBlur:Ot,onFocus:Nt,ref:Ft}=Zt(),[,rt]=i.useState(!1),nt=l=>{Ot(l),st.current===!1&&(rt(!1),Fe(l))},it=l=>{se||Qe(l.currentTarget),Nt(l),st.current===!0&&(rt(!0),ke(l))},at=l=>{Ce.current=!0;const x=C.props;x.onTouchStart&&x.onTouchStart(l)},Ht=l=>{at(l),ye.clear(),Ze.clear(),we(),re.current=document.body.style.WebkitUserSelect,document.body.style.WebkitUserSelect="none",et.start(fe,()=>{document.body.style.WebkitUserSelect=re.current,ke(l)})},Ut=l=>{C.props.onTouchEnd&&C.props.onTouchEnd(l),we(),ye.start(xe,()=>{je(l)})};i.useEffect(()=>{if(!I)return;function l(x){(x.key==="Escape"||x.key==="Esc")&&je(x)}return document.addEventListener("keydown",l),()=>{document.removeEventListener("keydown",l)}},[je,I]);const Bt=eo(to(C),Ft,Qe,r);!n&&n!==0&&(I=!1);const He=i.useRef(),Wt=l=>{const x=C.props;x.onMouseMove&&x.onMouseMove(l),ce={x:l.clientX,y:l.clientY},He.current&&He.current.update()},ne={},Ue=typeof n=="string";D?(ne.title=!I&&Ue&&!q?n:null,ne["aria-describedby"]=I?Ne:null):(ne["aria-label"]=Ue?n:null,ne["aria-labelledby"]=I&&!Ue?Ne:null);const y=p({},ne,A,C.props,{className:B(A.className,C.props.className),onTouchStart:at,ref:Bt},P?{onMouseMove:Wt}:{}),ie={};me||(y.onTouchStart=Ht,y.onTouchEnd=Ut),q||(y.onMouseOver=Re(ke,y.onMouseOver),y.onMouseLeave=Re(Fe,y.onMouseLeave),Le||(ie.onMouseOver=ke,ie.onMouseLeave=Fe)),Ie||(y.onFocus=Re(it,y.onFocus),y.onBlur=Re(nt,y.onBlur),Le||(ie.onFocus=it,ie.onBlur=nt));const Yt=i.useMemo(()=>{var l;let x=[{name:"arrow",enabled:!!$e,options:{element:$e,padding:4}}];return(l=_.popperOptions)!=null&&l.modifiers&&(x=x.concat(_.popperOptions.modifiers)),p({},_.popperOptions,{modifiers:x})},[$e,_]),ae=p({},F,{isRtl:Et,arrow:z,disableInteractive:Le,placement:X,PopperComponentProp:oe,touch:Ce.current}),Be=Lo(ae),lt=(c=(d=s.popper)!=null?d:H.Popper)!=null?c:Oo,ct=(m=(h=(f=s.transition)!=null?f:H.Transition)!=null?h:a)!=null?m:ft,pt=(g=(w=s.tooltip)!=null?w:H.Tooltip)!=null?g:No,ut=(W=(R=s.arrow)!=null?R:H.Arrow)!=null?W:Fo,zt=Te(lt,p({},_,(O=T.popper)!=null?O:k.popper,{className:B(Be.popper,_==null?void 0:_.className,(j=(Z=T.popper)!=null?Z:k.popper)==null?void 0:j.className)}),ae),Vt=Te(ct,p({},u,(N=T.transition)!=null?N:k.transition),ae),qt=Te(pt,p({},(de=T.tooltip)!=null?de:k.tooltip,{className:B(Be.tooltip,(he=(ee=T.tooltip)!=null?ee:k.tooltip)==null?void 0:he.className)}),ae),Gt=Te(ut,p({},(Y=T.arrow)!=null?Y:k.arrow,{className:B(Be.arrow,(te=(v=T.arrow)!=null?v:k.arrow)==null?void 0:te.className)}),ae);return e.jsxs(i.Fragment,{children:[i.cloneElement(C,y),e.jsx(lt,p({as:oe??Dt,placement:X,anchorEl:P?{getBoundingClientRect:()=>({top:ce.y,left:ce.x,right:ce.x,bottom:ce.y,width:0,height:0})}:se,popperRef:He,open:se?I:!1,id:Ne,transition:!0},ie,zt,{popperOptions:Yt,children:({TransitionProps:l})=>e.jsx(ct,p({timeout:Je.transitions.duration.shorter},l,Vt,{children:e.jsxs(pt,p({},qt,{children:[n,z?e.jsx(ut,p({},Gt,{ref:$t})):null]}))}))}))]})});var pe={},yt;function Ho(){if(yt)return pe;yt=1;var t=Pt();Object.defineProperty(pe,"__esModule",{value:!0}),pe.default=void 0;var o=t(Tt()),r=Mt();return pe.default=(0,o.default)((0,r.jsx)("path",{d:"m21.9 8.89-1.05-4.37c-.22-.9-1-1.52-1.91-1.52H5.05c-.9 0-1.69.63-1.9 1.52L2.1 8.89c-.24 1.02-.02 2.06.62 2.88.08.11.19.19.28.29V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-6.94c.09-.09.2-.18.28-.28.64-.82.87-1.87.62-2.89m-2.99-3.9 1.05 4.37c.1.42.01.84-.25 1.17-.14.18-.44.47-.94.47-.61 0-1.14-.49-1.21-1.14L16.98 5zM13 5h1.96l.54 4.52c.05.39-.07.78-.33 1.07-.22.26-.54.41-.95.41-.67 0-1.22-.59-1.22-1.31zM8.49 9.52 9.04 5H11v4.69c0 .72-.55 1.31-1.29 1.31-.34 0-.65-.15-.89-.41-.25-.29-.37-.68-.33-1.07m-4.45-.16L5.05 5h1.97l-.58 4.86c-.08.65-.6 1.14-1.21 1.14-.49 0-.8-.29-.93-.47-.27-.32-.36-.75-.26-1.17M5 19v-6.03c.08.01.15.03.23.03.87 0 1.66-.36 2.24-.95.6.6 1.4.95 2.31.95.87 0 1.65-.36 2.23-.93.59.57 1.39.93 2.29.93.84 0 1.64-.35 2.24-.95.58.59 1.37.95 2.24.95.08 0 .15-.02.23-.03V19z"}),"Storefront"),pe}var Uo=Ho();const Bo=Rt(Uo);var ue={},wt;function Wo(){if(wt)return ue;wt=1;var t=Pt();Object.defineProperty(ue,"__esModule",{value:!0}),ue.default=void 0;var o=t(Tt()),r=Mt();return ue.default=(0,o.default)((0,r.jsx)("path",{d:"M14 10H3v2h11zm0-4H3v2h11zm4 8v-4h-2v4h-4v2h4v4h2v-4h4v-2zM3 16h7v-2H3z"}),"PlaylistAdd"),ue}var Yo=Wo();const Ve=Rt(Yo);Ke`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`;const qe=()=>e.jsxs(St,{sx:{mb:3,border:"1px solid #e0e0e0",boxShadow:"4px 4px 8px rgba(0,0,0,0.1)"},children:[e.jsx(_t,{avatar:e.jsx($,{animation:"wave",variant:"circular",width:40,height:40}),title:e.jsx($,{animation:"wave",height:20,width:"80%"}),sx:{backgroundColor:"grey.200"}}),e.jsxs(At,{sx:{flexGrow:1,display:"flex",flexDirection:"column",gap:1.5,pt:1},children:[e.jsx($,{animation:"wave",height:15,width:"90%"}),e.jsx($,{animation:"wave",height:15,width:"60%"}),e.jsx($,{animation:"wave",height:15,width:"60%"}),e.jsx($,{animation:"wave",height:15,width:"60%"})]}),e.jsxs(It,{sx:{justifyContent:"space-between",px:2,py:1.5,backgroundColor:"grey.50"},children:[e.jsx($,{animation:"wave",variant:"circular",width:32,height:32}),e.jsx($,{animation:"wave",variant:"rectangular",width:100,height:36})]})]}),Jo=()=>{var T;const t=i.useMemo(()=>({"Checked In":0,Planned:1,Completed:2,Canceled:3,Draft:4}),[]),{employeeId:o}=so(),r=ro(),[c,d]=i.useState([]),[m,h]=i.useState(!0),[f,g]=i.useState(null),[w,W]=i.useState(0),[R,O]=i.useState(!0),[j,Z]=i.useState(!1),N=i.useRef(null),de=i.useCallback(s=>{j||(N.current&&N.current.disconnect(),N.current=new IntersectionObserver(n=>{n[0].isIntersecting&&R&&W(a=>a+1)}),s&&N.current.observe(s))},[j,R]),[he,ee]=i.useState(!1),[Y,te]=i.useState(null),v=i.useRef(null),F=i.useRef(null),[z,V]=i.useState(null),[H,k]=i.useState(null),[D,Ie]=i.useState(null),[q,G]=i.useState(!1),[me,b]=i.useState(null),[S,fe]=i.useState(0),[P,ge]=i.useState(!1),U=i.useCallback(s=>s.sort((n,a)=>(t[n.status]??99)-(t[a.status]??99)),[t]),xe=i.useCallback(async s=>{if(!o){g("Employee ID not available."),h(!1);return}s===0&&!j?h(!0):Z(!0);try{const n=await no(s);n.length<io&&O(!1),n.length>0&&d(a=>{const u=[...a,...n],A=Array.from(new Map(u.map(C=>[C.name,C])).values());return U(A)})}catch(n){g(n instanceof Error?n.message:"Failed to fetch data.")}finally{s===0&&h(!1),Z(!1)}},[o,j,U]);i.useEffect(()=>{o&&xe(w)},[o,w,xe]),i.useEffect(()=>{let s;return P&&S>0?s=setTimeout(()=>fe(S-1),1e3):S===0&&ge(!1),()=>clearTimeout(s)},[S,P]),i.useEffect(()=>{console.log("DEBUG: visitPlans state updated:",c),c.forEach(s=>{s.checkout_time&&console.log(`DEBUG: Plan ${s.name} Checkout Time: ${K(s.checkout_time,"DD/MM/YY HH:mm:ss").isValid()}`)})},[c]);const ve=s=>{if(s.parent_docstatus===0)return e.jsx(ze,{title:s.parent,arrow:!0,children:e.jsx(le,{label:"Draft",color:"warning",size:"small",sx:{fontWeight:"bold"}})});let n="default",a=s.status;switch(s.status){case"Planned":n="primary";break;case"Checked In":n="secondary";break;case"Completed":n="success";break;case"Canceled":n="error";break;default:a="Draft",n="error";break}return e.jsx(ze,{title:s.parent,arrow:!0,children:e.jsx(le,{label:a,color:n,size:"small",sx:{fontWeight:"bold"}})})},be=async s=>{try{await mt(s,"Checked In")?d(a=>U(a.map(u=>u.name===s?{...u,status:"Checked In",checkin_time:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})}:u))):g("Failed to check-in.")}catch(n){g(n instanceof Error?n.message:"An unexpected error occurred during check-in.")}},Ee=s=>{const n=c.find(a=>a.name===s);if(n&&n.checkin_time){const a=K(n.checkin_time,"DD/MM/YY HH:mm:ss").toDate().getTime(),A=(new Date().getTime()-a)/1e3;A<180&&(fe(180-Math.floor(A)),ge(!0))}te(s),ee(!0),V(null),k(null),b(null),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({video:!0}).then(a=>{v.current&&(v.current.srcObject=a)}).catch(a=>{console.error("Camera access denied:",a),b("Camera access is required. Please enable it in your browser settings.")}),navigator.geolocation?navigator.geolocation.getCurrentPosition(a=>{Ie({latitude:a.coords.latitude,longitude:a.coords.longitude})},a=>{console.error("Location access denied:",a);let u="Location access is required.";a instanceof GeolocationPositionError?a.code===a.PERMISSION_DENIED?u+=" Please enable it in your browser settings.":a.code===a.POSITION_UNAVAILABLE?u+=" Location information is unavailable.":a.code===a.TIMEOUT&&(u+=" The request to get user location timed out."):u+=" An unknown error occurred.",b(u)}):b("Geolocation is not supported by your browser.")},X=()=>{var s;ee(!1),te(null),(s=v.current)!=null&&s.srcObject&&v.current.srcObject.getTracks().forEach(n=>n.stop())},oe=()=>{if(v.current&&F.current){const s=v.current,n=F.current;n.width=s.videoWidth,n.height=s.videoHeight;const a=n.getContext("2d");a&&(a.drawImage(s,0,0,n.width,n.height),n.toBlob(u=>{if(u){const A=new File([u],"checkout_photo.png",{type:"image/png"});k(A)}},"image/png"),V(n.toDataURL("image/png")))}},_=async()=>{if(!Y||!H||!D){b("Photo and location are required.");return}G(!0),b(null);try{const s={status:"Completed",latitude:D.latitude,longitude:D.longitude,photo:H,checkout_time:K().format("DD/MM/YY HH:mm:ss")};await mt(Y,"Completed",s)?(G(!1),X(),d(a=>U(a.map(u=>u.name===Y?{...u,status:"Completed",checkout_time:s.checkout_time}:u)))):(G(!1),b("Failed to complete checkout."))}catch(s){G(!1),b(s instanceof Error?s.message:"An unexpected error occurred during checkout.")}};return e.jsxs(e.Fragment,{children:[e.jsxs(go,{maxWidth:"lg",sx:{mt:4,mb:4},children:[e.jsx(M,{variant:"h4",component:"h1",gutterBottom:!0,align:"center",sx:{fontWeight:"bold"},children:"My Visit Schedule"}),e.jsx(E,{sx:{mb:2,textAlign:"right"},children:e.jsx(J,{variant:"contained",startIcon:e.jsx(ao,{}),onClick:()=>r("/history"),children:"History"})}),m&&w===0?e.jsxs(E,{children:[e.jsx(qe,{}),e.jsx(qe,{}),e.jsx(qe,{})]}):f?e.jsx(Ye,{severity:"error",children:f}):c.length===0?e.jsx(Ye,{severity:"info",sx:{mt:2},children:"No visit plans found."}):e.jsxs(E,{children:[c.map((s,n)=>e.jsxs(St,{sx:{mb:3,border:"1px solid #e0e0e0",boxShadow:"4px 4px 8px rgba(0,0,0,0.1)"},ref:c.length===n+1?de:null,children:[e.jsx(_t,{avatar:e.jsx(Bo,{sx:{color:"primary.main",fontSize:40}}),title:e.jsx(M,{variant:"h6",sx:{fontWeight:"bold"},children:s.store_name}),subheader:e.jsx(M,{variant:"body2",color:"text.secondary",children:s.address}),sx:{backgroundColor:"grey.100",py:1.5}}),e.jsxs(At,{sx:{display:"flex",flexDirection:"column",gap:1.5,pt:1},children:[e.jsxs(E,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(le,{label:e.jsxs(E,{component:"span",children:["Planning :"," ",e.jsx(M,{component:"span",sx:{fontWeight:"bold",color:"#FFFFFF"},children:s.planned_visit_time?K(s.planned_visit_time,"DD-MM-YYYY HH:mm").format("DD-MM-YYYY HH:mm"):"N/A"})]}),color:"info",size:"small"}),ve(s)]}),e.jsx(le,{icon:e.jsx(Ve,{}),label:`CheckIn: ${s.checkin_time?K(s.checkin_time,"DD/MM/YY HH:mm:ss").format("DD-MM-YY HH:mm"):"N/A"}`,variant:"outlined",size:"small"}),e.jsx(le,{icon:e.jsx(Ve,{}),label:`CheckOut: ${s.checkout_time?K(s.checkout_time,"DD/MM/YY HH:mm:ss").format("DD-MM-YY HH:mm"):"N/A"}`,variant:"outlined",size:"small"}),s.notes&&e.jsxs(M,{variant:"body2",sx:{fontStyle:"italic",color:"text.secondary"},children:["Notes: ",s.notes]})]}),e.jsxs(It,{sx:{justifyContent:"space-between",px:2,py:1.5,backgroundColor:"grey.50"},children:[e.jsx(lo,{onClick:()=>r(`/notes/${s.name}`),"aria-label":"Add Notes",children:e.jsx(ze,{title:"Add Notes",children:e.jsx(Ve,{sx:{color:"primary.main"}})})}),e.jsxs(E,{children:[s.status==="Planned"&&e.jsx(J,{variant:"contained",color:"secondary",onClick:()=>be(s.name),children:"Check In"}),s.status==="Checked In"&&e.jsx(J,{variant:"contained",color:"success",onClick:()=>Ee(s.name),disabled:P,children:P?`Wait ${S}s`:"Check Out"})]})]})]},s.name)),j&&e.jsx(E,{sx:{display:"flex",justifyContent:"center",my:2},children:e.jsx(We,{})}),!R&&e.jsx(M,{variant:"body2",align:"center",color:"text.secondary",sx:{my:2},children:"You have reached the end of the list."})]})]}),e.jsxs(ho,{open:he,onClose:X,fullWidth:!0,maxWidth:"sm",children:[e.jsx(To,{children:"Complete Checkout"}),e.jsxs(mo,{children:[me&&e.jsx(Ye,{severity:"error",sx:{mb:2},children:me}),e.jsxs(E,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(M,{children:"Take Photo:"}),e.jsx("video",{ref:v,style:{width:"100%",border:"1px solid #ccc"},autoPlay:!0,playsInline:!0}),e.jsx(J,{variant:"outlined",onClick:oe,disabled:!((T=v.current)!=null&&T.srcObject),children:"Capture Photo"}),z&&e.jsx("img",{src:z,alt:"Captured",style:{width:"100%",border:"1px solid #ccc"}}),e.jsx("canvas",{ref:F,style:{display:"none"}}),e.jsx(M,{children:"Current Location:"}),D?e.jsxs(M,{children:["Lat: ",D.latitude.toFixed(6),", Lng: ",D.longitude.toFixed(6)]}):e.jsx(We,{size:20})]})]}),e.jsxs(fo,{children:[e.jsx(J,{onClick:X,disabled:q,children:"Cancel"}),e.jsx(J,{onClick:_,disabled:q||!z||!D||P,variant:"contained",children:P?`Wait ${S}s`:q?e.jsx(We,{size:24,color:"inherit"}):"Complete Checkout"})]})]})]})};export{Jo as default};
