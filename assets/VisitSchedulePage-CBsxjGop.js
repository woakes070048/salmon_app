import{g as Ke,a as Je,r as n,u as _e,_ as Se,b as p,j as e,s as J,c as Y,d as Ie,T as M,e as ht,k as Qe,h as Xt,i as Kt,m as ke,n as Jt,o as Qt,p as mt,q as Zt,t as eo,v as to,w as Te,x as oo,y as Pt,z as kt,A as Tt,D as Mt,E as Rt,F as Dt,G as so,H as ro,I as no,J as ft,B as E,K as ao,L as io,C as ze}from"./index-DNKJl5Lo.js";import{D as lo,g as co,a as po,P as _t,h as X,C as ce,b as uo,c as ho,d as mo}from"./moment-BCczyfG-.js";import{G as gt}from"./Grow-CcqW7ME-.js";import{C as fo}from"./Container-BSKoWPXq.js";import{B as K}from"./Button-Zyb2IRUS.js";import{A as Ve}from"./Alert-px3SSr1L.js";import{C as St,a as It,b as At}from"./CardHeader-BmXNz3oH.js";function go(t){return String(t).match(/[\d.\-+]*\s*(.*)/)[1]||""}function xo(t){return parseFloat(t)}function vo(t){return Ke("MuiCardActions",t)}Je("MuiCardActions",["root","spacing"]);const bo=["disableSpacing","className"],Co=t=>{const{classes:o,disableSpacing:r}=t;return Ie({root:["root",!r&&"spacing"]},vo,o)},yo=J("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:r}=t;return[o.root,!r.disableSpacing&&o.spacing]}})(({ownerState:t})=>p({display:"flex",alignItems:"center",padding:8},!t.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})),Et=n.forwardRef(function(o,r){const c=_e({props:o,name:"MuiCardActions"}),{disableSpacing:u=!1,className:d}=c,h=Se(c,bo),f=p({},c,{disableSpacing:u}),g=Co(f);return e.jsx(yo,p({className:Y(g.root,d),ownerState:f,ref:r},h))}),wo=["className","id"],jo=t=>{const{classes:o}=t;return Ie({root:["root"]},co,o)},Po=J(M,{name:"MuiDialogTitle",slot:"Root",overridesResolver:(t,o)=>o.root})({padding:"16px 24px",flex:"0 0 auto"}),ko=n.forwardRef(function(o,r){const c=_e({props:o,name:"MuiDialogTitle"}),{className:u,id:d}=c,h=Se(c,wo),f=c,g=jo(f),{titleId:v=d}=n.useContext(lo);return e.jsx(Po,p({component:"h2",className:Y(g.root,u),ownerState:f,ref:r,variant:"h6",id:d??v},h))});function To(t){return Ke("MuiSkeleton",t)}Je("MuiSkeleton",["root","text","rectangular","rounded","circular","pulse","wave","withChildren","fitContent","heightAuto"]);const Mo=["animation","className","component","height","style","variant","width"];let De=t=>t,xt,vt,bt,Ct;const Ro=t=>{const{classes:o,variant:r,animation:c,hasChildren:u,width:d,height:h}=t;return Ie({root:["root",r,c,u&&"withChildren",u&&!d&&"fitContent",u&&!h&&"heightAuto"]},To,o)},Do=Qe(xt||(xt=De`
  0% {
    opacity: 1;
  }

  50% {
    opacity: 0.4;
  }

  100% {
    opacity: 1;
  }
`)),_o=Qe(vt||(vt=De`
  0% {
    transform: translateX(-100%);
  }

  50% {
    /* +0.5s of delay between each loop */
    transform: translateX(100%);
  }

  100% {
    transform: translateX(100%);
  }
`)),So=J("span",{name:"MuiSkeleton",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:r}=t;return[o.root,o[r.variant],r.animation!==!1&&o[r.animation],r.hasChildren&&o.withChildren,r.hasChildren&&!r.width&&o.fitContent,r.hasChildren&&!r.height&&o.heightAuto]}})(({theme:t,ownerState:o})=>{const r=go(t.shape.borderRadius)||"px",c=xo(t.shape.borderRadius);return p({display:"block",backgroundColor:t.vars?t.vars.palette.Skeleton.bg:po(t.palette.text.primary,t.palette.mode==="light"?.11:.13),height:"1.2em"},o.variant==="text"&&{marginTop:0,marginBottom:0,height:"auto",transformOrigin:"0 55%",transform:"scale(1, 0.60)",borderRadius:`${c}${r}/${Math.round(c/.6*10)/10}${r}`,"&:empty:before":{content:'"\\00a0"'}},o.variant==="circular"&&{borderRadius:"50%"},o.variant==="rounded"&&{borderRadius:(t.vars||t).shape.borderRadius},o.hasChildren&&{"& > *":{visibility:"hidden"}},o.hasChildren&&!o.width&&{maxWidth:"fit-content"},o.hasChildren&&!o.height&&{height:"auto"})},({ownerState:t})=>t.animation==="pulse"&&ht(bt||(bt=De`
      animation: ${0} 2s ease-in-out 0.5s infinite;
    `),Do),({ownerState:t,theme:o})=>t.animation==="wave"&&ht(Ct||(Ct=De`
      position: relative;
      overflow: hidden;

      /* Fix bug in Safari https://bugs.webkit.org/show_bug.cgi?id=68196 */
      -webkit-mask-image: -webkit-radial-gradient(white, black);

      &::after {
        animation: ${0} 2s linear 0.5s infinite;
        background: linear-gradient(
          90deg,
          transparent,
          ${0},
          transparent
        );
        content: '';
        position: absolute;
        transform: translateX(-100%); /* Avoid flash during server-side hydration */
        bottom: 0;
        left: 0;
        right: 0;
        top: 0;
      }
    `),_o,(o.vars||o).palette.action.hover)),O=n.forwardRef(function(o,r){const c=_e({props:o,name:"MuiSkeleton"}),{animation:u="pulse",className:d,component:h="span",height:f,style:g,variant:v="text",width:L}=c,R=Se(c,Mo),w=p({},c,{animation:u,component:h,variant:v,hasChildren:!!R.children}),D=Ro(w);return e.jsx(So,p({as:h,ref:r,className:Y(D.root,d),ownerState:w},R,{style:p({width:L,height:f},g)}))});function Io(t){return Ke("MuiTooltip",t)}const $=Je("MuiTooltip",["popper","popperInteractive","popperArrow","popperClose","tooltip","tooltipArrow","touch","tooltipPlacementLeft","tooltipPlacementRight","tooltipPlacementTop","tooltipPlacementBottom","arrow"]),Ao=["arrow","children","classes","components","componentsProps","describeChild","disableFocusListener","disableHoverListener","disableInteractive","disableTouchListener","enterDelay","enterNextDelay","enterTouchDelay","followCursor","id","leaveDelay","leaveTouchDelay","onClose","onOpen","open","placement","PopperComponent","PopperProps","slotProps","slots","title","TransitionComponent","TransitionProps"];function Eo(t){return Math.round(t*1e5)/1e5}const Oo=t=>{const{classes:o,disableInteractive:r,arrow:c,touch:u,placement:d}=t,h={popper:["popper",!r&&"popperInteractive",c&&"popperArrow"],tooltip:["tooltip",c&&"tooltipArrow",u&&"touch",`tooltipPlacement${Pt(d.split("-")[0])}`],arrow:["arrow"]};return Ie(h,Io,o)},$o=J(_t,{name:"MuiTooltip",slot:"Popper",overridesResolver:(t,o)=>{const{ownerState:r}=t;return[o.popper,!r.disableInteractive&&o.popperInteractive,r.arrow&&o.popperArrow,!r.open&&o.popperClose]}})(({theme:t,ownerState:o,open:r})=>p({zIndex:(t.vars||t).zIndex.tooltip,pointerEvents:"none"},!o.disableInteractive&&{pointerEvents:"auto"},!r&&{pointerEvents:"none"},o.arrow&&{[`&[data-popper-placement*="bottom"] .${$.arrow}`]:{top:0,marginTop:"-0.71em","&::before":{transformOrigin:"0 100%"}},[`&[data-popper-placement*="top"] .${$.arrow}`]:{bottom:0,marginBottom:"-0.71em","&::before":{transformOrigin:"100% 0"}},[`&[data-popper-placement*="right"] .${$.arrow}`]:p({},o.isRtl?{right:0,marginRight:"-0.71em"}:{left:0,marginLeft:"-0.71em"},{height:"1em",width:"0.71em","&::before":{transformOrigin:"100% 100%"}}),[`&[data-popper-placement*="left"] .${$.arrow}`]:p({},o.isRtl?{left:0,marginLeft:"-0.71em"}:{right:0,marginRight:"-0.71em"},{height:"1em",width:"0.71em","&::before":{transformOrigin:"0 0"}})})),Lo=J("div",{name:"MuiTooltip",slot:"Tooltip",overridesResolver:(t,o)=>{const{ownerState:r}=t;return[o.tooltip,r.touch&&o.touch,r.arrow&&o.tooltipArrow,o[`tooltipPlacement${Pt(r.placement.split("-")[0])}`]]}})(({theme:t,ownerState:o})=>p({backgroundColor:t.vars?t.vars.palette.Tooltip.bg:kt.alpha(t.palette.grey[700],.92),borderRadius:(t.vars||t).shape.borderRadius,color:(t.vars||t).palette.common.white,fontFamily:t.typography.fontFamily,padding:"4px 8px",fontSize:t.typography.pxToRem(11),maxWidth:300,margin:2,wordWrap:"break-word",fontWeight:t.typography.fontWeightMedium},o.arrow&&{position:"relative",margin:0},o.touch&&{padding:"8px 16px",fontSize:t.typography.pxToRem(14),lineHeight:`${Eo(16/14)}em`,fontWeight:t.typography.fontWeightRegular},{[`.${$.popper}[data-popper-placement*="left"] &`]:p({transformOrigin:"right center"},o.isRtl?p({marginLeft:"14px"},o.touch&&{marginLeft:"24px"}):p({marginRight:"14px"},o.touch&&{marginRight:"24px"})),[`.${$.popper}[data-popper-placement*="right"] &`]:p({transformOrigin:"left center"},o.isRtl?p({marginRight:"14px"},o.touch&&{marginRight:"24px"}):p({marginLeft:"14px"},o.touch&&{marginLeft:"24px"})),[`.${$.popper}[data-popper-placement*="top"] &`]:p({transformOrigin:"center bottom",marginBottom:"14px"},o.touch&&{marginBottom:"24px"}),[`.${$.popper}[data-popper-placement*="bottom"] &`]:p({transformOrigin:"center top",marginTop:"14px"},o.touch&&{marginTop:"24px"})})),No=J("span",{name:"MuiTooltip",slot:"Arrow",overridesResolver:(t,o)=>o.arrow})(({theme:t})=>({overflow:"hidden",position:"absolute",width:"1em",height:"0.71em",boxSizing:"border-box",color:t.vars?t.vars.palette.Tooltip.bg:kt.alpha(t.palette.grey[700],.9),"&::before":{content:'""',margin:"auto",display:"block",width:"100%",height:"100%",backgroundColor:"currentColor",transform:"rotate(45deg)"}}));let Me=!1;const yt=new oo;let pe={x:0,y:0};function Re(t,o){return(r,...c)=>{o&&o(r,...c),t(r,...c)}}const qe=n.forwardRef(function(o,r){var c,u,d,h,f,g,v,L,R,w,D,U,Ae,Q,N,he,me,Z,B;const W=_e({props:o,name:"MuiTooltip"}),{arrow:b=!1,children:F,components:S={},componentsProps:j={},describeChild:ee=!1,disableFocusListener:fe=!1,disableHoverListener:C=!1,disableInteractive:Ee=!1,disableTouchListener:te=!1,enterDelay:I=100,enterNextDelay:oe=0,enterTouchDelay:P=700,followCursor:H=!1,id:A,leaveDelay:ge=0,leaveTouchDelay:Oe=1500,onClose:xe,onOpen:z,open:$e,placement:ve="bottom",PopperComponent:V,PopperProps:k={},slotProps:s={},slots:a={},title:i,TransitionComponent:m=gt,TransitionProps:q}=W,G=Se(W,Ao),T=n.isValidElement(F)?F:e.jsx("span",{children:F}),se=Xt(),be=Kt(),[re,Ze]=n.useState(),[Le,Ot]=n.useState(null),Ce=n.useRef(!1),Ne=Ee||H,et=ke(),Fe=ke(),ye=ke(),tt=ke(),[$t,ot]=Jt({controlled:$e,default:!1,name:"Tooltip",state:"open"});let _=$t;const He=Qt(A),ne=n.useRef(),we=mt(()=>{ne.current!==void 0&&(document.body.style.WebkitUserSelect=ne.current,ne.current=void 0),tt.clear()});n.useEffect(()=>we,[we]);const st=l=>{yt.clear(),Me=!0,ot(!0),z&&!_&&z(l)},je=mt(l=>{yt.start(800+ge,()=>{Me=!1}),ot(!1),xe&&_&&xe(l),et.start(se.transitions.duration.shortest,()=>{Ce.current=!1})}),Pe=l=>{Ce.current&&l.type!=="touchstart"||(re&&re.removeAttribute("title"),Fe.clear(),ye.clear(),I||Me&&oe?Fe.start(Me?oe:I,()=>{st(l)}):st(l))},Ye=l=>{Fe.clear(),ye.start(ge,()=>{je(l)})},{isFocusVisibleRef:rt,onBlur:Lt,onFocus:Nt,ref:Ft}=Zt(),[,nt]=n.useState(!1),at=l=>{Lt(l),rt.current===!1&&(nt(!1),Ye(l))},it=l=>{re||Ze(l.currentTarget),Nt(l),rt.current===!0&&(nt(!0),Pe(l))},lt=l=>{Ce.current=!0;const x=T.props;x.onTouchStart&&x.onTouchStart(l)},Ht=l=>{lt(l),ye.clear(),et.clear(),we(),ne.current=document.body.style.WebkitUserSelect,document.body.style.WebkitUserSelect="none",tt.start(P,()=>{document.body.style.WebkitUserSelect=ne.current,Pe(l)})},Yt=l=>{T.props.onTouchEnd&&T.props.onTouchEnd(l),we(),ye.start(Oe,()=>{je(l)})};n.useEffect(()=>{if(!_)return;function l(x){(x.key==="Escape"||x.key==="Esc")&&je(x)}return document.addEventListener("keydown",l),()=>{document.removeEventListener("keydown",l)}},[je,_]);const Ut=eo(to(T),Ft,Ze,r);!i&&i!==0&&(_=!1);const Ue=n.useRef(),Bt=l=>{const x=T.props;x.onMouseMove&&x.onMouseMove(l),pe={x:l.clientX,y:l.clientY},Ue.current&&Ue.current.update()},ae={},Be=typeof i=="string";ee?(ae.title=!_&&Be&&!C?i:null,ae["aria-describedby"]=_?He:null):(ae["aria-label"]=Be?i:null,ae["aria-labelledby"]=_&&!Be?He:null);const y=p({},ae,G,T.props,{className:Y(G.className,T.props.className),onTouchStart:lt,ref:Ut},H?{onMouseMove:Bt}:{}),ie={};te||(y.onTouchStart=Ht,y.onTouchEnd=Yt),C||(y.onMouseOver=Re(Pe,y.onMouseOver),y.onMouseLeave=Re(Ye,y.onMouseLeave),Ne||(ie.onMouseOver=Pe,ie.onMouseLeave=Ye)),fe||(y.onFocus=Re(it,y.onFocus),y.onBlur=Re(at,y.onBlur),Ne||(ie.onFocus=it,ie.onBlur=at));const Wt=n.useMemo(()=>{var l;let x=[{name:"arrow",enabled:!!Le,options:{element:Le,padding:4}}];return(l=k.popperOptions)!=null&&l.modifiers&&(x=x.concat(k.popperOptions.modifiers)),p({},k.popperOptions,{modifiers:x})},[Le,k]),le=p({},W,{isRtl:be,arrow:b,disableInteractive:Ne,placement:ve,PopperComponentProp:V,touch:Ce.current}),We=Oo(le),ct=(c=(u=a.popper)!=null?u:S.Popper)!=null?c:$o,pt=(d=(h=(f=a.transition)!=null?f:S.Transition)!=null?h:m)!=null?d:gt,ut=(g=(v=a.tooltip)!=null?v:S.Tooltip)!=null?g:Lo,dt=(L=(R=a.arrow)!=null?R:S.Arrow)!=null?L:No,zt=Te(ct,p({},k,(w=s.popper)!=null?w:j.popper,{className:Y(We.popper,k==null?void 0:k.className,(D=(U=s.popper)!=null?U:j.popper)==null?void 0:D.className)}),le),Vt=Te(pt,p({},q,(Ae=s.transition)!=null?Ae:j.transition),le),qt=Te(ut,p({},(Q=s.tooltip)!=null?Q:j.tooltip,{className:Y(We.tooltip,(N=(he=s.tooltip)!=null?he:j.tooltip)==null?void 0:N.className)}),le),Gt=Te(dt,p({},(me=s.arrow)!=null?me:j.arrow,{className:Y(We.arrow,(Z=(B=s.arrow)!=null?B:j.arrow)==null?void 0:Z.className)}),le);return e.jsxs(n.Fragment,{children:[n.cloneElement(T,y),e.jsx(ct,p({as:V??_t,placement:ve,anchorEl:H?{getBoundingClientRect:()=>({top:pe.y,left:pe.x,right:pe.x,bottom:pe.y,width:0,height:0})}:re,popperRef:Ue,open:re?_:!1,id:He,transition:!0},ie,zt,{popperOptions:Wt,children:({TransitionProps:l})=>e.jsx(pt,p({timeout:se.transitions.duration.shorter},l,Vt,{children:e.jsxs(ut,p({},qt,{children:[i,b?e.jsx(dt,p({},Gt,{ref:Ot})):null]}))}))}))]})});var ue={},wt;function Fo(){if(wt)return ue;wt=1;var t=Tt();Object.defineProperty(ue,"__esModule",{value:!0}),ue.default=void 0;var o=t(Mt()),r=Rt();return ue.default=(0,o.default)((0,r.jsx)("path",{d:"m21.9 8.89-1.05-4.37c-.22-.9-1-1.52-1.91-1.52H5.05c-.9 0-1.69.63-1.9 1.52L2.1 8.89c-.24 1.02-.02 2.06.62 2.88.08.11.19.19.28.29V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-6.94c.09-.09.2-.18.28-.28.64-.82.87-1.87.62-2.89m-2.99-3.9 1.05 4.37c.1.42.01.84-.25 1.17-.14.18-.44.47-.94.47-.61 0-1.14-.49-1.21-1.14L16.98 5zM13 5h1.96l.54 4.52c.05.39-.07.78-.33 1.07-.22.26-.54.41-.95.41-.67 0-1.22-.59-1.22-1.31zM8.49 9.52 9.04 5H11v4.69c0 .72-.55 1.31-1.29 1.31-.34 0-.65-.15-.89-.41-.25-.29-.37-.68-.33-1.07m-4.45-.16L5.05 5h1.97l-.58 4.86c-.08.65-.6 1.14-1.21 1.14-.49 0-.8-.29-.93-.47-.27-.32-.36-.75-.26-1.17M5 19v-6.03c.08.01.15.03.23.03.87 0 1.66-.36 2.24-.95.6.6 1.4.95 2.31.95.87 0 1.65-.36 2.23-.93.59.57 1.39.93 2.29.93.84 0 1.64-.35 2.24-.95.58.59 1.37.95 2.24.95.08 0 .15-.02.23-.03V19z"}),"Storefront"),ue}var Ho=Fo();const Yo=Dt(Ho);var de={},jt;function Uo(){if(jt)return de;jt=1;var t=Tt();Object.defineProperty(de,"__esModule",{value:!0}),de.default=void 0;var o=t(Mt()),r=Rt();return de.default=(0,o.default)((0,r.jsx)("path",{d:"M14 10H3v2h11zm0-4H3v2h11zm4 8v-4h-2v4h-4v2h4v4h2v-4h4v-2zM3 16h7v-2H3z"}),"PlaylistAdd"),de}var Bo=Uo();const Ge=Dt(Bo);Qe`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`;const Xe=()=>e.jsxs(St,{sx:{mb:3,border:"1px solid #e0e0e0",boxShadow:"4px 4px 8px rgba(0,0,0,0.1)"},children:[e.jsx(It,{avatar:e.jsx(O,{animation:"wave",variant:"circular",width:40,height:40}),title:e.jsx(O,{animation:"wave",height:20,width:"80%"}),sx:{backgroundColor:"grey.200"}}),e.jsxs(At,{sx:{flexGrow:1,display:"flex",flexDirection:"column",gap:1.5,pt:1},children:[e.jsx(O,{animation:"wave",height:15,width:"90%"}),e.jsx(O,{animation:"wave",height:15,width:"60%"}),e.jsx(O,{animation:"wave",height:15,width:"60%"}),e.jsx(O,{animation:"wave",height:15,width:"60%"})]}),e.jsxs(Et,{sx:{justifyContent:"space-between",px:2,py:1.5,backgroundColor:"grey.50"},children:[e.jsx(O,{animation:"wave",variant:"circular",width:32,height:32}),e.jsx(O,{animation:"wave",variant:"rectangular",width:100,height:36})]})]}),Jo=()=>{var k;const t=n.useMemo(()=>({"Checked In":0,Planned:1,Completed:2,Canceled:3,Draft:4}),[]),{employeeId:o}=so(),r=ro(),[c,u]=n.useState([]),[d,h]=n.useState(!0),[f,g]=n.useState(null),[v,L]=n.useState(0),[R,w]=n.useState(!0),[D,U]=n.useState(!1),[Ae,Q]=n.useState(0),N=n.useRef(null),he=n.useCallback(s=>{D||(N.current&&N.current.disconnect(),N.current=new IntersectionObserver(a=>{a[0].isIntersecting&&R&&L(i=>i+1)}),s&&N.current.observe(s))},[D,R]),[me,Z]=n.useState(!1),[B,W]=n.useState(null),b=n.useRef(null),F=n.useRef(null),[S,j]=n.useState(null),[ee,fe]=n.useState(null),[C,Ee]=n.useState(null),[te,I]=n.useState(!1),[oe,P]=n.useState(null),H=n.useCallback(s=>s.sort((a,i)=>(t[a.status]??99)-(t[i.status]??99)),[t]),A=n.useCallback(async s=>{if(!o){g("Employee ID not available."),h(!1),U(!1);return}s===0?h(!0):U(!0);try{const a=await no(s),i=a.data,m=a.total;s===0?(u(H(i)),Q(m),w(i.length<m)):u(q=>{const G=[...q,...i],T=Array.from(new Map(G.map(be=>[be.name,be])).values()),se=H(T);return w(se.length<m),se}),g(null)}catch(a){console.error("Error fetching visit plans:",a),g(a instanceof Error?a.message:"Failed to fetch data."),w(!1)}finally{s===0&&h(!1),U(!1)}},[o,H,d,D]);n.useEffect(()=>{o&&(u([]),L(0),w(!0),Q(0),A(0))},[o,A]),n.useEffect(()=>{v>0&&A(v)},[v,A]),n.useEffect(()=>{c.forEach(s=>{s.checkout_time&&console.log(`DEBUG: Plan ${s.name} Checkout Time: ${X(s.checkout_time,"DD/MM/YY HH:mm:ss").isValid()}`)})},[c]);const ge=n.useCallback(s=>{if(s.parent_docstatus===0)return e.jsx(qe,{title:s.parent,arrow:!0,children:e.jsx(ce,{label:"Draft",color:"warning",size:"small",sx:{fontWeight:"bold"}})});let a="default",i=s.status;switch(s.status){case"Planned":a="primary";break;case"Checked In":a="secondary";break;case"Completed":a="success";break;case"Canceled":a="error";break;default:i="Draft",a="error";break}return e.jsx(qe,{title:s.parent,arrow:!0,children:e.jsx(ce,{label:i,color:a,size:"small",sx:{fontWeight:"bold"}})})},[]),Oe=async s=>{try{await ft(s,"Checked In")?A(0):g("Failed to check-in.")}catch(a){g(a instanceof Error?a.message:"An unexpected error occurred during check-in.")}},xe=s=>{const a=c.find(i=>i.name===s);a&&a.checkin_time&&(X(a.checkin_time,"DD-MM-YYYY HH:mm:ss").toDate().getTime(),new Date().getTime()),W(s),Z(!0),j(null),fe(null),P(null),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({video:!0}).then(i=>{b.current&&(b.current.srcObject=i)}).catch(i=>{console.error("Camera access denied:",i),P("Camera access is required. Please enable it in your browser settings.")}),navigator.geolocation?navigator.geolocation.getCurrentPosition(i=>{Ee({latitude:i.coords.latitude,longitude:i.coords.longitude})},i=>{console.error("Location access denied:",i);let m="Location access is required.";i instanceof GeolocationPositionError?i.code===i.PERMISSION_DENIED?m+=" Please enable it in your browser settings.":i.code===i.POSITION_UNAVAILABLE?m+=" Location information is unavailable.":i.code===i.TIMEOUT&&(m+=" The request to get user location timed out."):m+=" An unknown error occurred.",P(m)}):P("Geolocation is not supported by your browser.")},z=()=>{var s;Z(!1),W(null),(s=b.current)!=null&&s.srcObject&&b.current.srcObject.getTracks().forEach(a=>a.stop())},$e=n.useCallback(()=>{if(b.current&&F.current){const s=b.current,a=F.current;a.width=s.videoWidth,a.height=s.videoHeight;const i=a.getContext("2d");if(i){i.drawImage(s,0,0,s.videoWidth,s.videoHeight);const m=a.toDataURL("image/jpeg");j(m),a.toBlob(q=>{if(q){const G=new File([q],"captured_photo.jpeg",{type:"image/jpeg"});fe(G)}},"image/jpeg")}}},[]),ve=n.useCallback(async()=>{if(!C||!B||!ee){P("Please ensure a photo has been taken and location is available.");return}I(!0),P(null);try{await ft(B,"Completed",{latitude:C.latitude,longitude:C.longitude,photo_file:ee,checkout_time:X().format("YYYY-MM-DD HH:mm:ss")})?(I(!1),z(),A(0)):(I(!1),P("Failed to complete checkout."))}catch(s){I(!1),P(s instanceof Error?s.message:"An unexpected error occurred during checkout.")}finally{I(!1)}},[B,C,ee]),V=n.useCallback((s,a)=>{if(!s)return"N/A";const i=X(s,"DD-MM-YYYY HH:mm:ss");if(!i.isValid())return"Invalid Date";if(a){const m=X(a,"DD-MM-YYYY HH:mm");if(m.isValid()&&i.isSame(m,"day"))return i.format("HH:mm")}return i.format("DD-MM-YYYY HH:mm")},[]);return e.jsxs(e.Fragment,{children:[e.jsxs(fo,{maxWidth:"lg",sx:{mt:4,mb:4},children:[e.jsx(M,{variant:"h4",component:"h1",gutterBottom:!0,align:"center",sx:{fontWeight:"bold"},children:"My Visit Schedule"}),e.jsx(E,{sx:{mb:2,textAlign:"right"},children:e.jsx(K,{variant:"contained",startIcon:e.jsx(ao,{}),onClick:()=>r("/history"),children:"History"})}),d&&v===0?e.jsxs(E,{children:[e.jsx(Xe,{}),e.jsx(Xe,{}),e.jsx(Xe,{})]}):f?e.jsx(Ve,{severity:"error",children:f}):c.length===0?e.jsx(Ve,{severity:"info",sx:{mt:2},children:"No visit plans found."}):e.jsxs(E,{children:[c.map((s,a)=>e.jsxs(St,{sx:{mb:3,border:"1px solid #e0e0e0",boxShadow:"4px 4px 8px rgba(0,0,0,0.1)"},ref:c.length===a+1?he:null,children:[e.jsx(It,{avatar:e.jsx(Yo,{sx:{color:"primary.main",fontSize:40}}),title:e.jsx(M,{variant:"h6",sx:{fontWeight:"bold"},children:s.store_name}),subheader:e.jsx(M,{variant:"body2",color:"text.secondary",children:s.address}),sx:{backgroundColor:"grey.100",py:1.5}}),e.jsxs(At,{sx:{display:"flex",flexDirection:"column",gap:1.5,pt:1},children:[e.jsxs(E,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(ce,{label:e.jsxs(E,{component:"span",children:["Planning :"," ",e.jsx(M,{component:"span",sx:{fontWeight:"bold",color:"#FFFFFF"},children:s.planned_visit_time?X(s.planned_visit_time,"DD-MM-YYYY HH:mm").format("DD-MM-YYYY HH:mm"):"N/A"})]}),color:"info",size:"small"}),ge(s)]}),e.jsx(ce,{icon:e.jsx(Ge,{}),label:`CheckIn: ${V(s.checkin_time,s.planned_visit_time)}`,variant:"outlined",size:"small"}),e.jsx(ce,{icon:e.jsx(Ge,{}),label:`CheckOut: ${V(s.checkout_time,s.planned_visit_time)}`,variant:"outlined",size:"small"}),s.notes&&e.jsxs(M,{variant:"body2",sx:{fontStyle:"italic",color:"text.secondary"},children:["Notes: ",s.notes]})]}),e.jsxs(Et,{sx:{justifyContent:"space-between",px:2,py:1.5,backgroundColor:"grey.50"},children:[e.jsx(io,{onClick:()=>r(`/notes/${s.name}`),"aria-label":"Add Notes",children:e.jsx(qe,{title:"Add Notes",children:e.jsx(Ge,{sx:{color:"primary.main"}})})}),e.jsxs(E,{children:[s.status==="Planned"&&e.jsx(K,{variant:"contained",color:"secondary",onClick:()=>Oe(s.name),children:"Check In"}),s.status==="Checked In"&&e.jsx(K,{variant:"contained",color:"success",onClick:()=>xe(s.name),children:"Check Out"})]})]})]},s.name)),D&&e.jsx(E,{sx:{display:"flex",justifyContent:"center",my:2},children:e.jsx(ze,{})}),!R&&e.jsx(M,{variant:"body2",align:"center",color:"text.secondary",sx:{my:2},children:"You have reached the end of the list."})]})]}),e.jsxs(uo,{open:me,onClose:z,fullWidth:!0,maxWidth:"sm",children:[e.jsx(ko,{children:"Complete Checkout"}),e.jsxs(ho,{children:[oe&&e.jsx(Ve,{severity:"error",sx:{mb:2},children:oe}),e.jsxs(E,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(M,{children:"Take Photo:"}),e.jsx("video",{ref:b,style:{width:"100%",border:"1px solid #ccc"},autoPlay:!0,playsInline:!0}),e.jsx(K,{variant:"outlined",onClick:$e,disabled:!((k=b.current)!=null&&k.srcObject),children:"Capture Photo"}),S&&e.jsx("img",{src:S,alt:"Captured",style:{width:"100%",border:"1px solid #ccc"}}),e.jsx("canvas",{ref:F,style:{display:"none"}}),e.jsx(M,{children:"Current Location:"}),C?e.jsxs(M,{children:["Lat: ",C.latitude.toFixed(6),", Lng: ",C.longitude.toFixed(6)]}):e.jsx(ze,{size:20})]})]}),e.jsxs(mo,{children:[e.jsx(K,{onClick:z,disabled:te,children:"Cancel"}),e.jsx(K,{onClick:ve,disabled:te||!S||!C,variant:"contained",children:te?e.jsx(ze,{size:24,color:"inherit"}):"Complete Checkout"})]})]})]})};export{Jo as default};
