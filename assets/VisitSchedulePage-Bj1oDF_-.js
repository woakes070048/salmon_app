import{g as Ge,a as Xe,r as i,u as Se,_ as De,b as c,j as t,s as Q,c as U,d as Ae,T as $,e as dt,k as Ke,h as Xt,i as Kt,m as Pe,n as Jt,o as Qt,p as ht,q as Zt,t as eo,v as to,w as Te,x as oo,y as kt,z as jt,A as Pt,D as Tt,E as Rt,F as Mt,G as so,H as ro,I as no,J as io,B as F,K as ao,L as lo,C as We,M as mt}from"./index-CrghFRdq.js";import{D as co,g as po,a as uo,P as _t,h as K,C as le,b as ho,c as mo,d as fo}from"./moment-D4QubNtM.js";import{C as go,A as ze}from"./Container-B91d9uGY.js";import{B as J}from"./Button-DAbXaOUf.js";import{C as St,a as Dt,b as At}from"./CardHeader-BdgRkODB.js";import{G as ft}from"./Grow-wq8xQCCO.js";function xo(e){return String(e).match(/[\d.\-+]*\s*(.*)/)[1]||""}function vo(e){return parseFloat(e)}function bo(e){return Ge("MuiCardActions",e)}Xe("MuiCardActions",["root","spacing"]);const Co=["disableSpacing","className"],yo=e=>{const{classes:o,disableSpacing:r}=e;return Ae({root:["root",!r&&"spacing"]},bo,o)},wo=Q("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(e,o)=>{const{ownerState:r}=e;return[o.root,!r.disableSpacing&&o.spacing]}})(({ownerState:e})=>c({display:"flex",alignItems:"center",padding:8},!e.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})),$t=i.forwardRef(function(o,r){const l=Se({props:o,name:"MuiCardActions"}),{disableSpacing:u=!1,className:d}=l,h=De(l,Co),f=c({},l,{disableSpacing:u}),x=yo(f);return t.jsx(wo,c({className:U(x.root,d),ownerState:f,ref:r},h))}),ko=["className","id"],jo=e=>{const{classes:o}=e;return Ae({root:["root"]},po,o)},Po=Q($,{name:"MuiDialogTitle",slot:"Root",overridesResolver:(e,o)=>o.root})({padding:"16px 24px",flex:"0 0 auto"}),To=i.forwardRef(function(o,r){const l=Se({props:o,name:"MuiDialogTitle"}),{className:u,id:d}=l,h=De(l,ko),f=l,x=jo(f),{titleId:y=d}=i.useContext(co);return t.jsx(Po,c({component:"h2",className:U(x.root,u),ownerState:f,ref:r,variant:"h6",id:d??y},h))});function Ro(e){return Ge("MuiSkeleton",e)}Xe("MuiSkeleton",["root","text","rectangular","rounded","circular","pulse","wave","withChildren","fitContent","heightAuto"]);const Mo=["animation","className","component","height","style","variant","width"];let _e=e=>e,gt,xt,vt,bt;const _o=e=>{const{classes:o,variant:r,animation:l,hasChildren:u,width:d,height:h}=e;return Ae({root:["root",r,l,u&&"withChildren",u&&!d&&"fitContent",u&&!h&&"heightAuto"]},Ro,o)},So=Ke(gt||(gt=_e`
  0% {
    opacity: 1;
  }

  50% {
    opacity: 0.4;
  }

  100% {
    opacity: 1;
  }
`)),Do=Ke(xt||(xt=_e`
  0% {
    transform: translateX(-100%);
  }

  50% {
    /* +0.5s of delay between each loop */
    transform: translateX(100%);
  }

  100% {
    transform: translateX(100%);
  }
`)),Ao=Q("span",{name:"MuiSkeleton",slot:"Root",overridesResolver:(e,o)=>{const{ownerState:r}=e;return[o.root,o[r.variant],r.animation!==!1&&o[r.animation],r.hasChildren&&o.withChildren,r.hasChildren&&!r.width&&o.fitContent,r.hasChildren&&!r.height&&o.heightAuto]}})(({theme:e,ownerState:o})=>{const r=xo(e.shape.borderRadius)||"px",l=vo(e.shape.borderRadius);return c({display:"block",backgroundColor:e.vars?e.vars.palette.Skeleton.bg:uo(e.palette.text.primary,e.palette.mode==="light"?.11:.13),height:"1.2em"},o.variant==="text"&&{marginTop:0,marginBottom:0,height:"auto",transformOrigin:"0 55%",transform:"scale(1, 0.60)",borderRadius:`${l}${r}/${Math.round(l/.6*10)/10}${r}`,"&:empty:before":{content:'"\\00a0"'}},o.variant==="circular"&&{borderRadius:"50%"},o.variant==="rounded"&&{borderRadius:(e.vars||e).shape.borderRadius},o.hasChildren&&{"& > *":{visibility:"hidden"}},o.hasChildren&&!o.width&&{maxWidth:"fit-content"},o.hasChildren&&!o.height&&{height:"auto"})},({ownerState:e})=>e.animation==="pulse"&&dt(vt||(vt=_e`
      animation: ${0} 2s ease-in-out 0.5s infinite;
    `),So),({ownerState:e,theme:o})=>e.animation==="wave"&&dt(bt||(bt=_e`
      position: relative;
      overflow: hidden;

      /* Fix bug in Safari https://bugs.webkit.org/show_bug.cgi?id=68196 */
      -webkit-mask-image: -webkit-radial-gradient(white, black);

      &::after {
        animation: ${0} 2s linear 0.5s infinite;
        background: linear-gradient(
          90deg,
          transparent,
          ${0},
          transparent
        );
        content: '';
        position: absolute;
        transform: translateX(-100%); /* Avoid flash during server-side hydration */
        bottom: 0;
        left: 0;
        right: 0;
        top: 0;
      }
    `),Do,(o.vars||o).palette.action.hover)),I=i.forwardRef(function(o,r){const l=Se({props:o,name:"MuiSkeleton"}),{animation:u="pulse",className:d,component:h="span",height:f,style:x,variant:y="text",width:B}=l,R=De(l,Mo),L=c({},l,{animation:u,component:h,variant:y,hasChildren:!!R.children}),w=_o(L);return t.jsx(Ao,c({as:h,ref:r,className:U(w.root,d),ownerState:L},R,{style:c({width:B,height:f},x)}))});function $o(e){return Ge("MuiTooltip",e)}const E=Xe("MuiTooltip",["popper","popperInteractive","popperArrow","popperClose","tooltip","tooltipArrow","touch","tooltipPlacementLeft","tooltipPlacementRight","tooltipPlacementTop","tooltipPlacementBottom","arrow"]),Io=["arrow","children","classes","components","componentsProps","describeChild","disableFocusListener","disableHoverListener","disableInteractive","disableTouchListener","enterDelay","enterNextDelay","enterTouchDelay","followCursor","id","leaveDelay","leaveTouchDelay","onClose","onOpen","open","placement","PopperComponent","PopperProps","slotProps","slots","title","TransitionComponent","TransitionProps"];function Eo(e){return Math.round(e*1e5)/1e5}const Lo=e=>{const{classes:o,disableInteractive:r,arrow:l,touch:u,placement:d}=e,h={popper:["popper",!r&&"popperInteractive",l&&"popperArrow"],tooltip:["tooltip",l&&"tooltipArrow",u&&"touch",`tooltipPlacement${kt(d.split("-")[0])}`],arrow:["arrow"]};return Ae(h,$o,o)},Oo=Q(_t,{name:"MuiTooltip",slot:"Popper",overridesResolver:(e,o)=>{const{ownerState:r}=e;return[o.popper,!r.disableInteractive&&o.popperInteractive,r.arrow&&o.popperArrow,!r.open&&o.popperClose]}})(({theme:e,ownerState:o,open:r})=>c({zIndex:(e.vars||e).zIndex.tooltip,pointerEvents:"none"},!o.disableInteractive&&{pointerEvents:"auto"},!r&&{pointerEvents:"none"},o.arrow&&{[`&[data-popper-placement*="bottom"] .${E.arrow}`]:{top:0,marginTop:"-0.71em","&::before":{transformOrigin:"0 100%"}},[`&[data-popper-placement*="top"] .${E.arrow}`]:{bottom:0,marginBottom:"-0.71em","&::before":{transformOrigin:"100% 0"}},[`&[data-popper-placement*="right"] .${E.arrow}`]:c({},o.isRtl?{right:0,marginRight:"-0.71em"}:{left:0,marginLeft:"-0.71em"},{height:"1em",width:"0.71em","&::before":{transformOrigin:"100% 100%"}}),[`&[data-popper-placement*="left"] .${E.arrow}`]:c({},o.isRtl?{left:0,marginLeft:"-0.71em"}:{right:0,marginRight:"-0.71em"},{height:"1em",width:"0.71em","&::before":{transformOrigin:"0 0"}})})),No=Q("div",{name:"MuiTooltip",slot:"Tooltip",overridesResolver:(e,o)=>{const{ownerState:r}=e;return[o.tooltip,r.touch&&o.touch,r.arrow&&o.tooltipArrow,o[`tooltipPlacement${kt(r.placement.split("-")[0])}`]]}})(({theme:e,ownerState:o})=>c({backgroundColor:e.vars?e.vars.palette.Tooltip.bg:jt.alpha(e.palette.grey[700],.92),borderRadius:(e.vars||e).shape.borderRadius,color:(e.vars||e).palette.common.white,fontFamily:e.typography.fontFamily,padding:"4px 8px",fontSize:e.typography.pxToRem(11),maxWidth:300,margin:2,wordWrap:"break-word",fontWeight:e.typography.fontWeightMedium},o.arrow&&{position:"relative",margin:0},o.touch&&{padding:"8px 16px",fontSize:e.typography.pxToRem(14),lineHeight:`${Eo(16/14)}em`,fontWeight:e.typography.fontWeightRegular},{[`.${E.popper}[data-popper-placement*="left"] &`]:c({transformOrigin:"right center"},o.isRtl?c({marginLeft:"14px"},o.touch&&{marginLeft:"24px"}):c({marginRight:"14px"},o.touch&&{marginRight:"24px"})),[`.${E.popper}[data-popper-placement*="right"] &`]:c({transformOrigin:"left center"},o.isRtl?c({marginRight:"14px"},o.touch&&{marginRight:"24px"}):c({marginLeft:"14px"},o.touch&&{marginLeft:"24px"})),[`.${E.popper}[data-popper-placement*="top"] &`]:c({transformOrigin:"center bottom",marginBottom:"14px"},o.touch&&{marginBottom:"24px"}),[`.${E.popper}[data-popper-placement*="bottom"] &`]:c({transformOrigin:"center top",marginTop:"14px"},o.touch&&{marginTop:"24px"})})),Ho=Q("span",{name:"MuiTooltip",slot:"Arrow",overridesResolver:(e,o)=>o.arrow})(({theme:e})=>({overflow:"hidden",position:"absolute",width:"1em",height:"0.71em",boxSizing:"border-box",color:e.vars?e.vars.palette.Tooltip.bg:jt.alpha(e.palette.grey[700],.9),"&::before":{content:'""',margin:"auto",display:"block",width:"100%",height:"100%",backgroundColor:"currentColor",transform:"rotate(45deg)"}}));let Re=!1;const Ct=new oo;let ce={x:0,y:0};function Me(e,o){return(r,...l)=>{o&&o(r,...l),e(r,...l)}}const Ve=i.forwardRef(function(o,r){var l,u,d,h,f,x,y,B,R,L,w,Z,O,de,he,ee,W,te,v;const N=Se({props:o,name:"MuiTooltip"}),{arrow:z=!1,children:V,components:H={},componentsProps:k={},describeChild:M=!1,disableFocusListener:$e=!1,disableHoverListener:q=!1,disableInteractive:Y=!1,disableTouchListener:me=!1,enterDelay:j=100,enterNextDelay:_=0,enterTouchDelay:fe=700,followCursor:P=!1,id:ge,leaveDelay:G=0,leaveTouchDelay:xe=1500,onClose:ve,onOpen:be,open:Ie,placement:X="bottom",PopperComponent:oe,PopperProps:S={},slotProps:T={},slots:s={},title:n,TransitionComponent:p=ft,TransitionProps:m}=N,D=De(N,Io),b=i.isValidElement(V)?V:t.jsx("span",{children:V}),Je=Xt(),It=Kt(),[se,Qe]=i.useState(),[Ee,Et]=i.useState(null),Ce=i.useRef(!1),Le=Y||P,Ze=Pe(),Oe=Pe(),ye=Pe(),et=Pe(),[Lt,tt]=Jt({controlled:Ie,default:!1,name:"Tooltip",state:"open"});let A=Lt;const Ne=Qt(ge),re=i.useRef(),we=ht(()=>{re.current!==void 0&&(document.body.style.WebkitUserSelect=re.current,re.current=void 0),et.clear()});i.useEffect(()=>we,[we]);const ot=a=>{Ct.clear(),Re=!0,tt(!0),be&&!A&&be(a)},ke=ht(a=>{Ct.start(800+G,()=>{Re=!1}),tt(!1),ve&&A&&ve(a),Ze.start(Je.transitions.duration.shortest,()=>{Ce.current=!1})}),je=a=>{Ce.current&&a.type!=="touchstart"||(se&&se.removeAttribute("title"),Oe.clear(),ye.clear(),j||Re&&_?Oe.start(Re?_:j,()=>{ot(a)}):ot(a))},He=a=>{Oe.clear(),ye.start(G,()=>{ke(a)})},{isFocusVisibleRef:st,onBlur:Ot,onFocus:Nt,ref:Ht}=Zt(),[,rt]=i.useState(!1),nt=a=>{Ot(a),st.current===!1&&(rt(!1),He(a))},it=a=>{se||Qe(a.currentTarget),Nt(a),st.current===!0&&(rt(!0),je(a))},at=a=>{Ce.current=!0;const g=b.props;g.onTouchStart&&g.onTouchStart(a)},Ft=a=>{at(a),ye.clear(),Ze.clear(),we(),re.current=document.body.style.WebkitUserSelect,document.body.style.WebkitUserSelect="none",et.start(fe,()=>{document.body.style.WebkitUserSelect=re.current,je(a)})},Ut=a=>{b.props.onTouchEnd&&b.props.onTouchEnd(a),we(),ye.start(xe,()=>{ke(a)})};i.useEffect(()=>{if(!A)return;function a(g){(g.key==="Escape"||g.key==="Esc")&&ke(g)}return document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}},[ke,A]);const Bt=eo(to(b),Ht,Qe,r);!n&&n!==0&&(A=!1);const Fe=i.useRef(),Wt=a=>{const g=b.props;g.onMouseMove&&g.onMouseMove(a),ce={x:a.clientX,y:a.clientY},Fe.current&&Fe.current.update()},ne={},Ue=typeof n=="string";M?(ne.title=!A&&Ue&&!q?n:null,ne["aria-describedby"]=A?Ne:null):(ne["aria-label"]=Ue?n:null,ne["aria-labelledby"]=A&&!Ue?Ne:null);const C=c({},ne,D,b.props,{className:U(D.className,b.props.className),onTouchStart:at,ref:Bt},P?{onMouseMove:Wt}:{}),ie={};me||(C.onTouchStart=Ft,C.onTouchEnd=Ut),q||(C.onMouseOver=Me(je,C.onMouseOver),C.onMouseLeave=Me(He,C.onMouseLeave),Le||(ie.onMouseOver=je,ie.onMouseLeave=He)),$e||(C.onFocus=Me(it,C.onFocus),C.onBlur=Me(nt,C.onBlur),Le||(ie.onFocus=it,ie.onBlur=nt));const zt=i.useMemo(()=>{var a;let g=[{name:"arrow",enabled:!!Ee,options:{element:Ee,padding:4}}];return(a=S.popperOptions)!=null&&a.modifiers&&(g=g.concat(S.popperOptions.modifiers)),c({},S.popperOptions,{modifiers:g})},[Ee,S]),ae=c({},N,{isRtl:It,arrow:z,disableInteractive:Le,placement:X,PopperComponentProp:oe,touch:Ce.current}),Be=Lo(ae),lt=(l=(u=s.popper)!=null?u:H.Popper)!=null?l:Oo,ct=(d=(h=(f=s.transition)!=null?f:H.Transition)!=null?h:p)!=null?d:ft,pt=(x=(y=s.tooltip)!=null?y:H.Tooltip)!=null?x:No,ut=(B=(R=s.arrow)!=null?R:H.Arrow)!=null?B:Ho,Vt=Te(lt,c({},S,(L=T.popper)!=null?L:k.popper,{className:U(Be.popper,S==null?void 0:S.className,(w=(Z=T.popper)!=null?Z:k.popper)==null?void 0:w.className)}),ae),qt=Te(ct,c({},m,(O=T.transition)!=null?O:k.transition),ae),Yt=Te(pt,c({},(de=T.tooltip)!=null?de:k.tooltip,{className:U(Be.tooltip,(he=(ee=T.tooltip)!=null?ee:k.tooltip)==null?void 0:he.className)}),ae),Gt=Te(ut,c({},(W=T.arrow)!=null?W:k.arrow,{className:U(Be.arrow,(te=(v=T.arrow)!=null?v:k.arrow)==null?void 0:te.className)}),ae);return t.jsxs(i.Fragment,{children:[i.cloneElement(b,C),t.jsx(lt,c({as:oe??_t,placement:X,anchorEl:P?{getBoundingClientRect:()=>({top:ce.y,left:ce.x,right:ce.x,bottom:ce.y,width:0,height:0})}:se,popperRef:Fe,open:se?A:!1,id:Ne,transition:!0},ie,Vt,{popperOptions:zt,children:({TransitionProps:a})=>t.jsx(ct,c({timeout:Je.transitions.duration.shorter},a,qt,{children:t.jsxs(pt,c({},Yt,{children:[n,z?t.jsx(ut,c({},Gt,{ref:Et})):null]}))}))}))]})});var pe={},yt;function Fo(){if(yt)return pe;yt=1;var e=Pt();Object.defineProperty(pe,"__esModule",{value:!0}),pe.default=void 0;var o=e(Tt()),r=Rt();return pe.default=(0,o.default)((0,r.jsx)("path",{d:"m21.9 8.89-1.05-4.37c-.22-.9-1-1.52-1.91-1.52H5.05c-.9 0-1.69.63-1.9 1.52L2.1 8.89c-.24 1.02-.02 2.06.62 2.88.08.11.19.19.28.29V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-6.94c.09-.09.2-.18.28-.28.64-.82.87-1.87.62-2.89m-2.99-3.9 1.05 4.37c.1.42.01.84-.25 1.17-.14.18-.44.47-.94.47-.61 0-1.14-.49-1.21-1.14L16.98 5zM13 5h1.96l.54 4.52c.05.39-.07.78-.33 1.07-.22.26-.54.41-.95.41-.67 0-1.22-.59-1.22-1.31zM8.49 9.52 9.04 5H11v4.69c0 .72-.55 1.31-1.29 1.31-.34 0-.65-.15-.89-.41-.25-.29-.37-.68-.33-1.07m-4.45-.16L5.05 5h1.97l-.58 4.86c-.08.65-.6 1.14-1.21 1.14-.49 0-.8-.29-.93-.47-.27-.32-.36-.75-.26-1.17M5 19v-6.03c.08.01.15.03.23.03.87 0 1.66-.36 2.24-.95.6.6 1.4.95 2.31.95.87 0 1.65-.36 2.23-.93.59.57 1.39.93 2.29.93.84 0 1.64-.35 2.24-.95.58.59 1.37.95 2.24.95.08 0 .15-.02.23-.03V19z"}),"Storefront"),pe}var Uo=Fo();const Bo=Mt(Uo);var ue={},wt;function Wo(){if(wt)return ue;wt=1;var e=Pt();Object.defineProperty(ue,"__esModule",{value:!0}),ue.default=void 0;var o=e(Tt()),r=Rt();return ue.default=(0,o.default)((0,r.jsx)("path",{d:"M14 10H3v2h11zm0-4H3v2h11zm4 8v-4h-2v4h-4v2h4v4h2v-4h4v-2zM3 16h7v-2H3z"}),"PlaylistAdd"),ue}var zo=Wo();const qe=Mt(zo);Ke`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`;const Ye=()=>t.jsxs(St,{sx:{mb:3,border:"1px solid #e0e0e0",boxShadow:"4px 4px 8px rgba(0,0,0,0.1)"},children:[t.jsx(Dt,{avatar:t.jsx(I,{animation:"wave",variant:"circular",width:40,height:40}),title:t.jsx(I,{animation:"wave",height:20,width:"80%"}),sx:{backgroundColor:"grey.200"}}),t.jsxs(At,{sx:{display:"flex",flexDirection:"column",gap:1.5,pt:1},children:[t.jsx(I,{animation:"wave",height:15,width:"90%"}),t.jsx(I,{animation:"wave",height:15,width:"60%"}),t.jsx(I,{animation:"wave",height:15,width:"60%"}),t.jsx(I,{animation:"wave",height:15,width:"60%"})]}),t.jsxs($t,{sx:{justifyContent:"space-between",px:2,py:1.5,backgroundColor:"grey.50"},children:[t.jsx(I,{animation:"wave",variant:"circular",width:32,height:32}),t.jsx(I,{animation:"wave",variant:"rectangular",width:100,height:36})]})]}),Jo=()=>{var T;const e={"Checked In":0,Planned:1,Completed:2,Canceled:3,Draft:4},{employeeId:o}=so(),r=ro(),[l,u]=i.useState([]),[d,h]=i.useState(!0),[f,x]=i.useState(null),[y,B]=i.useState(0),[R,L]=i.useState(!0),[w,Z]=i.useState(!1),O=i.useRef(null),de=i.useCallback(s=>{w||(O.current&&O.current.disconnect(),O.current=new IntersectionObserver(n=>{n[0].isIntersecting&&R&&B(p=>p+1)}),s&&O.current.observe(s))},[w,R]),[he,ee]=i.useState(!1),[W,te]=i.useState(null),v=i.useRef(null),N=i.useRef(null),[z,V]=i.useState(null),[H,k]=i.useState(null),[M,$e]=i.useState(null),[q,Y]=i.useState(!1),[me,j]=i.useState(null),[_,fe]=i.useState(0),[P,ge]=i.useState(!1),G=s=>s.sort((n,p)=>(e[n.status]??99)-(e[p.status]??99)),xe=i.useCallback(async s=>{s===0&&!w?h(!0):Z(!0);try{const n=await no(s);n.length<io&&L(!1),n.length>0&&u(p=>{const m=[...p,...n],D=Array.from(new Map(m.map(b=>[b.name,b])).values());return G(D)})}catch(n){x(n.message||"Failed to fetch data.")}finally{s===0&&h(!1),Z(!1)}},[w]);i.useEffect(()=>{o&&xe(y)},[o,y,xe]),i.useEffect(()=>{let s;return P&&_>0?s=setTimeout(()=>fe(_-1),1e3):_===0&&ge(!1),()=>clearTimeout(s)},[_,P]),i.useEffect(()=>{console.log("DEBUG: visitPlans state updated:",l),l.forEach(s=>{s.checkout_time&&console.log(`DEBUG: Plan ${s.name} Checkout Time: ${s.checkout_time}, Is Valid: ${K(s.checkout_time,"DD/MM/YY HH:mm:ss").isValid()}`)})},[l]);const ve=s=>{if(s.parent_docstatus===0)return t.jsx(Ve,{title:s.parent,arrow:!0,children:t.jsx(le,{label:"Draft",color:"warning",size:"small",sx:{fontWeight:"bold"}})});let n="default",p=s.status;switch(s.status){case"Planned":n="primary";break;case"Checked In":n="secondary";break;case"Completed":n="success";break;case"Canceled":n="error";break;default:p="Draft",n="error";break}return t.jsx(Ve,{title:s.parent,arrow:!0,children:t.jsx(le,{label:p,color:n,size:"small",sx:{fontWeight:"bold"}})})},be=async s=>{try{await mt(s,"Checked In")?u(p=>G(p.map(m=>m.name===s?{...m,status:"Checked In",checkin_time:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})}:m))):x("Failed to check-in.")}catch(n){x(n.message||"An unexpected error occurred during check-in.")}},Ie=s=>{const n=l.find(p=>p.name===s);if(n&&n.checkin_time){const p=K(n.checkin_time,"DD/MM/YY HH:mm:ss").toDate().getTime(),D=(new Date().getTime()-p)/1e3;D<180&&(fe(180-Math.floor(D)),ge(!0))}te(s),ee(!0),V(null),k(null),j(null),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({video:!0}).then(p=>{v.current&&(v.current.srcObject=p)}).catch(p=>{console.error("Camera access denied:",p)}),navigator.geolocation?navigator.geolocation.getCurrentPosition(p=>{$e({latitude:p.coords.latitude,longitude:p.coords.longitude})},p=>{console.error("Location access denied:",p),j("Location access is required.")}):j("Geolocation is not supported by your browser.")},X=()=>{var s;ee(!1),te(null),(s=v.current)!=null&&s.srcObject&&v.current.srcObject.getTracks().forEach(n=>n.stop())},oe=()=>{if(v.current&&N.current){const s=v.current,n=N.current;n.width=s.videoWidth,n.height=s.videoHeight;const p=n.getContext("2d");p&&(p.drawImage(s,0,0,n.width,n.height),n.toBlob(m=>{if(m){const D=new File([m],"checkout_photo.png",{type:"image/png"});k(D)}},"image/png"),V(n.toDataURL("image/png")))}},S=async()=>{if(!W||!H||!M){j("Photo and location are required.");return}Y(!0),j(null);try{const s={status:"Completed",latitude:M.latitude,longitude:M.longitude,photo:H,checkout_time:K().format("DD/MM/YY HH:mm:ss")};await mt(W,"Completed",s)?(Y(!1),X(),u(p=>G(p.map(m=>m.name===W?{...m,status:"Completed",checkout_time:s.checkout_time}:m)))):(Y(!1),j("Failed to complete checkout."))}catch(s){Y(!1),j(s.message||"An unexpected error occurred during checkout.")}};return t.jsxs(t.Fragment,{children:[t.jsxs(go,{maxWidth:"lg",sx:{mt:4,mb:4},children:[t.jsx($,{variant:"h4",component:"h1",gutterBottom:!0,align:"center",sx:{fontWeight:"bold"},children:"My Visit Schedule"}),t.jsx(F,{sx:{mb:2,textAlign:"right"},children:t.jsx(J,{variant:"contained",startIcon:t.jsx(ao,{}),onClick:()=>r("/history"),children:"History"})}),d&&y===0?t.jsxs(F,{children:[t.jsx(Ye,{}),t.jsx(Ye,{}),t.jsx(Ye,{})]}):f?t.jsx(ze,{severity:"error",children:f}):l.length===0?t.jsx(ze,{severity:"info",sx:{mt:2},children:"No visit plans found."}):t.jsxs(F,{children:[l.map((s,n)=>t.jsxs(St,{sx:{mb:3,border:"1px solid #e0e0e0",boxShadow:"4px 4px 8px rgba(0,0,0,0.1)"},ref:l.length===n+1?de:null,children:[t.jsx(Dt,{avatar:t.jsx(Bo,{sx:{color:"primary.main",fontSize:40}}),title:t.jsx($,{variant:"h6",sx:{fontWeight:"bold"},children:s.store_name}),subheader:t.jsx($,{variant:"body2",color:"text.secondary",children:s.address}),sx:{backgroundColor:"grey.100",py:1.5}}),t.jsxs(At,{sx:{display:"flex",flexDirection:"column",gap:1.5,pt:1},children:[t.jsxs(F,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(le,{label:`Planned Visit Time: ${s.planned_visit_time?K(s.planned_visit_time,"HH:mm:ss").format("HH:mm"):"N/A"}`,color:"info",size:"small"}),ve(s)]}),t.jsx(le,{icon:t.jsx(qe,{}),label:`Check-in Time: ${s.checkin_time?K(s.checkin_time,"DD/MM/YY HH:mm:ss").format("HH:mm"):"N/A"}`,variant:"outlined",size:"small"}),t.jsx(le,{icon:t.jsx(qe,{}),label:`Checkout Time: ${s.checkout_time?K(s.checkout_time,"DD/MM/YY HH:mm:ss").format("HH:mm"):"N/A"}`,variant:"outlined",size:"small"}),s.notes&&t.jsxs($,{variant:"body2",sx:{fontStyle:"italic",color:"text.secondary"},children:["Notes: ",s.notes]})]}),t.jsxs($t,{sx:{justifyContent:"space-between",px:2,py:1.5,backgroundColor:"grey.50"},children:[t.jsx(lo,{onClick:()=>r(`/notes/${s.name}`),"aria-label":"Add Notes",children:t.jsx(Ve,{title:"Add Notes",children:t.jsx(qe,{sx:{color:"primary.main"}})})}),t.jsxs(F,{children:[s.status==="Planned"&&t.jsx(J,{variant:"contained",color:"secondary",onClick:()=>be(s.name),children:"Check In"}),s.status==="Checked In"&&t.jsx(J,{variant:"contained",color:"success",onClick:()=>Ie(s.name),disabled:P,children:P?`Wait ${_}s`:"Check Out"})]})]})]},s.name)),w&&t.jsx(F,{sx:{display:"flex",justifyContent:"center",my:2},children:t.jsx(We,{})}),!R&&t.jsx($,{variant:"body2",align:"center",color:"text.secondary",sx:{my:2},children:"You have reached the end of the list."})]})]}),t.jsxs(ho,{open:he,onClose:X,fullWidth:!0,maxWidth:"sm",children:[t.jsx(To,{children:"Complete Checkout"}),t.jsxs(mo,{children:[me&&t.jsx(ze,{severity:"error",sx:{mb:2},children:me}),t.jsxs(F,{sx:{display:"flex",flexDirection:"column",gap:2},children:[t.jsx($,{children:"Take Photo:"}),t.jsx("video",{ref:v,style:{width:"100%",border:"1px solid #ccc"},autoPlay:!0,playsInline:!0}),t.jsx(J,{variant:"outlined",onClick:oe,disabled:!((T=v.current)!=null&&T.srcObject),children:"Capture Photo"}),z&&t.jsx("img",{src:z,alt:"Captured",style:{width:"100%",border:"1px solid #ccc"}}),t.jsx("canvas",{ref:N,style:{display:"none"}}),t.jsx($,{children:"Current Location:"}),M?t.jsxs($,{children:["Lat: ",M.latitude.toFixed(6),", Lng: ",M.longitude.toFixed(6)]}):t.jsx(We,{size:20})]})]}),t.jsxs(fo,{children:[t.jsx(J,{onClick:X,disabled:q,children:"Cancel"}),t.jsx(J,{onClick:S,disabled:q||!z||!M||P,variant:"contained",children:P?`Wait ${_}s`:q?t.jsx(We,{size:24,color:"inherit"}):"Complete Checkout"})]})]})]})};export{Jo as default};
