import{g as ze,a as Be,r as a,u as Ve,_ as qe,b as d,j as e,s as he,c as re,d as Ge,T as g,e as lo,h as Rt,k as gt,i as Wt,m as co,n as Ae,o as uo,p as po,q as _t,t as ho,v as mo,w as fo,x as Ne,y as go,z as Yt,A as zt,D as Xe,E as Ke,F as Je,G as Qe,H as xo,I as vo,J as bo,K as St,L as ct,M as Co,B as H,N as Tt,C as Oe}from"./index-DHtaTAx5.js";import{a as ko,h as $e,D as Fe,b as dt,c as He,d as ut}from"./moment-3hDmWnBA.js";import{u as yo}from"./useMediaQuery-BmQQ1WCQ.js";import{G as Dt,F as jo,I as wo,S as Po}from"./Select-rr9m8HoX.js";import{P as Bt,C as ye}from"./Chip-DaUSEYqM.js";import{C as Mo,A as pt}from"./Container-H39qN3_s.js";import{B as G}from"./Button-tV3dr3cq.js";import{C as Vt,a as qt,b as Gt}from"./CardHeader-ByO6tpI5.js";import{M as Ro}from"./MenuItem-CHl2vHve.js";function _o(t){return String(t).match(/[\d.\-+]*\s*(.*)/)[1]||""}function So(t){return parseFloat(t)}function To(t){return ze("MuiCardActions",t)}Be("MuiCardActions",["root","spacing"]);const Do=["disableSpacing","className"],Io=t=>{const{classes:o,disableSpacing:s}=t;return Ge({root:["root",!s&&"spacing"]},To,o)},Eo=he("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:s}=t;return[o.root,!s.disableSpacing&&o.spacing]}})(({ownerState:t})=>d({display:"flex",alignItems:"center",padding:8},!t.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})),Xt=a.forwardRef(function(o,s){const l=Ve({props:o,name:"MuiCardActions"}),{disableSpacing:f=!1,className:h}=l,m=qe(l,Do),v=d({},l,{disableSpacing:f}),b=Io(v);return e.jsx(Eo,d({className:re(b.root,h),ownerState:v,ref:s},m))});function Lo(t){return ze("MuiDialogContentText",t)}Be("MuiDialogContentText",["root"]);const Ao=["children","className"],No=t=>{const{classes:o}=t,l=Ge({root:["root"]},Lo,o);return d({},o,l)},Oo=he(g,{shouldForwardProp:t=>lo(t)||t==="classes",name:"MuiDialogContentText",slot:"Root",overridesResolver:(t,o)=>o.root})({}),It=a.forwardRef(function(o,s){const l=Ve({props:o,name:"MuiDialogContentText"}),{className:f}=l,h=qe(l,Ao),m=No(h);return e.jsx(Oo,d({component:"p",variant:"body1",color:"text.secondary",ref:s,ownerState:h,className:re(m.root,f)},l,{classes:m}))});function $o(t){return ze("MuiSkeleton",t)}Be("MuiSkeleton",["root","text","rectangular","rounded","circular","pulse","wave","withChildren","fitContent","heightAuto"]);const Fo=["animation","className","component","height","style","variant","width"];let Ye=t=>t,Et,Lt,At,Nt;const Ho=t=>{const{classes:o,variant:s,animation:l,hasChildren:f,width:h,height:m}=t;return Ge({root:["root",s,l,f&&"withChildren",f&&!h&&"fitContent",f&&!m&&"heightAuto"]},$o,o)},Uo=gt(Et||(Et=Ye`
  0% {
    opacity: 1;
  }

  50% {
    opacity: 0.4;
  }

  100% {
    opacity: 1;
  }
`)),Wo=gt(Lt||(Lt=Ye`
  0% {
    transform: translateX(-100%);
  }

  50% {
    /* +0.5s of delay between each loop */
    transform: translateX(100%);
  }

  100% {
    transform: translateX(100%);
  }
`)),Yo=he("span",{name:"MuiSkeleton",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:s}=t;return[o.root,o[s.variant],s.animation!==!1&&o[s.animation],s.hasChildren&&o.withChildren,s.hasChildren&&!s.width&&o.fitContent,s.hasChildren&&!s.height&&o.heightAuto]}})(({theme:t,ownerState:o})=>{const s=_o(t.shape.borderRadius)||"px",l=So(t.shape.borderRadius);return d({display:"block",backgroundColor:t.vars?t.vars.palette.Skeleton.bg:ko(t.palette.text.primary,t.palette.mode==="light"?.11:.13),height:"1.2em"},o.variant==="text"&&{marginTop:0,marginBottom:0,height:"auto",transformOrigin:"0 55%",transform:"scale(1, 0.60)",borderRadius:`${l}${s}/${Math.round(l/.6*10)/10}${s}`,"&:empty:before":{content:'"\\00a0"'}},o.variant==="circular"&&{borderRadius:"50%"},o.variant==="rounded"&&{borderRadius:(t.vars||t).shape.borderRadius},o.hasChildren&&{"& > *":{visibility:"hidden"}},o.hasChildren&&!o.width&&{maxWidth:"fit-content"},o.hasChildren&&!o.height&&{height:"auto"})},({ownerState:t})=>t.animation==="pulse"&&Rt(At||(At=Ye`
      animation: ${0} 2s ease-in-out 0.5s infinite;
    `),Uo),({ownerState:t,theme:o})=>t.animation==="wave"&&Rt(Nt||(Nt=Ye`
      position: relative;
      overflow: hidden;

      /* Fix bug in Safari https://bugs.webkit.org/show_bug.cgi?id=68196 */
      -webkit-mask-image: -webkit-radial-gradient(white, black);

      &::after {
        animation: ${0} 2s linear 0.5s infinite;
        background: linear-gradient(
          90deg,
          transparent,
          ${0},
          transparent
        );
        content: '';
        position: absolute;
        transform: translateX(-100%); /* Avoid flash during server-side hydration */
        bottom: 0;
        left: 0;
        right: 0;
        top: 0;
      }
    `),Wo,(o.vars||o).palette.action.hover)),X=a.forwardRef(function(o,s){const l=Ve({props:o,name:"MuiSkeleton"}),{animation:f="pulse",className:h,component:m="span",height:v,style:b,variant:I="text",width:C}=l,P=qe(l,Fo),U=d({},l,{animation:f,component:m,variant:I,hasChildren:!!P.children}),W=Ho(U);return e.jsx(Yo,d({as:m,ref:s,className:re(W.root,h),ownerState:U},P,{style:d({width:C,height:v},b)}))});function zo(t){return ze("MuiTooltip",t)}const K=Be("MuiTooltip",["popper","popperInteractive","popperArrow","popperClose","tooltip","tooltipArrow","touch","tooltipPlacementLeft","tooltipPlacementRight","tooltipPlacementTop","tooltipPlacementBottom","arrow"]),Bo=["arrow","children","classes","components","componentsProps","describeChild","disableFocusListener","disableHoverListener","disableInteractive","disableTouchListener","enterDelay","enterNextDelay","enterTouchDelay","followCursor","id","leaveDelay","leaveTouchDelay","onClose","onOpen","open","placement","PopperComponent","PopperProps","slotProps","slots","title","TransitionComponent","TransitionProps"];function Vo(t){return Math.round(t*1e5)/1e5}const qo=t=>{const{classes:o,disableInteractive:s,arrow:l,touch:f,placement:h}=t,m={popper:["popper",!s&&"popperInteractive",l&&"popperArrow"],tooltip:["tooltip",l&&"tooltipArrow",f&&"touch",`tooltipPlacement${Yt(h.split("-")[0])}`],arrow:["arrow"]};return Ge(m,zo,o)},Go=he(Bt,{name:"MuiTooltip",slot:"Popper",overridesResolver:(t,o)=>{const{ownerState:s}=t;return[o.popper,!s.disableInteractive&&o.popperInteractive,s.arrow&&o.popperArrow,!s.open&&o.popperClose]}})(({theme:t,ownerState:o,open:s})=>d({zIndex:(t.vars||t).zIndex.tooltip,pointerEvents:"none"},!o.disableInteractive&&{pointerEvents:"auto"},!s&&{pointerEvents:"none"},o.arrow&&{[`&[data-popper-placement*="bottom"] .${K.arrow}`]:{top:0,marginTop:"-0.71em","&::before":{transformOrigin:"0 100%"}},[`&[data-popper-placement*="top"] .${K.arrow}`]:{bottom:0,marginBottom:"-0.71em","&::before":{transformOrigin:"100% 0"}},[`&[data-popper-placement*="right"] .${K.arrow}`]:d({},o.isRtl?{right:0,marginRight:"-0.71em"}:{left:0,marginLeft:"-0.71em"},{height:"1em",width:"0.71em","&::before":{transformOrigin:"100% 100%"}}),[`&[data-popper-placement*="left"] .${K.arrow}`]:d({},o.isRtl?{left:0,marginLeft:"-0.71em"}:{right:0,marginRight:"-0.71em"},{height:"1em",width:"0.71em","&::before":{transformOrigin:"0 0"}})})),Xo=he("div",{name:"MuiTooltip",slot:"Tooltip",overridesResolver:(t,o)=>{const{ownerState:s}=t;return[o.tooltip,s.touch&&o.touch,s.arrow&&o.tooltipArrow,o[`tooltipPlacement${Yt(s.placement.split("-")[0])}`]]}})(({theme:t,ownerState:o})=>d({backgroundColor:t.vars?t.vars.palette.Tooltip.bg:zt.alpha(t.palette.grey[700],.92),borderRadius:(t.vars||t).shape.borderRadius,color:(t.vars||t).palette.common.white,fontFamily:t.typography.fontFamily,padding:"4px 8px",fontSize:t.typography.pxToRem(11),maxWidth:300,margin:2,wordWrap:"break-word",fontWeight:t.typography.fontWeightMedium},o.arrow&&{position:"relative",margin:0},o.touch&&{padding:"8px 16px",fontSize:t.typography.pxToRem(14),lineHeight:`${Vo(16/14)}em`,fontWeight:t.typography.fontWeightRegular},{[`.${K.popper}[data-popper-placement*="left"] &`]:d({transformOrigin:"right center"},o.isRtl?d({marginLeft:"14px"},o.touch&&{marginLeft:"24px"}):d({marginRight:"14px"},o.touch&&{marginRight:"24px"})),[`.${K.popper}[data-popper-placement*="right"] &`]:d({transformOrigin:"left center"},o.isRtl?d({marginRight:"14px"},o.touch&&{marginRight:"24px"}):d({marginLeft:"14px"},o.touch&&{marginLeft:"24px"})),[`.${K.popper}[data-popper-placement*="top"] &`]:d({transformOrigin:"center bottom",marginBottom:"14px"},o.touch&&{marginBottom:"24px"}),[`.${K.popper}[data-popper-placement*="bottom"] &`]:d({transformOrigin:"center top",marginTop:"14px"},o.touch&&{marginTop:"24px"})})),Ko=he("span",{name:"MuiTooltip",slot:"Arrow",overridesResolver:(t,o)=>o.arrow})(({theme:t})=>({overflow:"hidden",position:"absolute",width:"1em",height:"0.71em",boxSizing:"border-box",color:t.vars?t.vars.palette.Tooltip.bg:zt.alpha(t.palette.grey[700],.9),"&::before":{content:'""',margin:"auto",display:"block",width:"100%",height:"100%",backgroundColor:"currentColor",transform:"rotate(45deg)"}}));let Ue=!1;const Ot=new go;let je={x:0,y:0};function We(t,o){return(s,...l)=>{o&&o(s,...l),t(s,...l)}}const we=a.forwardRef(function(o,s){var l,f,h,m,v,b,I,C,P,U,W,Y,se,ae,Ze,me,J,Se,Q;const ne=Ve({props:o,name:"MuiTooltip"}),{arrow:E=!1,children:ie,components:L={},componentsProps:M={},describeChild:fe=!1,disableFocusListener:et=!1,disableHoverListener:z=!1,disableInteractive:tt=!1,disableTouchListener:x=!1,enterDelay:Te=100,enterNextDelay:le=0,enterTouchDelay:ce=700,followCursor:de=!1,id:B,leaveDelay:ge=0,leaveTouchDelay:xt=1500,onClose:De,onOpen:Ie,open:ot,placement:Z="bottom",PopperComponent:A,PopperProps:R={},slotProps:$={},slots:N={},title:F,TransitionComponent:ue=Dt,TransitionProps:xe}=ne,ee=qe(ne,Bo),j=a.isValidElement(ie)?ie:e.jsx("span",{children:ie}),O=Wt(),rt=co(),[te,Ee]=a.useState(),[V,st]=a.useState(null),oe=a.useRef(!1),ve=tt||de,Le=Ae(),pe=Ae(),r=Ae(),n=Ae(),[c,u]=uo({controlled:ot,default:!1,name:"Tooltip",state:"open"});let p=c;const _=po(B),S=a.useRef(),k=_t(()=>{S.current!==void 0&&(document.body.style.WebkitUserSelect=S.current,S.current=void 0),n.clear()});a.useEffect(()=>k,[k]);const w=i=>{Ot.clear(),Ue=!0,u(!0),Ie&&!p&&Ie(i)},T=_t(i=>{Ot.start(800+ge,()=>{Ue=!1}),u(!1),De&&p&&De(i),Le.start(O.transitions.duration.shortest,()=>{oe.current=!1})}),q=i=>{oe.current&&i.type!=="touchstart"||(te&&te.removeAttribute("title"),pe.clear(),r.clear(),Te||Ue&&le?pe.start(Ue?le:Te,()=>{w(i)}):w(i))},at=i=>{pe.clear(),r.start(ge,()=>{T(i)})},{isFocusVisibleRef:vt,onBlur:Kt,onFocus:Jt,ref:Qt}=ho(),[,bt]=a.useState(!1),Ct=i=>{Kt(i),vt.current===!1&&(bt(!1),at(i))},kt=i=>{te||Ee(i.currentTarget),Jt(i),vt.current===!0&&(bt(!0),q(i))},yt=i=>{oe.current=!0;const y=j.props;y.onTouchStart&&y.onTouchStart(i)},Zt=i=>{yt(i),r.clear(),Le.clear(),k(),S.current=document.body.style.WebkitUserSelect,document.body.style.WebkitUserSelect="none",n.start(ce,()=>{document.body.style.WebkitUserSelect=S.current,q(i)})},eo=i=>{j.props.onTouchEnd&&j.props.onTouchEnd(i),k(),r.start(xt,()=>{T(i)})};a.useEffect(()=>{if(!p)return;function i(y){(y.key==="Escape"||y.key==="Esc")&&T(y)}return document.addEventListener("keydown",i),()=>{document.removeEventListener("keydown",i)}},[T,p]);const to=mo(fo(j),Qt,Ee,s);!F&&F!==0&&(p=!1);const nt=a.useRef(),oo=i=>{const y=j.props;y.onMouseMove&&y.onMouseMove(i),je={x:i.clientX,y:i.clientY},nt.current&&nt.current.update()},be={},it=typeof F=="string";fe?(be.title=!p&&it&&!z?F:null,be["aria-describedby"]=p?_:null):(be["aria-label"]=it?F:null,be["aria-labelledby"]=p&&!it?_:null);const D=d({},be,ee,j.props,{className:re(ee.className,j.props.className),onTouchStart:yt,ref:to},de?{onMouseMove:oo}:{}),Ce={};x||(D.onTouchStart=Zt,D.onTouchEnd=eo),z||(D.onMouseOver=We(q,D.onMouseOver),D.onMouseLeave=We(at,D.onMouseLeave),ve||(Ce.onMouseOver=q,Ce.onMouseLeave=at)),et||(D.onFocus=We(kt,D.onFocus),D.onBlur=We(Ct,D.onBlur),ve||(Ce.onFocus=kt,Ce.onBlur=Ct));const ro=a.useMemo(()=>{var i;let y=[{name:"arrow",enabled:!!V,options:{element:V,padding:4}}];return(i=R.popperOptions)!=null&&i.modifiers&&(y=y.concat(R.popperOptions.modifiers)),d({},R.popperOptions,{modifiers:y})},[V,R]),ke=d({},ne,{isRtl:rt,arrow:E,disableInteractive:ve,placement:Z,PopperComponentProp:A,touch:oe.current}),lt=qo(ke),jt=(l=(f=N.popper)!=null?f:L.Popper)!=null?l:Go,wt=(h=(m=(v=N.transition)!=null?v:L.Transition)!=null?m:ue)!=null?h:Dt,Pt=(b=(I=N.tooltip)!=null?I:L.Tooltip)!=null?b:Xo,Mt=(C=(P=N.arrow)!=null?P:L.Arrow)!=null?C:Ko,so=Ne(jt,d({},R,(U=$.popper)!=null?U:M.popper,{className:re(lt.popper,R==null?void 0:R.className,(W=(Y=$.popper)!=null?Y:M.popper)==null?void 0:W.className)}),ke),ao=Ne(wt,d({},xe,(se=$.transition)!=null?se:M.transition),ke),no=Ne(Pt,d({},(ae=$.tooltip)!=null?ae:M.tooltip,{className:re(lt.tooltip,(Ze=(me=$.tooltip)!=null?me:M.tooltip)==null?void 0:Ze.className)}),ke),io=Ne(Mt,d({},(J=$.arrow)!=null?J:M.arrow,{className:re(lt.arrow,(Se=(Q=$.arrow)!=null?Q:M.arrow)==null?void 0:Se.className)}),ke);return e.jsxs(a.Fragment,{children:[a.cloneElement(j,D),e.jsx(jt,d({as:A??Bt,placement:Z,anchorEl:de?{getBoundingClientRect:()=>({top:je.y,left:je.x,right:je.x,bottom:je.y,width:0,height:0})}:te,popperRef:nt,open:te?p:!1,id:_,transition:!0},Ce,so,{popperOptions:ro,children:({TransitionProps:i})=>e.jsx(wt,d({timeout:O.transitions.duration.shorter},i,ao,{children:e.jsxs(Pt,d({},no,{children:[F,E?e.jsx(Mt,d({},io,{ref:st})):null]}))}))}))]})});var Pe={},$t;function Jo(){if($t)return Pe;$t=1;var t=Xe();Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.default=void 0;var o=t(Ke()),s=Je();return Pe.default=(0,o.default)((0,s.jsx)("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8z"}),"History"),Pe}var Qo=Jo();const Zo=Qe(Qo);var Me={},Ft;function er(){if(Ft)return Me;Ft=1;var t=Xe();Object.defineProperty(Me,"__esModule",{value:!0}),Me.default=void 0;var o=t(Ke()),s=Je();return Me.default=(0,o.default)((0,s.jsx)("path",{d:"m21.9 8.89-1.05-4.37c-.22-.9-1-1.52-1.91-1.52H5.05c-.9 0-1.69.63-1.9 1.52L2.1 8.89c-.24 1.02-.02 2.06.62 2.88.08.11.19.19.28.29V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-6.94c.09-.09.2-.18.28-.28.64-.82.87-1.87.62-2.89m-2.99-3.9 1.05 4.37c.1.42.01.84-.25 1.17-.14.18-.44.47-.94.47-.61 0-1.14-.49-1.21-1.14L16.98 5zM13 5h1.96l.54 4.52c.05.39-.07.78-.33 1.07-.22.26-.54.41-.95.41-.67 0-1.22-.59-1.22-1.31zM8.49 9.52 9.04 5H11v4.69c0 .72-.55 1.31-1.29 1.31-.34 0-.65-.15-.89-.41-.25-.29-.37-.68-.33-1.07m-4.45-.16L5.05 5h1.97l-.58 4.86c-.08.65-.6 1.14-1.21 1.14-.49 0-.8-.29-.93-.47-.27-.32-.36-.75-.26-1.17M5 19v-6.03c.08.01.15.03.23.03.87 0 1.66-.36 2.24-.95.6.6 1.4.95 2.31.95.87 0 1.65-.36 2.23-.93.59.57 1.39.93 2.29.93.84 0 1.64-.35 2.24-.95.58.59 1.37.95 2.24.95.08 0 .15-.02.23-.03V19z"}),"Storefront"),Me}var tr=er();const or=Qe(tr);var Re={},Ht;function rr(){if(Ht)return Re;Ht=1;var t=Xe();Object.defineProperty(Re,"__esModule",{value:!0}),Re.default=void 0;var o=t(Ke()),s=Je();return Re.default=(0,o.default)((0,s.jsx)("path",{d:"M14 10H3v2h11zm0-4H3v2h11zm4 8v-4h-2v4h-4v2h4v4h2v-4h4v-2zM3 16h7v-2H3z"}),"PlaylistAdd"),Re}var sr=rr();const ht=Qe(sr);var _e={},Ut;function ar(){if(Ut)return _e;Ut=1;var t=Xe();Object.defineProperty(_e,"__esModule",{value:!0}),_e.default=void 0;var o=t(Ke()),s=Je();return _e.default=(0,o.default)((0,s.jsx)("path",{d:"M12 2 4.5 20.29l.71.71L12 18l6.79 3 .71-.71z"}),"Navigation"),_e}var nr=ar();const ir=Qe(nr);gt`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`;const mt=()=>e.jsxs(Vt,{sx:{mb:3,border:"1px solid #e0e0e0",boxShadow:"4px 4px 8px rgba(0,0,0,0.1)"},children:[e.jsx(qt,{avatar:e.jsx(X,{animation:"wave",variant:"circular",width:40,height:40}),title:e.jsx(X,{animation:"wave",height:20,width:"80%"}),sx:{backgroundColor:"grey.200"}}),e.jsxs(Gt,{sx:{flexGrow:1,display:"flex",flexDirection:"column",gap:1.5,pt:1},children:[e.jsx(X,{animation:"wave",height:15,width:"90%"}),e.jsx(X,{animation:"wave",height:15,width:"60%"}),e.jsx(X,{animation:"wave",height:15,width:"60%"}),e.jsx(X,{animation:"wave",height:15,width:"60%"})]}),e.jsxs(Xt,{sx:{justifyContent:"space-between",px:2,py:1.5,backgroundColor:"grey.50"},children:[e.jsx(X,{animation:"wave",variant:"circular",width:32,height:32}),e.jsx(X,{animation:"wave",variant:"rectangular",width:100,height:36})]})]}),lr=(t,o,s,l)=>{const h=t*Math.PI/180,m=s*Math.PI/180,v=(s-t)*Math.PI/180,b=(l-o)*Math.PI/180,I=Math.sin(v/2)*Math.sin(v/2)+Math.cos(h)*Math.cos(m)*Math.sin(b/2)*Math.sin(b/2);return 6371e3*(2*Math.atan2(Math.sqrt(I),Math.sqrt(1-I)))},ft=t=>t<500?`${Math.round(t)} meter`:`${(t/1e3).toFixed(1)} km`,vr=()=>{const t=Wt(),o=yo(t.breakpoints.down("sm")),s=a.useMemo(()=>({"Checked In":0,Planned:1,Completed:2,Canceled:3,Draft:4}),[]),{employeeId:l}=xo(),f=vo(),[h,m]=a.useState([]),[v,b]=a.useState(!0),[I,C]=a.useState(null),[P,U]=a.useState(0),[W,Y]=a.useState(!0),[se,ae]=a.useState(!1),[Ze,me]=a.useState(0),J=a.useRef(null),Se=a.useCallback(r=>{se||(J.current&&J.current.disconnect(),J.current=new IntersectionObserver(n=>{n[0].isIntersecting&&W&&U(c=>c+1)}),r&&J.current.observe(r))},[se,W]),[Q,ne]=a.useState(!1),[E,ie]=a.useState(null),L=a.useRef(null),M=a.useRef(null),[fe,et]=a.useState(null),[z,tt]=a.useState(null),[x,Te]=a.useState(null),[le,ce]=a.useState(!1),[de,B]=a.useState(null),[ge,xt]=a.useState([]),[De,Ie]=a.useState(void 0),[ot,Z]=a.useState(!1),[A,R]=a.useState({isOpen:!1,distance:0}),[$,N]=a.useState(!1),[F,ue]=a.useState(null),[xe,ee]=a.useState(null);a.useEffect(()=>{if(Q&&xe){Z(!1);const r=()=>{L.current?(L.current.srcObject=xe,Z(!0)):(console.warn("DEBUG: videoRef.current is null in useEffect. Retrying..."),setTimeout(r,50))};r()}else Q||Z(!1)},[Q,xe]);const j=a.useCallback(r=>r.sort((n,c)=>(s[n.status]??99)-(s[c.status]??99)),[s]),O=a.useCallback(async r=>{if(!l){C("Employee ID not available."),b(!1),ae(!1);return}r===0?b(!0):ae(!0);try{const n=await bo(r);if(n.error_message){C(n.error_message),Y(!1),m([]);return}const c=n.data,u=n.total;r===0?(m(j(c)),me(u),Y(c.length<u)):m(p=>{const _=[...p,...c],S=Array.from(new Map(_.map(w=>[w.name,w])).values()),k=j(S);return Y(k.length<u),k}),C(null)}catch(n){console.error("Error fetching visit plans:",n),C(n instanceof Error?n.message:"Failed to fetch data."),Y(!1)}finally{r===0&&b(!1),ae(!1)}},[l,j]);a.useEffect(()=>{l&&(m([]),U(0),Y(!0),me(0),O(0))},[l,O]),a.useEffect(()=>{P>0&&O(P)},[P,O]);const rt=a.useCallback(r=>{if(r.parent_docstatus===0)return e.jsx(we,{title:r.parent,arrow:!0,children:e.jsx(ye,{label:"Draft",color:"warning",size:"small",sx:{fontWeight:"bold"}})});let n="default",c=r.status;switch(r.status){case"Planned":n="primary";break;case"Checked In":n="secondary";break;case"Completed":n="success";break;case"Canceled":n="error";break;default:c="Draft",n="error";break}return e.jsx(we,{title:r.parent,arrow:!0,children:e.jsx(ye,{label:c,color:n,size:"small",sx:{fontWeight:"bold"}})})},[]),te=async r=>{try{await St(r,"Checked In")?O(0):C("Failed to check-in.")}catch(n){C(n instanceof Error?n.message:"An unexpected error occurred during check-in.")}},Ee=async r=>{const n=h.find(u=>u.name===r);if(!n)return;ie(r),N(!0),ue(null);let c=null;try{const u=navigator.mediaDevices.getUserMedia({video:!0}),p=new Promise((w,T)=>{if(!navigator.geolocation)return T(new Error("Geolocation is not supported."));navigator.geolocation.getCurrentPosition(q=>w(q.coords),q=>T(q))}),[_,S]=await Promise.all([u,p]);c=_,ee(c),Te(S);const k=await ct(n.store_name);if(k&&k.latitude&&k.longitude){const w=lr(k.latitude,k.longitude,S.latitude,S.longitude);if(w>100){N(!1),R({isOpen:!0,distance:w,type:"too_far"}),c&&c.getTracks().forEach(T=>T.stop()),ee(null);return}else if(w>5){N(!1),R({isOpen:!0,distance:w,type:"almost_there"}),c&&c.getTracks().forEach(T=>T.stop()),ee(null);return}}N(!1),ne(!0)}catch(u){console.error("DEBUG: Error during pre-checkout validation:",u),console.error("DEBUG: Error during pre-checkout validation:",u),c&&c.getTracks().forEach(_=>_.stop()),ee(null);let p="Gagal mempersiapkan checkout. Pastikan izin lokasi dan kamera telah diberikan.";u instanceof GeolocationPositionError?u.code===u.PERMISSION_DENIED?p="Akses lokasi ditolak. Mohon aktifkan di pengaturan browser.":u.code===u.POSITION_UNAVAILABLE&&(p="Informasi lokasi tidak tersedia saat ini."):u instanceof Error&&u.name==="NotAllowedError"&&(p="Akses kamera ditolak. Mohon aktifkan di pengaturan browser."),ue(p),N(!1)}},V=a.useCallback(()=>{ne(!1),ie(null),Z(!1)},[]),st=a.useCallback(()=>{if(L.current&&M.current){const r=L.current,n=M.current;n.width=r.videoWidth,n.height=r.videoHeight;const c=n.getContext("2d");if(c){c.drawImage(r,0,0,r.videoWidth,r.videoHeight);const u=n.toDataURL("image/jpeg");et(u),n.toBlob(p=>{p&&tt(new File([p],"captured_photo.jpeg",{type:"image/jpeg"}))},"image/jpeg")}}},[]),oe=a.useCallback(async()=>{if(!x||!E||!z){B("Pastikan foto sudah diambil dan lokasi tersedia."),ce(!1);return}try{await St(E,"Completed",{latitude:x.latitude,longitude:x.longitude,photo_file:z,checkout_time:$e().format("YYYY-MM-DD HH:mm:ss")})?(V(),O(0)):B("Gagal menyelesaikan checkout.")}catch(r){B(r instanceof Error?r.message:"Terjadi error saat checkout.")}finally{ce(!1)}},[x,E,z,V,O]),ve=a.useCallback(async()=>{if(!x||!E||!z){B("Pastikan foto sudah diambil dan lokasi tersedia.");return}ce(!0),B(null);try{const r=h.find(c=>c.name===E);if(!r)throw new Error("Data kunjungan tidak ditemukan.");await ct(r.store_name)||await Co(r.store_name,x.latitude,x.longitude),await oe()}catch(r){B(r instanceof Error?r.message:"Gagal memvalidasi lokasi."),ce(!1)}},[E,x,z,h,oe]),Le=async r=>{const n=await ct(r.store_name);if(n&&n.latitude&&n.longitude){const c=`https://www.google.com/maps/dir/?api=1&destination=${n.latitude},${n.longitude}`;window.open(c,"_blank")}else C(`Lokasi untuk customer ${r.store_name} tidak ditemukan.`)},pe=a.useCallback((r,n)=>{if(!r)return"N/A";const c=$e(r,"DD-MM-YYYY HH:mm:ss");if(!c.isValid())return"Invalid Date";if(n){const u=$e(n,"DD-MM-YYYY HH:mm");if(u.isValid()&&c.isSame(u,"day"))return c.format("HH:mm")}return c.format("DD-MM-YYYY HH:mm")},[]);return e.jsxs(e.Fragment,{children:[e.jsxs(Mo,{maxWidth:"lg",sx:{mt:4,mb:4,width:"100%",overflowX:"hidden"},children:[e.jsx(g,{variant:"h4",component:"h1",gutterBottom:!0,align:"center",sx:{fontWeight:"bold"},children:"My Visit Schedule"}),e.jsx(H,{sx:{mb:2,textAlign:"right"},children:e.jsx(G,{variant:"contained",startIcon:e.jsx(Zo,{}),onClick:()=>f("/history"),children:"History"})}),v&&P===0?e.jsxs(H,{children:[e.jsx(mt,{}),e.jsx(mt,{}),e.jsx(mt,{})]}):I?e.jsx(pt,{severity:"error",children:I}):h.length===0?e.jsx(pt,{severity:"info",sx:{mt:2},children:"No visit plans found."}):e.jsxs(H,{children:[h.map((r,n)=>e.jsxs(Vt,{sx:{mb:3,border:"1px solid #e0e0e0",boxShadow:"4px 4px 8px rgba(0,0,0,0.1)",width:o?"100%":"auto"},ref:h.length===n+1?Se:null,children:[e.jsx(qt,{avatar:e.jsx(or,{sx:{color:"primary.main",fontSize:40}}),title:e.jsx(g,{variant:"h6",sx:{fontWeight:"bold"},children:r.store_name}),subheader:e.jsx(g,{variant:"body2",color:"text.secondary",children:r.address}),sx:{backgroundColor:"grey.100",py:1.5}}),e.jsxs(Gt,{sx:{display:"flex",flexDirection:"column",gap:1.5,pt:1},children:[e.jsxs(H,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(ye,{label:e.jsxs(H,{component:"span",children:["Planning :"," ",e.jsx(g,{component:"span",sx:{fontWeight:"bold",color:"#FFFFFF"},children:r.planned_visit_time?$e(r.planned_visit_time,"DD-MM-YYYY HH:mm").format("DD-MM-YYYY HH:mm"):"N/A"})]}),color:"info",size:"small"}),rt(r)]}),e.jsx(ye,{icon:e.jsx(ht,{}),label:`CheckIn: ${pe(r.checkin_time,r.planned_visit_time)}`,variant:"outlined",size:"small"}),e.jsx(ye,{icon:e.jsx(ht,{}),label:`CheckOut: ${pe(r.checkout_time,r.planned_visit_time)}`,variant:"outlined",size:"small"}),r.notes&&e.jsxs(g,{variant:"body2",sx:{fontStyle:"italic",color:"text.secondary"},children:["Notes: ",r.notes]})]}),e.jsxs(Xt,{sx:{justifyContent:"space-between",px:2,py:1.5,backgroundColor:"grey.50"},children:[e.jsxs(H,{children:[e.jsx(Tt,{onClick:()=>Le(r),"aria-label":"Navigate",children:e.jsx(we,{title:"Navigate to Customer",children:e.jsx(ir,{sx:{color:"primary.main"}})})}),e.jsx(Tt,{onClick:()=>f(`/notes/${r.name}`),"aria-label":"Add Notes",children:e.jsx(we,{title:"Add Notes",children:e.jsx(ht,{})})})]}),e.jsxs(H,{children:[r.status==="Planned"&&e.jsx(G,{variant:"contained",color:"secondary",onClick:()=>te(r.name),children:"Check In"}),r.status==="Checked In"&&e.jsx(G,{variant:"contained",color:"success",onClick:()=>Ee(r.name),children:"Check Out"})]})]})]},r.name)),se&&e.jsx(H,{sx:{display:"flex",justifyContent:"center",my:2},children:e.jsx(Oe,{})}),!W&&e.jsx(g,{variant:"body2",align:"center",color:"text.secondary",sx:{my:2},children:"You have reached the end of the list."})]})]}),e.jsxs(Fe,{open:Q,onClose:V,fullWidth:!0,maxWidth:"sm",children:[e.jsx(dt,{children:"Complete Checkout"}),e.jsxs(He,{children:[de&&e.jsx(pt,{severity:"error",sx:{mb:2},children:de}),e.jsxs(H,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(g,{children:"Take Photo:"}),e.jsx("video",{ref:L,style:{width:"100%",border:"1px solid #ccc"},autoPlay:!0,playsInline:!0}),ge.length>1&&e.jsxs(jo,{fullWidth:!0,children:[e.jsx(wo,{id:"camera-select-label",children:"Camera"}),e.jsx(Po,{labelId:"camera-select-label",value:De||"",label:"Camera",onChange:r=>Ie(r.target.value),children:ge.map(r=>e.jsx(Ro,{value:r.deviceId,children:r.label},r.deviceId))})]}),e.jsx(G,{variant:"outlined",onClick:st,disabled:!ot,children:"Capture Photo"}),fe&&e.jsx("img",{src:fe,alt:"Captured",style:{width:"100%",border:"1px solid #ccc"}}),e.jsx("canvas",{ref:M,style:{display:"none"}}),e.jsx(g,{children:"Current Location:"}),x?e.jsxs(g,{children:["Lat: ",x.latitude.toFixed(6),", Lng: ",x.longitude.toFixed(6)]}):e.jsx(Oe,{size:20})]})]}),e.jsxs(ut,{children:[e.jsx(G,{onClick:V,disabled:le,children:"Cancel"}),e.jsx(G,{onClick:ve,disabled:le||!fe||!x,variant:"contained",children:le?e.jsx(Oe,{size:24,color:"inherit"}):"Complete Checkout"})]})]}),e.jsxs(Fe,{open:A.isOpen,onClose:()=>R({isOpen:!1,distance:0}),children:[e.jsx(dt,{children:"Lokasi Terlalu Jauh"}),e.jsx(He,{children:(()=>{const r=h.find(_=>_.name===E),n=(r==null?void 0:r.store_name)||"customer",c=(r==null?void 0:r.address)||"alamat tidak tersedia",u=e.jsx(we,{title:c,arrow:!0,children:e.jsx(g,{component:"span",sx:{fontWeight:"bold"},children:n})});let p;return A.type==="too_far"?p=e.jsxs(e.Fragment,{children:["Lokasi Anda berjarak sekitar ",e.jsx(g,{component:"span",sx:{fontWeight:"bold"},children:ft(A.distance)})," dari lokasi customer.",e.jsx("br",{}),e.jsx("br",{}),"Lokasi Anda terlalu jauh dengan ",u,". Silahkan terus berjalan mendekat.",e.jsx("br",{}),"Gunakan button refresh untuk memperbaharui."]}):A.type==="almost_there"?p=e.jsxs(e.Fragment,{children:["Lokasi Anda berjarak sekitar ",e.jsx(g,{component:"span",sx:{fontWeight:"bold"},children:ft(A.distance)})," dari lokasi customer.",e.jsx("br",{}),e.jsx("br",{}),"Terus melangkah lagi lokasi anda sudah dekat.",e.jsx("br",{}),"Gunakan button refresh untuk memperbaharui."]}):p=e.jsxs(e.Fragment,{children:["Lokasi Anda berjarak sekitar ",e.jsx(g,{component:"span",sx:{fontWeight:"bold"},children:ft(A.distance)})," dari lokasi customer.",e.jsx("br",{}),e.jsx("br",{}),"Silahkan berjalan lagi untuk mendapatkan lokasi yang sesuai."]}),e.jsx(It,{children:p})})()}),e.jsx(ut,{children:e.jsx(G,{onClick:()=>window.location.reload(),color:"primary",children:"Refresh"})})]}),e.jsx(Fe,{open:$,children:e.jsxs(He,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Oe,{}),e.jsx(g,{children:"Mempersiapkan checkout..."})]})}),e.jsxs(Fe,{open:!!F,onClose:()=>ue(null),children:[e.jsx(dt,{children:"Error"}),e.jsx(He,{children:e.jsx(It,{children:F})}),e.jsx(ut,{children:e.jsx(G,{onClick:()=>ue(null),children:"Tutup"})})]})]})};export{vr as default};
