import{g as qe,a as Ge,r as a,u as _e,_ as Se,b as d,j as e,s as re,c as K,d as De,T as x,e as lo,h as Rt,k as gt,i as Wt,m as co,n as Oe,o as uo,p as po,q as Tt,t as ho,v as mo,w as fo,x as Fe,y as go,z as Yt,A as zt,D as Xe,E as Ke,F as Je,G as Qe,H as xo,I as vo,J as bo,K as _t,L as ct,M as Co,B as H,N as St,C as He}from"./index-C6ODMV6W.js";import{D as ko,g as yo,a as jo,h as Ue,b as We,c as Ye,M as wo,d as dt}from"./moment-BJ0-ihcQ.js";import{u as Po}from"./useMediaQuery-Cg2tXox_.js";import{G as Dt,F as Mo,I as Ro,S as To}from"./Select-C9WcmEte.js";import{P as Bt,C as ye}from"./Chip-NJl1c1TY.js";import{C as _o,A as ut}from"./Container-C1dWCfSV.js";import{B as G}from"./Button-C3d52rTX.js";import{C as Vt,a as qt,b as Gt}from"./CardHeader-7DqjReBs.js";function So(t){return String(t).match(/[\d.\-+]*\s*(.*)/)[1]||""}function Do(t){return parseFloat(t)}function Io(t){return qe("MuiCardActions",t)}Ge("MuiCardActions",["root","spacing"]);const Eo=["disableSpacing","className"],Lo=t=>{const{classes:o,disableSpacing:r}=t;return De({root:["root",!r&&"spacing"]},Io,o)},Ao=re("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:r}=t;return[o.root,!r.disableSpacing&&o.spacing]}})(({ownerState:t})=>d({display:"flex",alignItems:"center",padding:8},!t.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})),Xt=a.forwardRef(function(o,r){const i=_e({props:o,name:"MuiCardActions"}),{disableSpacing:f=!1,className:u}=i,m=Se(i,Eo),g=d({},i,{disableSpacing:f}),v=Lo(g);return e.jsx(Ao,d({className:K(v.root,u),ownerState:g,ref:r},m))});function No(t){return qe("MuiDialogContentText",t)}Ge("MuiDialogContentText",["root"]);const $o=["children","className"],Oo=t=>{const{classes:o}=t,i=De({root:["root"]},No,o);return d({},o,i)},Fo=re(x,{shouldForwardProp:t=>lo(t)||t==="classes",name:"MuiDialogContentText",slot:"Root",overridesResolver:(t,o)=>o.root})({}),It=a.forwardRef(function(o,r){const i=_e({props:o,name:"MuiDialogContentText"}),{className:f}=i,u=Se(i,$o),m=Oo(u);return e.jsx(Fo,d({component:"p",variant:"body1",color:"text.secondary",ref:r,ownerState:u,className:K(m.root,f)},i,{classes:m}))}),Ho=["className","id"],Uo=t=>{const{classes:o}=t;return De({root:["root"]},yo,o)},Wo=re(x,{name:"MuiDialogTitle",slot:"Root",overridesResolver:(t,o)=>o.root})({padding:"16px 24px",flex:"0 0 auto"}),pt=a.forwardRef(function(o,r){const i=_e({props:o,name:"MuiDialogTitle"}),{className:f,id:u}=i,m=Se(i,Ho),g=i,v=Uo(g),{titleId:j=u}=a.useContext(ko);return e.jsx(Wo,d({component:"h2",className:K(v.root,f),ownerState:g,ref:r,variant:"h6",id:u??j},m))});function Yo(t){return qe("MuiSkeleton",t)}Ge("MuiSkeleton",["root","text","rectangular","rounded","circular","pulse","wave","withChildren","fitContent","heightAuto"]);const zo=["animation","className","component","height","style","variant","width"];let Ve=t=>t,Et,Lt,At,Nt;const Bo=t=>{const{classes:o,variant:r,animation:i,hasChildren:f,width:u,height:m}=t;return De({root:["root",r,i,f&&"withChildren",f&&!u&&"fitContent",f&&!m&&"heightAuto"]},Yo,o)},Vo=gt(Et||(Et=Ve`
  0% {
    opacity: 1;
  }

  50% {
    opacity: 0.4;
  }

  100% {
    opacity: 1;
  }
`)),qo=gt(Lt||(Lt=Ve`
  0% {
    transform: translateX(-100%);
  }

  50% {
    /* +0.5s of delay between each loop */
    transform: translateX(100%);
  }

  100% {
    transform: translateX(100%);
  }
`)),Go=re("span",{name:"MuiSkeleton",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:r}=t;return[o.root,o[r.variant],r.animation!==!1&&o[r.animation],r.hasChildren&&o.withChildren,r.hasChildren&&!r.width&&o.fitContent,r.hasChildren&&!r.height&&o.heightAuto]}})(({theme:t,ownerState:o})=>{const r=So(t.shape.borderRadius)||"px",i=Do(t.shape.borderRadius);return d({display:"block",backgroundColor:t.vars?t.vars.palette.Skeleton.bg:jo(t.palette.text.primary,t.palette.mode==="light"?.11:.13),height:"1.2em"},o.variant==="text"&&{marginTop:0,marginBottom:0,height:"auto",transformOrigin:"0 55%",transform:"scale(1, 0.60)",borderRadius:`${i}${r}/${Math.round(i/.6*10)/10}${r}`,"&:empty:before":{content:'"\\00a0"'}},o.variant==="circular"&&{borderRadius:"50%"},o.variant==="rounded"&&{borderRadius:(t.vars||t).shape.borderRadius},o.hasChildren&&{"& > *":{visibility:"hidden"}},o.hasChildren&&!o.width&&{maxWidth:"fit-content"},o.hasChildren&&!o.height&&{height:"auto"})},({ownerState:t})=>t.animation==="pulse"&&Rt(At||(At=Ve`
      animation: ${0} 2s ease-in-out 0.5s infinite;
    `),Vo),({ownerState:t,theme:o})=>t.animation==="wave"&&Rt(Nt||(Nt=Ve`
      position: relative;
      overflow: hidden;

      /* Fix bug in Safari https://bugs.webkit.org/show_bug.cgi?id=68196 */
      -webkit-mask-image: -webkit-radial-gradient(white, black);

      &::after {
        animation: ${0} 2s linear 0.5s infinite;
        background: linear-gradient(
          90deg,
          transparent,
          ${0},
          transparent
        );
        content: '';
        position: absolute;
        transform: translateX(-100%); /* Avoid flash during server-side hydration */
        bottom: 0;
        left: 0;
        right: 0;
        top: 0;
      }
    `),qo,(o.vars||o).palette.action.hover)),X=a.forwardRef(function(o,r){const i=_e({props:o,name:"MuiSkeleton"}),{animation:f="pulse",className:u,component:m="span",height:g,style:v,variant:j="text",width:C}=i,M=Se(i,zo),U=d({},i,{animation:f,component:m,variant:j,hasChildren:!!M.children}),W=Bo(U);return e.jsx(Go,d({as:m,ref:r,className:K(W.root,u),ownerState:U},M,{style:d({width:C,height:g},v)}))});function Xo(t){return qe("MuiTooltip",t)}const J=Ge("MuiTooltip",["popper","popperInteractive","popperArrow","popperClose","tooltip","tooltipArrow","touch","tooltipPlacementLeft","tooltipPlacementRight","tooltipPlacementTop","tooltipPlacementBottom","arrow"]),Ko=["arrow","children","classes","components","componentsProps","describeChild","disableFocusListener","disableHoverListener","disableInteractive","disableTouchListener","enterDelay","enterNextDelay","enterTouchDelay","followCursor","id","leaveDelay","leaveTouchDelay","onClose","onOpen","open","placement","PopperComponent","PopperProps","slotProps","slots","title","TransitionComponent","TransitionProps"];function Jo(t){return Math.round(t*1e5)/1e5}const Qo=t=>{const{classes:o,disableInteractive:r,arrow:i,touch:f,placement:u}=t,m={popper:["popper",!r&&"popperInteractive",i&&"popperArrow"],tooltip:["tooltip",i&&"tooltipArrow",f&&"touch",`tooltipPlacement${Yt(u.split("-")[0])}`],arrow:["arrow"]};return De(m,Xo,o)},Zo=re(Bt,{name:"MuiTooltip",slot:"Popper",overridesResolver:(t,o)=>{const{ownerState:r}=t;return[o.popper,!r.disableInteractive&&o.popperInteractive,r.arrow&&o.popperArrow,!r.open&&o.popperClose]}})(({theme:t,ownerState:o,open:r})=>d({zIndex:(t.vars||t).zIndex.tooltip,pointerEvents:"none"},!o.disableInteractive&&{pointerEvents:"auto"},!r&&{pointerEvents:"none"},o.arrow&&{[`&[data-popper-placement*="bottom"] .${J.arrow}`]:{top:0,marginTop:"-0.71em","&::before":{transformOrigin:"0 100%"}},[`&[data-popper-placement*="top"] .${J.arrow}`]:{bottom:0,marginBottom:"-0.71em","&::before":{transformOrigin:"100% 0"}},[`&[data-popper-placement*="right"] .${J.arrow}`]:d({},o.isRtl?{right:0,marginRight:"-0.71em"}:{left:0,marginLeft:"-0.71em"},{height:"1em",width:"0.71em","&::before":{transformOrigin:"100% 100%"}}),[`&[data-popper-placement*="left"] .${J.arrow}`]:d({},o.isRtl?{left:0,marginLeft:"-0.71em"}:{right:0,marginRight:"-0.71em"},{height:"1em",width:"0.71em","&::before":{transformOrigin:"0 0"}})})),es=re("div",{name:"MuiTooltip",slot:"Tooltip",overridesResolver:(t,o)=>{const{ownerState:r}=t;return[o.tooltip,r.touch&&o.touch,r.arrow&&o.tooltipArrow,o[`tooltipPlacement${Yt(r.placement.split("-")[0])}`]]}})(({theme:t,ownerState:o})=>d({backgroundColor:t.vars?t.vars.palette.Tooltip.bg:zt.alpha(t.palette.grey[700],.92),borderRadius:(t.vars||t).shape.borderRadius,color:(t.vars||t).palette.common.white,fontFamily:t.typography.fontFamily,padding:"4px 8px",fontSize:t.typography.pxToRem(11),maxWidth:300,margin:2,wordWrap:"break-word",fontWeight:t.typography.fontWeightMedium},o.arrow&&{position:"relative",margin:0},o.touch&&{padding:"8px 16px",fontSize:t.typography.pxToRem(14),lineHeight:`${Jo(16/14)}em`,fontWeight:t.typography.fontWeightRegular},{[`.${J.popper}[data-popper-placement*="left"] &`]:d({transformOrigin:"right center"},o.isRtl?d({marginLeft:"14px"},o.touch&&{marginLeft:"24px"}):d({marginRight:"14px"},o.touch&&{marginRight:"24px"})),[`.${J.popper}[data-popper-placement*="right"] &`]:d({transformOrigin:"left center"},o.isRtl?d({marginRight:"14px"},o.touch&&{marginRight:"24px"}):d({marginLeft:"14px"},o.touch&&{marginLeft:"24px"})),[`.${J.popper}[data-popper-placement*="top"] &`]:d({transformOrigin:"center bottom",marginBottom:"14px"},o.touch&&{marginBottom:"24px"}),[`.${J.popper}[data-popper-placement*="bottom"] &`]:d({transformOrigin:"center top",marginTop:"14px"},o.touch&&{marginTop:"24px"})})),ts=re("span",{name:"MuiTooltip",slot:"Arrow",overridesResolver:(t,o)=>o.arrow})(({theme:t})=>({overflow:"hidden",position:"absolute",width:"1em",height:"0.71em",boxSizing:"border-box",color:t.vars?t.vars.palette.Tooltip.bg:zt.alpha(t.palette.grey[700],.9),"&::before":{content:'""',margin:"auto",display:"block",width:"100%",height:"100%",backgroundColor:"currentColor",transform:"rotate(45deg)"}}));let ze=!1;const $t=new go;let je={x:0,y:0};function Be(t,o){return(r,...i)=>{o&&o(r,...i),t(r,...i)}}const we=a.forwardRef(function(o,r){var i,f,u,m,g,v,j,C,M,U,W,Y,ae,ne,Ze,me,Q,Ie,Z;const ie=_e({props:o,name:"MuiTooltip"}),{arrow:E=!1,children:le,components:L={},componentsProps:R={},describeChild:fe=!1,disableFocusListener:et=!1,disableHoverListener:z=!1,disableInteractive:tt=!1,disableTouchListener:b=!1,enterDelay:Ee=100,enterNextDelay:ce=0,enterTouchDelay:de=700,followCursor:ue=!1,id:B,leaveDelay:ge=0,leaveTouchDelay:xt=1500,onClose:Le,onOpen:Ae,open:ot,placement:ee="bottom",PopperComponent:A,PopperProps:T={},slotProps:O={},slots:N={},title:F,TransitionComponent:pe=Dt,TransitionProps:xe}=ie,te=Se(ie,Ko),w=a.isValidElement(le)?le:e.jsx("span",{children:le}),$=Wt(),st=co(),[oe,Ne]=a.useState(),[V,rt]=a.useState(null),se=a.useRef(!1),ve=tt||ue,$e=Oe(),he=Oe(),s=Oe(),n=Oe(),[c,p]=uo({controlled:ot,default:!1,name:"Tooltip",state:"open"});let h=c;const _=po(B),S=a.useRef(),k=Tt(()=>{S.current!==void 0&&(document.body.style.WebkitUserSelect=S.current,S.current=void 0),n.clear()});a.useEffect(()=>k,[k]);const P=l=>{$t.clear(),ze=!0,p(!0),Ae&&!h&&Ae(l)},D=Tt(l=>{$t.start(800+ge,()=>{ze=!1}),p(!1),Le&&h&&Le(l),$e.start($.transitions.duration.shortest,()=>{se.current=!1})}),q=l=>{se.current&&l.type!=="touchstart"||(oe&&oe.removeAttribute("title"),he.clear(),s.clear(),Ee||ze&&ce?he.start(ze?ce:Ee,()=>{P(l)}):P(l))},at=l=>{he.clear(),s.start(ge,()=>{D(l)})},{isFocusVisibleRef:vt,onBlur:Kt,onFocus:Jt,ref:Qt}=ho(),[,bt]=a.useState(!1),Ct=l=>{Kt(l),vt.current===!1&&(bt(!1),at(l))},kt=l=>{oe||Ne(l.currentTarget),Jt(l),vt.current===!0&&(bt(!0),q(l))},yt=l=>{se.current=!0;const y=w.props;y.onTouchStart&&y.onTouchStart(l)},Zt=l=>{yt(l),s.clear(),$e.clear(),k(),S.current=document.body.style.WebkitUserSelect,document.body.style.WebkitUserSelect="none",n.start(de,()=>{document.body.style.WebkitUserSelect=S.current,q(l)})},eo=l=>{w.props.onTouchEnd&&w.props.onTouchEnd(l),k(),s.start(xt,()=>{D(l)})};a.useEffect(()=>{if(!h)return;function l(y){(y.key==="Escape"||y.key==="Esc")&&D(y)}return document.addEventListener("keydown",l),()=>{document.removeEventListener("keydown",l)}},[D,h]);const to=mo(fo(w),Qt,Ne,r);!F&&F!==0&&(h=!1);const nt=a.useRef(),oo=l=>{const y=w.props;y.onMouseMove&&y.onMouseMove(l),je={x:l.clientX,y:l.clientY},nt.current&&nt.current.update()},be={},it=typeof F=="string";fe?(be.title=!h&&it&&!z?F:null,be["aria-describedby"]=h?_:null):(be["aria-label"]=it?F:null,be["aria-labelledby"]=h&&!it?_:null);const I=d({},be,te,w.props,{className:K(te.className,w.props.className),onTouchStart:yt,ref:to},ue?{onMouseMove:oo}:{}),Ce={};b||(I.onTouchStart=Zt,I.onTouchEnd=eo),z||(I.onMouseOver=Be(q,I.onMouseOver),I.onMouseLeave=Be(at,I.onMouseLeave),ve||(Ce.onMouseOver=q,Ce.onMouseLeave=at)),et||(I.onFocus=Be(kt,I.onFocus),I.onBlur=Be(Ct,I.onBlur),ve||(Ce.onFocus=kt,Ce.onBlur=Ct));const so=a.useMemo(()=>{var l;let y=[{name:"arrow",enabled:!!V,options:{element:V,padding:4}}];return(l=T.popperOptions)!=null&&l.modifiers&&(y=y.concat(T.popperOptions.modifiers)),d({},T.popperOptions,{modifiers:y})},[V,T]),ke=d({},ie,{isRtl:st,arrow:E,disableInteractive:ve,placement:ee,PopperComponentProp:A,touch:se.current}),lt=Qo(ke),jt=(i=(f=N.popper)!=null?f:L.Popper)!=null?i:Zo,wt=(u=(m=(g=N.transition)!=null?g:L.Transition)!=null?m:pe)!=null?u:Dt,Pt=(v=(j=N.tooltip)!=null?j:L.Tooltip)!=null?v:es,Mt=(C=(M=N.arrow)!=null?M:L.Arrow)!=null?C:ts,ro=Fe(jt,d({},T,(U=O.popper)!=null?U:R.popper,{className:K(lt.popper,T==null?void 0:T.className,(W=(Y=O.popper)!=null?Y:R.popper)==null?void 0:W.className)}),ke),ao=Fe(wt,d({},xe,(ae=O.transition)!=null?ae:R.transition),ke),no=Fe(Pt,d({},(ne=O.tooltip)!=null?ne:R.tooltip,{className:K(lt.tooltip,(Ze=(me=O.tooltip)!=null?me:R.tooltip)==null?void 0:Ze.className)}),ke),io=Fe(Mt,d({},(Q=O.arrow)!=null?Q:R.arrow,{className:K(lt.arrow,(Ie=(Z=O.arrow)!=null?Z:R.arrow)==null?void 0:Ie.className)}),ke);return e.jsxs(a.Fragment,{children:[a.cloneElement(w,I),e.jsx(jt,d({as:A??Bt,placement:ee,anchorEl:ue?{getBoundingClientRect:()=>({top:je.y,left:je.x,right:je.x,bottom:je.y,width:0,height:0})}:oe,popperRef:nt,open:oe?h:!1,id:_,transition:!0},Ce,ro,{popperOptions:so,children:({TransitionProps:l})=>e.jsx(wt,d({timeout:$.transitions.duration.shorter},l,ao,{children:e.jsxs(Pt,d({},no,{children:[F,E?e.jsx(Mt,d({},io,{ref:rt})):null]}))}))}))]})});var Pe={},Ot;function os(){if(Ot)return Pe;Ot=1;var t=Xe();Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.default=void 0;var o=t(Ke()),r=Je();return Pe.default=(0,o.default)((0,r.jsx)("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8z"}),"History"),Pe}var ss=os();const rs=Qe(ss);var Me={},Ft;function as(){if(Ft)return Me;Ft=1;var t=Xe();Object.defineProperty(Me,"__esModule",{value:!0}),Me.default=void 0;var o=t(Ke()),r=Je();return Me.default=(0,o.default)((0,r.jsx)("path",{d:"m21.9 8.89-1.05-4.37c-.22-.9-1-1.52-1.91-1.52H5.05c-.9 0-1.69.63-1.9 1.52L2.1 8.89c-.24 1.02-.02 2.06.62 2.88.08.11.19.19.28.29V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-6.94c.09-.09.2-.18.28-.28.64-.82.87-1.87.62-2.89m-2.99-3.9 1.05 4.37c.1.42.01.84-.25 1.17-.14.18-.44.47-.94.47-.61 0-1.14-.49-1.21-1.14L16.98 5zM13 5h1.96l.54 4.52c.05.39-.07.78-.33 1.07-.22.26-.54.41-.95.41-.67 0-1.22-.59-1.22-1.31zM8.49 9.52 9.04 5H11v4.69c0 .72-.55 1.31-1.29 1.31-.34 0-.65-.15-.89-.41-.25-.29-.37-.68-.33-1.07m-4.45-.16L5.05 5h1.97l-.58 4.86c-.08.65-.6 1.14-1.21 1.14-.49 0-.8-.29-.93-.47-.27-.32-.36-.75-.26-1.17M5 19v-6.03c.08.01.15.03.23.03.87 0 1.66-.36 2.24-.95.6.6 1.4.95 2.31.95.87 0 1.65-.36 2.23-.93.59.57 1.39.93 2.29.93.84 0 1.64-.35 2.24-.95.58.59 1.37.95 2.24.95.08 0 .15-.02.23-.03V19z"}),"Storefront"),Me}var ns=as();const is=Qe(ns);var Re={},Ht;function ls(){if(Ht)return Re;Ht=1;var t=Xe();Object.defineProperty(Re,"__esModule",{value:!0}),Re.default=void 0;var o=t(Ke()),r=Je();return Re.default=(0,o.default)((0,r.jsx)("path",{d:"M14 10H3v2h11zm0-4H3v2h11zm4 8v-4h-2v4h-4v2h4v4h2v-4h4v-2zM3 16h7v-2H3z"}),"PlaylistAdd"),Re}var cs=ls();const ht=Qe(cs);var Te={},Ut;function ds(){if(Ut)return Te;Ut=1;var t=Xe();Object.defineProperty(Te,"__esModule",{value:!0}),Te.default=void 0;var o=t(Ke()),r=Je();return Te.default=(0,o.default)((0,r.jsx)("path",{d:"M12 2 4.5 20.29l.71.71L12 18l6.79 3 .71-.71z"}),"Navigation"),Te}var us=ds();const ps=Qe(us);gt`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`;const mt=()=>e.jsxs(Vt,{sx:{mb:3,border:"1px solid #e0e0e0",boxShadow:"4px 4px 8px rgba(0,0,0,0.1)"},children:[e.jsx(qt,{avatar:e.jsx(X,{animation:"wave",variant:"circular",width:40,height:40}),title:e.jsx(X,{animation:"wave",height:20,width:"80%"}),sx:{backgroundColor:"grey.200"}}),e.jsxs(Gt,{sx:{flexGrow:1,display:"flex",flexDirection:"column",gap:1.5,pt:1},children:[e.jsx(X,{animation:"wave",height:15,width:"90%"}),e.jsx(X,{animation:"wave",height:15,width:"60%"}),e.jsx(X,{animation:"wave",height:15,width:"60%"}),e.jsx(X,{animation:"wave",height:15,width:"60%"})]}),e.jsxs(Xt,{sx:{justifyContent:"space-between",px:2,py:1.5,backgroundColor:"grey.50"},children:[e.jsx(X,{animation:"wave",variant:"circular",width:32,height:32}),e.jsx(X,{animation:"wave",variant:"rectangular",width:100,height:36})]})]}),hs=(t,o,r,i)=>{const u=t*Math.PI/180,m=r*Math.PI/180,g=(r-t)*Math.PI/180,v=(i-o)*Math.PI/180,j=Math.sin(g/2)*Math.sin(g/2)+Math.cos(u)*Math.cos(m)*Math.sin(v/2)*Math.sin(v/2);return 6371e3*(2*Math.atan2(Math.sqrt(j),Math.sqrt(1-j)))},ft=t=>t<500?`${Math.round(t)} meter`:`${(t/1e3).toFixed(1)} km`,ys=()=>{const t=Wt(),o=Po(t.breakpoints.down("sm")),r=a.useMemo(()=>({"Checked In":0,Planned:1,Completed:2,Canceled:3,Draft:4}),[]),{employeeId:i}=xo(),f=vo(),[u,m]=a.useState([]),[g,v]=a.useState(!0),[j,C]=a.useState(null),[M,U]=a.useState(0),[W,Y]=a.useState(!0),[ae,ne]=a.useState(!1),[Ze,me]=a.useState(0),Q=a.useRef(null),Ie=a.useCallback(s=>{ae||(Q.current&&Q.current.disconnect(),Q.current=new IntersectionObserver(n=>{n[0].isIntersecting&&W&&U(c=>c+1)}),s&&Q.current.observe(s))},[ae,W]),[Z,ie]=a.useState(!1),[E,le]=a.useState(null),L=a.useRef(null),R=a.useRef(null),[fe,et]=a.useState(null),[z,tt]=a.useState(null),[b,Ee]=a.useState(null),[ce,de]=a.useState(!1),[ue,B]=a.useState(null),[ge,xt]=a.useState([]),[Le,Ae]=a.useState(void 0),[ot,ee]=a.useState(!1),[A,T]=a.useState({isOpen:!1,distance:0}),[O,N]=a.useState(!1),[F,pe]=a.useState(null),[xe,te]=a.useState(null);a.useEffect(()=>{if(Z&&xe){ee(!1);const s=()=>{L.current?(L.current.srcObject=xe,ee(!0)):(console.warn("DEBUG: videoRef.current is null in useEffect. Retrying..."),setTimeout(s,50))};s()}else Z||ee(!1)},[Z,xe]);const w=a.useCallback(s=>s.sort((n,c)=>(r[n.status]??99)-(r[c.status]??99)),[r]),$=a.useCallback(async s=>{if(!i){C("Employee ID not available."),v(!1),ne(!1);return}s===0?v(!0):ne(!0);try{const n=await bo(s);if(n.error_message){C(n.error_message),Y(!1),m([]);return}const c=n.data,p=n.total;s===0?(m(w(c)),me(p),Y(c.length<p)):m(h=>{const _=[...h,...c],S=Array.from(new Map(_.map(P=>[P.name,P])).values()),k=w(S);return Y(k.length<p),k}),C(null)}catch(n){console.error("Error fetching visit plans:",n),C(n instanceof Error?n.message:"Failed to fetch data."),Y(!1)}finally{s===0&&v(!1),ne(!1)}},[i,w]);a.useEffect(()=>{i&&(m([]),U(0),Y(!0),me(0),$(0))},[i,$]),a.useEffect(()=>{M>0&&$(M)},[M,$]);const st=a.useCallback(s=>{if(s.parent_docstatus===0)return e.jsx(we,{title:s.parent,arrow:!0,children:e.jsx(ye,{label:"Draft",color:"warning",size:"small",sx:{fontWeight:"bold"}})});let n="default",c=s.status;switch(s.status){case"Planned":n="primary";break;case"Checked In":n="secondary";break;case"Completed":n="success";break;case"Canceled":n="error";break;default:c="Draft",n="error";break}return e.jsx(we,{title:s.parent,arrow:!0,children:e.jsx(ye,{label:c,color:n,size:"small",sx:{fontWeight:"bold"}})})},[]),oe=async s=>{try{await _t(s,"Checked In")?$(0):C("Failed to check-in.")}catch(n){C(n instanceof Error?n.message:"An unexpected error occurred during check-in.")}},Ne=async s=>{const n=u.find(p=>p.name===s);if(!n)return;le(s),N(!0),pe(null);let c=null;try{const p=navigator.mediaDevices.getUserMedia({video:!0}),h=new Promise((P,D)=>{if(!navigator.geolocation)return D(new Error("Geolocation is not supported."));navigator.geolocation.getCurrentPosition(q=>P(q.coords),q=>D(q))}),[_,S]=await Promise.all([p,h]);c=_,te(c),Ee(S);const k=await ct(n.store_name);if(k&&k.latitude&&k.longitude){const P=hs(k.latitude,k.longitude,S.latitude,S.longitude);if(P>100){N(!1),T({isOpen:!0,distance:P,type:"too_far"}),c&&c.getTracks().forEach(D=>D.stop()),te(null);return}else if(P>5){N(!1),T({isOpen:!0,distance:P,type:"almost_there"}),c&&c.getTracks().forEach(D=>D.stop()),te(null);return}}N(!1),ie(!0)}catch(p){console.error("DEBUG: Error during pre-checkout validation:",p),console.error("DEBUG: Error during pre-checkout validation:",p),c&&c.getTracks().forEach(_=>_.stop()),te(null);let h="Gagal mempersiapkan checkout. Pastikan izin lokasi dan kamera telah diberikan.";p instanceof GeolocationPositionError?p.code===p.PERMISSION_DENIED?h="Akses lokasi ditolak. Mohon aktifkan di pengaturan browser.":p.code===p.POSITION_UNAVAILABLE&&(h="Informasi lokasi tidak tersedia saat ini."):p instanceof Error&&p.name==="NotAllowedError"&&(h="Akses kamera ditolak. Mohon aktifkan di pengaturan browser."),pe(h),N(!1)}},V=a.useCallback(()=>{ie(!1),le(null),ee(!1)},[]),rt=a.useCallback(()=>{if(L.current&&R.current){const s=L.current,n=R.current;n.width=s.videoWidth,n.height=s.videoHeight;const c=n.getContext("2d");if(c){c.drawImage(s,0,0,s.videoWidth,s.videoHeight);const p=n.toDataURL("image/jpeg");et(p),n.toBlob(h=>{h&&tt(new File([h],"captured_photo.jpeg",{type:"image/jpeg"}))},"image/jpeg")}}},[]),se=a.useCallback(async()=>{if(!b||!E||!z){B("Pastikan foto sudah diambil dan lokasi tersedia."),de(!1);return}try{await _t(E,"Completed",{latitude:b.latitude,longitude:b.longitude,photo_file:z,checkout_time:Ue().format("YYYY-MM-DD HH:mm:ss")})?(V(),$(0)):B("Gagal menyelesaikan checkout.")}catch(s){B(s instanceof Error?s.message:"Terjadi error saat checkout.")}finally{de(!1)}},[b,E,z,V,$]),ve=a.useCallback(async()=>{if(!b||!E||!z){B("Pastikan foto sudah diambil dan lokasi tersedia.");return}de(!0),B(null);try{const s=u.find(c=>c.name===E);if(!s)throw new Error("Data kunjungan tidak ditemukan.");await ct(s.store_name)||await Co(s.store_name,b.latitude,b.longitude),await se()}catch(s){B(s instanceof Error?s.message:"Gagal memvalidasi lokasi."),de(!1)}},[E,b,z,u,se]),$e=async s=>{const n=await ct(s.store_name);if(n&&n.latitude&&n.longitude){const c=`https://www.google.com/maps/dir/?api=1&destination=${n.latitude},${n.longitude}`;window.open(c,"_blank")}else C(`Lokasi untuk customer ${s.store_name} tidak ditemukan.`)},he=a.useCallback((s,n)=>{if(!s)return"N/A";const c=Ue(s,"DD-MM-YYYY HH:mm:ss");if(!c.isValid())return"Invalid Date";if(n){const p=Ue(n,"DD-MM-YYYY HH:mm");if(p.isValid()&&c.isSame(p,"day"))return c.format("HH:mm")}return c.format("DD-MM-YYYY HH:mm")},[]);return e.jsxs(e.Fragment,{children:[e.jsxs(_o,{maxWidth:"lg",sx:{mt:4,mb:4,width:"100%",overflowX:"hidden"},children:[e.jsx(x,{variant:"h4",component:"h1",gutterBottom:!0,align:"center",sx:{fontWeight:"bold"},children:"My Visit Schedule"}),e.jsx(H,{sx:{mb:2,textAlign:"right"},children:e.jsx(G,{variant:"contained",startIcon:e.jsx(rs,{}),onClick:()=>f("/history"),children:"History"})}),g&&M===0?e.jsxs(H,{children:[e.jsx(mt,{}),e.jsx(mt,{}),e.jsx(mt,{})]}):j?e.jsx(ut,{severity:"error",children:j}):u.length===0?e.jsx(ut,{severity:"info",sx:{mt:2},children:"No visit plans found."}):e.jsxs(H,{children:[u.map((s,n)=>e.jsxs(Vt,{sx:{mb:3,border:"1px solid #e0e0e0",boxShadow:"4px 4px 8px rgba(0,0,0,0.1)",width:o?"100%":"auto"},ref:u.length===n+1?Ie:null,children:[e.jsx(qt,{avatar:e.jsx(is,{sx:{color:"primary.main",fontSize:40}}),title:e.jsx(x,{variant:"h6",sx:{fontWeight:"bold"},children:s.store_name}),subheader:e.jsx(x,{variant:"body2",color:"text.secondary",children:s.address}),sx:{backgroundColor:"grey.100",py:1.5}}),e.jsxs(Gt,{sx:{display:"flex",flexDirection:"column",gap:1.5,pt:1},children:[e.jsxs(H,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(ye,{label:e.jsxs(H,{component:"span",children:["Planning :"," ",e.jsx(x,{component:"span",sx:{fontWeight:"bold",color:"#FFFFFF"},children:s.planned_visit_time?Ue(s.planned_visit_time,"DD-MM-YYYY HH:mm").format("DD-MM-YYYY HH:mm"):"N/A"})]}),color:"info",size:"small"}),st(s)]}),e.jsx(ye,{icon:e.jsx(ht,{}),label:`CheckIn: ${he(s.checkin_time,s.planned_visit_time)}`,variant:"outlined",size:"small"}),e.jsx(ye,{icon:e.jsx(ht,{}),label:`CheckOut: ${he(s.checkout_time,s.planned_visit_time)}`,variant:"outlined",size:"small"}),s.notes&&e.jsxs(x,{variant:"body2",sx:{fontStyle:"italic",color:"text.secondary"},children:["Notes: ",s.notes]})]}),e.jsxs(Xt,{sx:{justifyContent:"space-between",px:2,py:1.5,backgroundColor:"grey.50"},children:[e.jsxs(H,{children:[e.jsx(St,{onClick:()=>$e(s),"aria-label":"Navigate",children:e.jsx(we,{title:"Navigate to Customer",children:e.jsx(ps,{sx:{color:"primary.main"}})})}),e.jsx(St,{onClick:()=>f(`/notes/${s.name}`),"aria-label":"Add Notes",children:e.jsx(we,{title:"Add Notes",children:e.jsx(ht,{})})})]}),e.jsxs(H,{children:[s.status==="Planned"&&e.jsx(G,{variant:"contained",color:"secondary",onClick:()=>oe(s.name),children:"Check In"}),s.status==="Checked In"&&e.jsx(G,{variant:"contained",color:"success",onClick:()=>Ne(s.name),children:"Check Out"})]})]})]},s.name)),ae&&e.jsx(H,{sx:{display:"flex",justifyContent:"center",my:2},children:e.jsx(He,{})}),!W&&e.jsx(x,{variant:"body2",align:"center",color:"text.secondary",sx:{my:2},children:"You have reached the end of the list."})]})]}),e.jsxs(We,{open:Z,onClose:V,fullWidth:!0,maxWidth:"sm",children:[e.jsx(pt,{children:"Complete Checkout"}),e.jsxs(Ye,{children:[ue&&e.jsx(ut,{severity:"error",sx:{mb:2},children:ue}),e.jsxs(H,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(x,{children:"Take Photo:"}),e.jsx("video",{ref:L,style:{width:"100%",border:"1px solid #ccc"},autoPlay:!0,playsInline:!0}),ge.length>1&&e.jsxs(Mo,{fullWidth:!0,children:[e.jsx(Ro,{id:"camera-select-label",children:"Camera"}),e.jsx(To,{labelId:"camera-select-label",value:Le||"",label:"Camera",onChange:s=>Ae(s.target.value),children:ge.map(s=>e.jsx(wo,{value:s.deviceId,children:s.label},s.deviceId))})]}),e.jsx(G,{variant:"outlined",onClick:rt,disabled:!ot,children:"Capture Photo"}),fe&&e.jsx("img",{src:fe,alt:"Captured",style:{width:"100%",border:"1px solid #ccc"}}),e.jsx("canvas",{ref:R,style:{display:"none"}}),e.jsx(x,{children:"Current Location:"}),b?e.jsxs(x,{children:["Lat: ",b.latitude.toFixed(6),", Lng: ",b.longitude.toFixed(6)]}):e.jsx(He,{size:20})]})]}),e.jsxs(dt,{children:[e.jsx(G,{onClick:V,disabled:ce,children:"Cancel"}),e.jsx(G,{onClick:ve,disabled:ce||!fe||!b,variant:"contained",children:ce?e.jsx(He,{size:24,color:"inherit"}):"Complete Checkout"})]})]}),e.jsxs(We,{open:A.isOpen,onClose:()=>T({isOpen:!1,distance:0}),children:[e.jsx(pt,{children:"Lokasi Terlalu Jauh"}),e.jsx(Ye,{children:(()=>{const s=u.find(_=>_.name===E),n=(s==null?void 0:s.store_name)||"customer",c=(s==null?void 0:s.address)||"alamat tidak tersedia",p=e.jsx(we,{title:c,arrow:!0,children:e.jsx(x,{component:"span",sx:{fontWeight:"bold"},children:n})});let h;return A.type==="too_far"?h=e.jsxs(e.Fragment,{children:["Lokasi Anda berjarak sekitar ",e.jsx(x,{component:"span",sx:{fontWeight:"bold"},children:ft(A.distance)})," dari lokasi customer.",e.jsx("br",{}),e.jsx("br",{}),"Lokasi Anda terlalu jauh dengan ",p,". Silahkan terus berjalan mendekat.",e.jsx("br",{}),"Gunakan button refresh untuk memperbaharui."]}):A.type==="almost_there"?h=e.jsxs(e.Fragment,{children:["Lokasi Anda berjarak sekitar ",e.jsx(x,{component:"span",sx:{fontWeight:"bold"},children:ft(A.distance)})," dari lokasi customer.",e.jsx("br",{}),e.jsx("br",{}),"Terus melangkah lagi lokasi anda sudah dekat.",e.jsx("br",{}),"Gunakan button refresh untuk memperbaharui."]}):h=e.jsxs(e.Fragment,{children:["Lokasi Anda berjarak sekitar ",e.jsx(x,{component:"span",sx:{fontWeight:"bold"},children:ft(A.distance)})," dari lokasi customer.",e.jsx("br",{}),e.jsx("br",{}),"Silahkan berjalan lagi untuk mendapatkan lokasi yang sesuai."]}),e.jsx(It,{children:h})})()}),e.jsx(dt,{children:e.jsx(G,{onClick:()=>window.location.reload(),color:"primary",children:"Refresh"})})]}),e.jsx(We,{open:O,children:e.jsxs(Ye,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(He,{}),e.jsx(x,{children:"Mempersiapkan checkout..."})]})}),e.jsxs(We,{open:!!F,onClose:()=>pe(null),children:[e.jsx(pt,{children:"Error"}),e.jsx(Ye,{children:e.jsx(It,{children:F})}),e.jsx(dt,{children:e.jsx(G,{onClick:()=>pe(null),children:"Tutup"})})]})]})};export{ys as default};
